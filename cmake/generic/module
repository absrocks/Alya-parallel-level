cmake_minimum_required(VERSION 2.8 FATAL_ERROR)


get_filename_component(ProjectId ${CMAKE_CURRENT_LIST_DIR} NAME)
string(REPLACE " " "_" ProjectId ${ProjectId})

project(${ProjectId} LANGUAGES Fortran)
file(GLOB_RECURSE SRC_FILES ${CMAKE_HOME_DIRECTORY}/src/modules/${PROJECT_NAME}/*.f90)
add_library(${PROJECT_NAME} ${LIBRARY_TYPE} ${SRC_FILES})

include(compiler)
set_flags()
set_defs()
set_openmpi()
include(commdom)
commdom()
include(cantera)
cantera()

include_directories(${alya-core_MODULE_DIR})

target_link_libraries(${PROJECT_NAME} alya-core)

set_target_properties(${PROJECT_NAME} PROPERTIES POSITION_INDEPENDENT_CODE ON)

set(CMAKE_Fortran_MODULE_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR})
set(${PROJECT_NAME}_MODULE_DIR ${CMAKE_Fortran_MODULE_DIRECTORY} CACHE INTERNAL "${PROJECT_NAME}: module directory" FORCE)

install(TARGETS ${PROJECT_NAME} DESTINATION lib)
install(DIRECTORY ${CMAKE_Fortran_MODULE_DIRECTORY} DESTINATION modules)
