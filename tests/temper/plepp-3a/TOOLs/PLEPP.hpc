
#BSUB -n 288  
#BSUB -R"span[ptile=16]"
#BSUB -o out.hpc   
#BSUB -e err.hpc
#BSUB -J HPC   
#BSUB -W 00:29   
# #BSUB -q bsc_case  

export PATH=$PATH:/home/bsc21/bsc21704/z2016/REPOSITORY/HPCTOOLKIT/HPCTK/hpctoolkit/build_gcc_papi/Execs/bin

ALYA_PATH=/home/bsc21/bsc21704/z2017/REPOSITORY/ALYA_2017JAN10/Executables/plepp-3


rm -rf *database* *measurements* HPC.tar  


ALYAi=4  
ALYAj=3
ALYAij=$((ALYAi+ALYAj))

time mpirun \
-np $ALYAi  \
 hpcrun -t --event WALLCLOCK@100001 --output hpc${ALYAij}_measurements \
 $ALYA_PATH/Alya.x vortex2D --name DIRIC  \
 : \
-np $ALYAj \
 hpcrun -t --event WALLCLOCK@100001 --output hpc${ALYAij}_measurements \
 $ALYA_PATH/Alya.x Interior01 --name NEUMA



Exec01()
{
  export PATH=$PATH:/home/bsc21/bsc21704/z2016/REPOSITORY/HPCTOOLKIT/HPCTK/hpctoolkit/build_gcc_papi/Execs/bin

  mpirun -np 4 hpcprof-mpi  \
  -S $ALYA_PATH/Alya.x.hpcstruct \
  -I $ALYA_PATH/../../Sources/+ \
  -o $1$2_database \
     $1$2_measurements

  rm hpc.tar
  tar -cf hpc.tar *database* *measurements*
}

##Exec01 'D' $ALYAi
##Exec01 'N' $ALYAj
Exec01 'hpc' $((ALYAi+ALYAj)) 
