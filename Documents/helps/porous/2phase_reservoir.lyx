#LyX 2.0 created this file. For more info see http://www.lyx.org/
\lyxformat 413
\begin_document
\begin_header
\textclass article
\use_default_options true
\maintain_unincluded_children false
\language english
\language_package default
\inputencoding auto
\fontencoding global
\font_roman default
\font_sans default
\font_typewriter default
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100
\font_tt_scale 100

\graphics default
\default_output_format default
\output_sync 0
\bibtex_command default
\index_command default
\paperfontsize default
\spacing single
\use_hyperref false
\papersize default
\use_geometry true
\use_amsmath 1
\use_esint 1
\use_mhchem 1
\use_mathdots 1
\cite_engine basic
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\use_refstyle 1
\index Index
\shortcut idx
\color #008000
\end_index
\leftmargin 2cm
\topmargin 2cm
\rightmargin 2cm
\bottommargin 2cm
\secnumdepth 3
\tocdepth 3
\paragraph_separation indent
\paragraph_indentation default
\quotes_language english
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Title
2 Phase Reservoir Modeling with Standard FE
\end_layout

\begin_layout Section
Governing equations
\end_layout

\begin_layout Standard
Mass is conserved within each in-miscible and incompressible phase (oil
 and water) (Chen 2.36)
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\frac{\partial}{\partial t}\left(\phi\ \rho_{\alpha}\ S_{\alpha}\right)+\nabla\cdot\left(\rho_{\alpha}\ \mathbf{u}_{\alpha}\right)=q_{\alpha}\label{eq:mass-cons-alpha}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Darcy’s law
\begin_inset Formula 
\begin{equation}
\mathbf{u}_{\alpha}=-K\lambda_{\alpha}\left(\nabla p_{\alpha}-\rho_{\alpha}\ g\nabla z\right)\label{eq:darcy-alpha}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
with 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula 
\begin{equation}
\lambda_{\alpha}=\frac{k_{r\alpha}}{\mu_{\alpha}}\label{eq:lambda-alpha}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Saturations
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
S_{o}+S_{w}=1
\]

\end_inset


\end_layout

\begin_layout Standard
Capillary pressure
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
p_{c}(S_{w})=p_{o}-p_{w}
\]

\end_inset


\end_layout

\begin_layout Standard
For the Brugge case that we are interested in 
\begin_inset Formula 
\begin{equation}
p_{c}(S_{w})=0\Longrightarrow p_{o}=p_{w}\label{eq:no-critical-pres}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Both Water and oil are slightly compressible.
\end_layout

\begin_layout Subsection
Boundary conditions for the pressure with non zero gravity
\begin_inset CommandInset label
LatexCommand label
name "sub:Boundary-conditions-for"

\end_inset


\end_layout

\begin_layout Standard
For the moment I am not using this I am setting BOUNDARIES =0.
\end_layout

\begin_layout Standard
From 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:darcy-alpha"

\end_inset

 if we want zero velocities for each of the components on the boundary we
 need:
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula 
\[
\nabla p_{\alpha}-\rho_{\alpha}\ g\nabla z=0
\]

\end_inset


\end_layout

\begin_layout Standard
Which for a general gravity that may not coincide with the z direction can
 be written as 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula 
\[
\nabla p_{\alpha}=\rho_{\alpha}\ \mathbf{g}
\]

\end_inset

Here I am a bit confused because if we want both zero water and oil velocities
 and moreover taking into account that since in our case both pressures
 are the same, we would need also 
\begin_inset Formula 
\[
\rho_{o}\ \mathbf{g}=\rho_{w}\ \mathbf{g}
\]

\end_inset

which can obviously not be true!!!!!!!!!!!!!
\end_layout

\begin_layout Standard
Perhaps what we need to impose is that the total velocity is zero
\begin_inset Formula 
\begin{equation}
\mathbf{u}=\mathbf{u}_{w}+\mathbf{u}_{o}=0\label{eq:Chen7.7}
\end{equation}

\end_inset


\begin_inset Formula 
\[
-K\lambda_{w}\left(\nabla p-\rho_{w}\ \mathbf{g}\right)-K\lambda_{o}\left(\nabla p-\rho_{o}\ \mathbf{g}\right)=0
\]

\end_inset

where I have already taken into account that for our case 
\begin_inset Formula $p_{c}=0$
\end_inset

.
 The previous equation can be rearranged to
\begin_inset Formula 
\[
\left(\lambda_{w}+\lambda_{o}\right)\nabla p=\left(\lambda_{w}\rho_{w}+\lambda_{o}\rho_{o}\right)\mathbf{g}
\]

\end_inset


\begin_inset Formula 
\[
\nabla p=\frac{\lambda_{w}\rho_{w}+\lambda_{o}\rho_{o}}{\lambda_{w}+\lambda_{o}}\mathbf{g}
\]

\end_inset


\end_layout

\begin_layout Standard
( (lam_w*dewat_por/Bw) + (lam_o*deoil_por/Bo) ) / ( lam_w + lam_o)
\end_layout

\begin_layout Standard
This seems to be a more logical bc for the pressure.
 For the FE formulation we would need an integral on the boundaries of 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula 
\[
\nabla p\cdot\mathbf{n}
\]

\end_inset

that leads to the following integral 
\begin_inset Formula 
\[
\frac{\lambda_{w}\rho_{w}+\lambda_{o}\rho_{o}}{\lambda_{w}+\lambda_{o}}\mathbf{g}\cdot\mathbf{n}
\]

\end_inset


\end_layout

\begin_layout Standard
por_bouope
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula $\lambda_{\alpha}$
\end_inset

only depends on 
\begin_inset Formula $S_{\alpha}$
\end_inset

 but 
\begin_inset Formula $\rho_{\alpha}$
\end_inset

 depends on 
\begin_inset Formula $p$
\end_inset

.
 We could try to take this into account implicitly but since the dependence
 is non linear it would involve iteration for the pressure equation.
 We will avoid treating of this term explicitly.
 For small time steps I guess this should not introduce much error.
 For the moment, I will use the density from the previous time step.
\end_layout

\begin_layout Standard
Finally I have noticed that bouope goes wrong ----- would have to check.
 But putting nboun = 0 if it is ok now.
\end_layout

\begin_layout Standard
Beware when I smooth of velocity i need to check if I am subtracting the
 gravity term.
 --- This seems to be ok in por_velsmo!.
\end_layout

\begin_layout Subsection
Gravity - volume terms.
\end_layout

\begin_layout Standard
8-8-13: Ruben told me that Eclipse corrects the initial pressure so that
 gravity is taken into account.
 
\end_layout

\begin_layout Standard
I have programmed this in por_inipre.
 I do not use any fixity and I get a pressure with an average that corresponds
 to the initial pressure I give Alya.
 
\end_layout

\begin_layout Standard
Top= 18236398, bottom= 15763596, average = 16999996.5.
 That is the 17000000 that I set initially.
\end_layout

\begin_layout Standard
Looking at Ruben's results I see that what we want is 17 MPa at the bottom,
 not at the middle.
 This does not seem very consistent with what is done for the wells but
 it seems to be the way in which Eclipse works.
 The solution I have used is to set the initial pressure to 15763596.
 With this I get 17 MPa at the bottom.
\end_layout

\begin_layout Subsection
Gravity in well.
\end_layout

\begin_layout Standard
8-8-13: Ruben sent me a new 
\shape italic
brugge.rsm
\shape default
 that he says is the correct one.
 The BHP (Bottom-Hole-Pressure) he gives me is at the middle of the well,
 not at the bottom as he had told me initially.
\end_layout

\begin_layout Standard
I have to correct upwards and downwards to take into account hydrostatic
 component.
 How to know density??? I am using the values from the previous step.
 The physical grounds for this are not totally correct.
 I should think about this with more detail.
\end_layout

\begin_layout Standard
Perhaps it would be more logical that he gave me the Pbh at different heights.
 But I do not know if he can do that.
\end_layout

\begin_layout Standard
Moreover leaving 170 as the initial pressure in the well (pr_W02.txt) seems
 a bad idea.
 For t=0 I have extrapolated it using 1st and 2nd steps.
 
\end_layout

\begin_layout Standard
In 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:wellflowrate1"

\end_inset

(8.11 Chen) there is some reference to the gravity term.
 And they use 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\rho_{w}\ g\left(z_{bj}^{\left(j\right)}-z\right)$
\end_inset

 but it is not at all clear how do they take into account that 
\begin_inset Formula $\rho_{w}$
\end_inset

 is non constant.
\end_layout

\begin_layout Subsection
Differential formulation as in Black oil Chen Ch8
\end_layout

\begin_layout Standard
Using (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:mass-cons-alpha"

\end_inset

, 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:darcy-alpha"

\end_inset

, 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:lambda-alpha"

\end_inset

 and 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:no-critical-pres"

\end_inset

) the water transport equation for compressible flow reads:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\frac{\partial}{\partial t}\left(\phi\ \frac{\rho_{ws}}{B_{w}}\ S_{w}\right)-\nabla\cdot\left(\frac{\rho_{ws}}{B_{w}}\ K\lambda_{w}\left(\nabla p_{o}-\frac{\rho_{ws}}{B_{w}}\ g\nabla z\right)\right)=q_{w}\label{eq:water-transp}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Equation (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:water-transp"

\end_inset

) can be rewritten as in 8.10 Chen using:
\begin_inset Formula 
\[
q_{w}=\frac{q_{ws}\rho_{ws}}{B_{w}}
\]

\end_inset

BEWARE: the previous notation is not very nice.
 Actually I think it leads to things that are not clear.
 In Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Clean-reduced-version"

\end_inset

 I will continue working directly with 
\begin_inset Formula $q_{w}$
\end_inset

 I will not introduce 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $q_{ws}$
\end_inset

 at all.
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
T_{\alpha}=\frac{k_{r\alpha}}{\mu_{\alpha}B_{\alpha}}K\label{eq:T_alpha}
\end{equation}

\end_inset


\begin_inset Formula 
\begin{equation}
\Phi_{\alpha}=p_{\alpha}-\rho_{\alpha}\ gz\label{eq:p_mod_alpha}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
and taking into account that 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\rho_{ws}$
\end_inset

 is a constant:
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
 
\begin_inset Formula 
\begin{equation}
\frac{\partial}{\partial t}\left(\frac{\phi S_{w}}{B_{w}}\right)-\nabla\cdot\left(T_{w}\nabla\Phi_{w}\right)=\frac{q_{ws}}{B_{w}}\label{eq:water-transp2}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Notice that 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $q_{w}$
\end_inset

 in 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:water-transp"

\end_inset

 is a mass flow rate instead 
\begin_inset Formula $q_{ws}$
\end_inset

 in 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:water-transp2"

\end_inset

 is a volumetric flow rate.
 Revise if Chen uses 
\begin_inset Formula $q_{w}$
\end_inset

 for the mass flow rate or for the volumetric flow rate or if he is a bit
 untidy.
 Check also if I am being untidy
\end_layout

\begin_layout Standard
A similar equation can be written for oil:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\frac{\partial}{\partial t}\left(\frac{\phi S_{o}}{B_{o}}\right)-\nabla\cdot\left(T_{o}\nabla\Phi_{o}\right)=\frac{q_{os}}{B_{o}}
\]

\end_inset


\end_layout

\begin_layout Standard
The volumetric flow rates are obtained from the well indexes that depend
 on the equivalent radius (8.11 Chen):
\begin_inset Formula 
\begin{equation}
q_{ws}=\sum_{j=1}^{N_{w}}\sum_{m=1}^{M_{wj}}WI^{\left(j,m\right)}\frac{k_{rw}}{\mu_{w}}\left[p_{bj}^{\left(j\right)}-p_{w}-\rho_{w}\ g\left(z_{bj}^{\left(j\right)}-z\right)\right]\delta\left(\mathbf{x}-\mathbf{x}^{\left(j,m\right)}\right).\label{eq:wellflowrate1}
\end{equation}

\end_inset

Notice that in paper well Chen eq 3.6 the formula is the same but it includes
 the density.
 Therefore it produces a mass flow rate instead of a volumetric flow rate.
\end_layout

\begin_layout Standard
The term
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
 
\begin_inset Formula $\rho_{w}\ g\left(z_{bj}^{\left(j\right)}-z\right)$
\end_inset

 is what in Eclipse is called 
\begin_inset Formula $H_{wj}$
\end_inset

 (p1189), the well bore pressure head between the connection and the well’s
 bottom hole datum, that Ruben told me they always set to 0.
\end_layout

\begin_layout Standard
The well index is defined in Chen pag.
 825 for FD as 
\begin_inset Formula 
\begin{equation}
WI^{\left(j,m\right)}=\frac{2\pi\bar{k}\triangle L^{\left(j,m\right)}}{ln\left(r_{e}^{\left(j,m\right)}/r_{w}^{\left(j\right)}\right)}.\label{eq:wellindex}
\end{equation}

\end_inset


\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\bar{k}$
\end_inset

 is an 
\family default
\series default
\shape default
\size default
\emph on
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
average
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
 of k at the well.
 
\begin_inset Formula $\triangle L^{\left(j,m\right)}$
\end_inset

 is the segment length of the 
\begin_inset Formula $m$
\end_inset

th perforated zone of the 
\begin_inset Formula $j$
\end_inset

th well.
 
\begin_inset Formula $r_{e}^{\left(j,m\right)}$
\end_inset

 is the drainage radius of the 
\begin_inset Formula $j$
\end_inset

th well at the grid block in which 
\begin_inset Formula $\mathbf{x}^{\left(j,m\right)}$
\end_inset

 is located.
 
\end_layout

\begin_layout Standard
Note that
\begin_inset Formula 
\[
\rho_{w}=\frac{\rho_{ws}}{B_{w}}=\frac{\rho_{ws}}{B_{wi}}\left(1+c_{w}\left(p-p_{0}\right)\right)
\]

\end_inset

as mentioned in 8.18 Chen where 
\begin_inset Formula $B_{wi}$
\end_inset

 is the water formation volume at the initial formation pressure 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $p_{0}$
\end_inset

.
 This is using the approximation used by Chen (up to order 1) but in Eclipse
 I believe they use up to order 2.
 Missing check.
\end_layout

\begin_layout Subsection
Iterative IMPES
\end_layout

\begin_layout Standard
Lets first introduce some definitions from Chen.
 For a generic value 
\begin_inset Formula $v$
\end_inset

, 
\begin_inset Formula 
\[
\overline{\delta}v=v^{n+1}-v^{n}.
\]

\end_inset

Moreover 
\begin_inset Formula 
\[
v^{n+1}\approx v^{n+1,l+1}=v^{n+1,l}+\delta v
\]

\end_inset

so that
\begin_inset Formula 
\[
\overline{\delta}v\approx v^{n+1,l}-v^{n}+\delta v
\]

\end_inset

Using the previous definitions and approximating 
\begin_inset Formula $\frac{\partial v}{\partial t}$
\end_inset

 by 
\begin_inset Formula $\frac{\triangle v}{\triangle t}$
\end_inset

 we easily rewrite 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:water-transp2"

\end_inset

 as 
\begin_inset Formula 
\begin{eqnarray}
 & \frac{1}{\triangle t}\left[\left(\frac{\phi S_{w}}{B_{w}}\right)^{n+1,l}-\left(\frac{\phi S_{w}}{B_{w}}\right)^{n}+\delta\left(\frac{\phi S_{w}}{B_{w}}\right)\right]=\label{eq:chen837}\\
 & \nabla\cdot\left(T_{w}^{n+1,l+1}\nabla\Phi_{w}^{n+1,l+1}\right)+\frac{q_{ws}^{n+1,l+1}}{B_{w}^{n+1,l+1}}\nonumber 
\end{eqnarray}

\end_inset


\end_layout

\begin_layout Standard
Now we can expand 
\begin_inset Formula 
\begin{equation}
\delta\left(\frac{\phi S_{w}}{B_{w}}\right)=c_{wp}\delta p+c_{wSw}\delta S_{w}\label{eq:chen838}
\end{equation}

\end_inset

where
\begin_inset Formula 
\begin{equation}
c_{wp}=\phi^{0}c_{R}\left(\frac{S_{w}}{B_{w}}\right)^{l}+\left(\phi S_{w}\frac{dB_{w}^{-1}}{dp}\right)^{l}\label{eq:cwp}
\end{equation}

\end_inset


\begin_inset Formula 
\begin{equation}
c_{wSw}=\left(\frac{\phi}{B_{w}}\right)^{l}\label{eq:cwsw}
\end{equation}

\end_inset

And nearly identical for oil:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\delta\left(\frac{\phi S_{o}}{B_{o}}\right)=c_{op}\delta p+c_{oSw}\delta S_{w}\label{eq:chen840}
\end{equation}

\end_inset

where
\begin_inset Formula 
\begin{equation}
c_{op}=\phi^{0}c_{R}\left(\frac{S_{o}}{B_{o}}\right)^{l}+\left(\phi S_{o}\frac{dB_{o}^{-1}}{dp}\right)^{l}\label{eq:cop}
\end{equation}

\end_inset


\begin_inset Formula 
\begin{equation}
c_{oSw}=-\left(\frac{\phi}{B_{o}}\right)^{l}\label{eq:cosw}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
(why minus???)
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
For Iterative IMPES (p.
 307), all the saturation functions 
\begin_inset Formula $k_{rw}$
\end_inset

, 
\begin_inset Formula $k_{ro}$
\end_inset

, 
\begin_inset Formula $p_{cw}$
\end_inset

 are evaluated at the saturation values of the previous time step.
 The fluid formation volume factors and viscosities in the transmissibilities
 and well terms are computed using previous iteration values.
 I guess that in plain IMPES all is evaluated at the previous time step.
 The phase potentials are 
\begin_inset Formula 
\[
\Phi_{\alpha}^{l+1}=p^{l+1}+p_{c\alpha}^{n}-\rho_{\alpha}^{l}\ gz
\]

\end_inset

and the transmissibilities are
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit

\begin_inset Formula 
\[
T_{\alpha}^{l+1}=\frac{k_{r\alpha}^{n}}{\mu_{\alpha}^{l}B_{\alpha}^{l}}K
\]

\end_inset


\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
The flow rates at the wells are
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit

\begin_inset Formula 
\[
q_{ws}^{l+1}=\sum_{j=1}^{N_{w}}\sum_{m=1}^{M_{wj}}WI^{\left(j,m\right)}\frac{k_{rw}^{n}}{\mu_{w}^{l}}\left[\left(p_{bj}^{\left(j\right)}\right)^{l+1}-p^{l+1}-p_{cw}^{n}-\rho_{w}^{l}\ g\left(z_{bj}^{\left(j\right)}-z\right)\right]\delta\left(\mathbf{x}-\mathbf{x}^{\left(j,m\right)}\right)
\]

\end_inset

(In Chen it is not specified where the viscosity is evaluated.)
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
Therefore the potentials and flow rates can be expanded as
\begin_inset Formula 
\begin{equation}
\Phi_{\alpha}^{l+1}=\Phi_{\alpha}^{l}+\delta p\label{eq:chen895}
\end{equation}

\end_inset


\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit

\begin_inset Formula 
\begin{equation}
q_{ws}^{l+1}=q_{ws}^{l}+\sum_{j=1}^{N_{w}}\sum_{m=1}^{M_{wj}}WI^{\left(j,m\right)}\frac{k_{rw}^{n}}{\mu_{w}^{l}}\left[\delta p_{bj}^{\left(j\right)}-\delta p\right]\delta\left(\mathbf{x}-\mathbf{x}^{\left(j,m\right)}\right)\label{eq:chen896}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Inserting (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:chen838"

\end_inset

 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:chen895"

\end_inset

 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:chen896"

\end_inset

) into (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:chen837"

\end_inset

) we arrive to (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:chen897"

\end_inset

) 
\begin_inset Formula 
\begin{eqnarray}
 & \frac{1}{\triangle t}\left[\left(\frac{\phi S_{w}}{B_{w}}\right)^{l}-\left(\frac{\phi S_{w}}{B_{w}}\right)^{n}+c_{wp}\delta p+c_{wSw}\delta S_{w}\right]=\nonumber \\
 & \nabla\cdot\left(T_{w}^{l}\nabla\Phi_{w}^{l}\right)+\nabla\cdot\left(T_{w}^{l}\nabla\left(\delta p\right)\right)\label{eq:chen897}\\
 & +\frac{1}{B_{w}^{l}}\left\{ q_{ws}^{l}+\sum_{j=1}^{N_{w}}\sum_{m=1}^{M_{wj}}WI^{\left(j,m\right)}\frac{k_{rw}}{\mu_{w}}\left[\delta p_{bj}^{\left(j\right)}-\delta p\right]\delta\left(\mathbf{x}-\mathbf{x}^{\left(j,m\right)}\right)\right\} \nonumber 
\end{eqnarray}

\end_inset


\end_layout

\begin_layout Standard
A very similar equation can be obtained for oil (8.98 [or 8.103??] Chen):
\begin_inset Formula 
\begin{eqnarray}
 & \frac{1}{\triangle t}\left[\left(\frac{\phi S_{o}}{B_{o}}\right)^{l}-\left(\frac{\phi S_{o}}{B_{o}}\right)^{n}+c_{op}\delta p+c_{oSw}\delta S_{w}\right]=\label{eq:chen8103-1}\\
 & \nabla\cdot\left(T_{o}^{l}\nabla\Phi_{o}^{l}\right)+\nabla\cdot\left(T_{o}^{l}\nabla\left(\delta p\right)\right)\nonumber \\
 & +\frac{1}{B_{o}^{l}}\left\{ q_{os}^{l}+\sum_{j=1}^{N_{w}}\sum_{m=1}^{M_{wj}}WI^{\left(j,m\right)}\frac{k_{ow}}{\mu_{o}}\left[\delta p_{bj}^{\left(j\right)}-\delta p\right]\delta\left(\mathbf{x}-\mathbf{x}^{\left(j,m\right)}\right)\right\} \nonumber 
\end{eqnarray}

\end_inset


\end_layout

\begin_layout Standard
Multiplying (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:chen897"

\end_inset

) and (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:chen8103-1"

\end_inset

) by 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\triangle t$
\end_inset

 we obtain
\begin_inset Formula 
\begin{equation}
c_{wp}\delta p+c_{wSw}\delta S_{w}=F_{w}\left(\delta p,\delta p_{bh}\right)\label{eq:water-transp3}
\end{equation}

\end_inset


\begin_inset Formula 
\begin{equation}
c_{op}\delta p+c_{oSw}\delta S_{w}=F_{o}\left(\delta p,\delta p_{bh}\right)\label{eq:oil-transp3}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
From the second equation we can obtain
\begin_inset Formula 
\begin{equation}
\delta S_{w}=\frac{F_{o}\left(\delta p,\delta p_{bh}\right)-c_{op}\delta p}{c_{oSw}}\label{eq:deltaSw}
\end{equation}

\end_inset

which substituted into the first one gives
\begin_inset Formula 
\begin{equation}
c_{wp}\delta p+c_{wSw}\frac{F_{o}\left(\delta p,\delta p_{bh}\right)-c_{op}\delta p}{c_{oSw}}=F_{w}\left(\delta p,\delta p_{bh}\right)\label{eq:chen8108}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
Actually we can also say that we can obtain 
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
(
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:chen8108"

\end_inset

) as (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:water-transp3"

\end_inset

) 
\begin_inset Formula $-\frac{c_{wSw}}{c_{oSw}}$
\end_inset


\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
 
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
(
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:oil-transp3"

\end_inset

) 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
.
 Or equivalently we could have worked with 
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
(
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:chen897"

\end_inset

) 
\begin_inset Formula $-\frac{c_{wSw}}{c_{oSw}}$
\end_inset


\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
 
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
(
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:chen8103-1"

\end_inset

) to obtain the expanded form directly.
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
This equation plus the well control equations (sect 8.2.5) are solved implicitly
 to obtain 
\begin_inset Formula $\delta p$
\end_inset

, and 
\begin_inset Formula $\delta p_{bh}$
\end_inset

.
 Then 
\begin_inset Formula $\delta S_{w}$
\end_inset

 is solved explicitly to obtain the water saturation for the next time step.
 
\end_layout

\begin_layout Subsubsection
Expanding (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:chen8108"

\end_inset

)
\end_layout

\begin_layout Standard
For water, from (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:chen897"

\end_inset

) and (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:water-transp3"

\end_inset

)
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{eqnarray*}
F_{w}\left(\delta p,\delta p_{bh}\right) & =\\
 &  & -\left(\frac{\phi S_{w}}{B_{w}}\right)^{l}+\left(\frac{\phi S_{w}}{B_{w}}\right)^{n}+\triangle t\nabla\cdot\left(T_{w}^{l}\nabla\Phi_{w}^{l}\right)+\triangle t\nabla\cdot\left(T_{w}^{l}\nabla\left(\delta p\right)\right)\\
 &  & +\frac{\triangle t}{B_{w}^{l}}\left\{ q_{ws}^{l}+\sum_{j=1}^{N_{w}}\sum_{m=1}^{M_{wj}}WI^{\left(j,m\right)}\frac{k_{rw}}{\mu_{w}}\left[\delta p_{bh}^{\left(j\right)}-\delta p\right]\delta\left(\mathbf{x}-\mathbf{x}^{\left(j,m\right)}\right)\right\} 
\end{eqnarray*}

\end_inset


\end_layout

\begin_layout Standard
For oil, from (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:chen8103-1"

\end_inset

) and (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:oil-transp3"

\end_inset

)
\begin_inset Formula 
\begin{eqnarray*}
F_{o}\left(\delta p,\delta p_{bh}\right) & =\\
 &  & -\left(\frac{\phi S_{o}}{B_{o}}\right)^{l}+\left(\frac{\phi S_{o}}{B_{o}}\right)^{n}+\triangle t\nabla\cdot\left(T_{o}^{l}\nabla\Phi_{o}^{l}\right)+\triangle t\nabla\cdot\left(T_{o}^{l}\nabla\left(\delta p\right)\right)\\
 &  & +\frac{\triangle t}{B_{o}^{l}}\left\{ q_{os}^{l}+\sum_{j=1}^{N_{w}}\sum_{m=1}^{M_{wj}}WI^{\left(j,m\right)}\frac{k_{ro}}{\mu_{o}}\left[\delta p_{bh}^{\left(j\right)}-\delta p\right]\delta\left(\mathbf{x}-\mathbf{x}^{\left(j,m\right)}\right)\right\} 
\end{eqnarray*}

\end_inset


\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $c_{wSw}$
\end_inset

 and 
\begin_inset Formula $c_{wSw}$
\end_inset

 have already been defined in (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:cwp"

\end_inset

) and (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:cwsw"

\end_inset

) and are repeated here for completeness
\begin_inset Formula 
\[
c_{wp}=\phi^{0}c_{R}\left(\frac{S_{w}}{B_{w}}\right)^{l}+\left(\phi S_{w}\frac{dB_{w}^{-1}}{dp}\right)^{l}
\]

\end_inset


\begin_inset Formula 
\[
c_{wSw}=\left(\frac{\phi}{B_{w}}\right)^{l}
\]

\end_inset


\end_layout

\begin_layout Standard
The values for oil are
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula 
\[
c_{op}=\phi^{0}c_{R}\left(\frac{S_{o}}{B_{o}}\right)^{l}+\left(\phi S_{o}\frac{dB_{o}^{-1}}{dp}\right)^{l}
\]

\end_inset


\begin_inset Formula 
\[
c_{oSw}=-\left(\frac{\phi}{B_{o}}\right)^{l}
\]

\end_inset


\end_layout

\begin_layout Standard
Revise if this is valid only for the linear approximation used by Chen or
 if it is valid using second order approximations as in Eclipse.
\end_layout

\begin_layout Standard
In order to rewrite (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:chen8108"

\end_inset

) we split 
\begin_inset Formula 
\[
F_{w}\left(\delta p,\delta p_{bh}\right)=F_{w}^{rhs}+F_{w}^{lhs}\delta p+F_{w}^{w0}+F_{w}^{w1}\delta p+F_{w}^{w2}\delta p_{bh}^{\left(j\right)}
\]

\end_inset

with
\begin_inset Formula 
\begin{equation}
F_{w}^{rhs}=-\left(\frac{\phi S_{w}}{B_{w}}\right)^{l}+\left(\frac{\phi S_{w}}{B_{w}}\right)^{n}+\triangle t\nabla\cdot\left(T_{w}^{l}\nabla\Phi_{w}^{l}\right)\label{eq:Fw_rhs}
\end{equation}

\end_inset


\begin_inset Formula 
\[
F_{w}^{lhs}=\triangle t\nabla\cdot\left(T_{w}^{l}\nabla\left(\right)\right)
\]

\end_inset


\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula 
\begin{equation}
F_{w}^{w0}=\frac{\triangle t}{B_{w}^{l}}q_{ws}^{l}\label{eq:Fw0}
\end{equation}

\end_inset


\begin_inset Formula 
\[
F_{w}^{w1}=-\frac{\triangle t}{B_{w}^{l}}\left\{ \sum_{j=1}^{N_{w}}\sum_{m=1}^{M_{wj}}WI^{\left(j,m\right)}\frac{k_{rw}}{\mu_{w}}\delta\left(\mathbf{x}-\mathbf{x}^{\left(j,m\right)}\right)\right\} =-F_{w}^{w2}
\]

\end_inset


\begin_inset Formula 
\[
F_{w}^{w2}=\frac{\triangle t}{B_{w}^{l}}\left\{ \sum_{j=1}^{N_{w}}\sum_{m=1}^{M_{wj}}WI^{\left(j,m\right)}\frac{k_{rw}}{\mu_{w}}\delta\left(\mathbf{x}-\mathbf{x}^{\left(j,m\right)}\right)\right\} 
\]

\end_inset


\begin_inset Formula $F_{w}^{lhs}$
\end_inset


\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
 is a diffusive term that enters as a Laplacian (integrated by parts in
 FE).
 Note that in the RHS there is a corresponding term that should also be
 integrated by parts.
 (then think what this means for the BCS) 
\end_layout

\begin_layout Standard
Finally we have the well terms, 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $F_{w}^{w1}\delta p$
\end_inset

 and 
\begin_inset Formula $F_{w}^{w2}\delta p_{bh}^{\left(j\right)}$
\end_inset


\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
, that may end up in the RHS or LHS depending on how boundary conditions
 are imposed.
 For the moment Ruben told me he will provide me with the bottom hole pressure.
 Therefore, the term 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $F_{w}^{w2}\delta p_{bh}^{\left(j\right)}$
\end_inset

 ends up in the RHS.
 Otherwise 
\begin_inset Formula $\delta p_{bh}^{\left(j\right)}$
\end_inset

 would be an unknown and we would have to think how to deal which such an
 unknown (that is not nodal) in Alya.
 The term 
\begin_inset Formula $F_{w}^{w1}\delta p$
\end_inset

 is a reactive term that ends up in the LHS.
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula $F_{o}$
\end_inset

 can be treated identically.
 Starting from (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:chen8108"

\end_inset

) we have
\begin_inset Formula 
\[
c_{wp}\delta p+c_{wSw}\frac{F_{o}\left(\delta p,\delta p_{bh}\right)-c_{op}\delta p}{c_{oSw}}=F_{w}\left(\delta p,\delta p_{bh}\right)
\]

\end_inset


\begin_inset Formula 
\[
\left[c_{wp}-c_{op}\frac{c_{wSw}}{c_{oSw}}\right]\delta p+\frac{c_{wSw}}{c_{oSw}}F_{o}\left(\delta p,\delta p_{bh}\right)-F_{w}\left(\delta p,\delta p_{bh}\right)=0
\]

\end_inset

We end up with
\begin_inset Formula 
\begin{eqnarray}
 & -\left[\frac{c_{wSw}}{c_{oSw}}c_{op}-c_{wp}\right]\delta p+\left[\frac{c_{wSw}}{c_{oSw}}F_{o}^{lhs}-F_{w}^{lhs}\right]\delta p\nonumber \\
 & +\left[\frac{c_{wSw}}{c_{oSw}}F_{o}^{w1}-F_{w}^{w1}\right]\delta p\nonumber \\
 & = & -\frac{c_{wSw}}{c_{oSw}}F_{o}^{rhs}+F_{w}^{rhs}-\left[\frac{c_{wSw}}{c_{oSw}}F_{o}^{w2}-F_{w}^{w2}\right]\delta p_{bh}\label{eq:delptap1}\\
 &  & -\left[\frac{c_{wSw}}{c_{oSw}}F_{o}^{w0}-F_{w}^{w0}\right]\nonumber 
\end{eqnarray}

\end_inset

The first line contains two terms.
 The first one is a reactive (or transient) term and the second one is a
 diffusive one.
 The first term disappears in the case of incompressible fluids and the
 equations in Chen CH7 are recovered.
 Note that in such case 
\begin_inset Formula $c_{wp}=c_{op}=0$
\end_inset

 .
 
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
The well terms appear in the second and third lines.
 These terms should not involve much difficulty other than obtaining the
 equivalent radius which determines the well index.
 The well index only depends on constant properties and on the element size.
 The relative permeability and the viscosity are evaluated at the previous
 time step and iteration respectively (see 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:chen896"

\end_inset

) in the iterative IMPES case.
 In the basic IMPES I guess that they are both evaluated at the previous
 time step.
 
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
I guess that since reactive terms appear the use of nodal integration may
 improve the results.
\end_layout

\begin_layout Standard
For the moment we have decided with Ruben that
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
 
\begin_inset Formula $p_{bh}$
\end_inset

 will be known and therefore 
\begin_inset Formula $\delta p_{bh}=0$
\end_inset

 therefore (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:delptap1"

\end_inset

) simplifies to 
\begin_inset Formula 
\begin{eqnarray}
 & -\left[\frac{c_{wSw}}{c_{oSw}}c_{op}-c_{wp}\right]\delta p+\left[\frac{c_{wSw}}{c_{oSw}}F_{o}^{lhs}-F_{w}^{lhs}\right]\delta p\nonumber \\
 & +\left[\frac{c_{wSw}}{c_{oSw}}F_{o}^{w1}-F_{w}^{w1}\right]\delta p\nonumber \\
 & = & -\frac{c_{wSw}}{c_{oSw}}F_{o}^{rhs}+F_{w}^{rhs}-\left[\frac{c_{wSw}}{c_{oSw}}F_{o}^{w0}-F_{w}^{w0}\right].\label{eq:delptap1-1}
\end{eqnarray}

\end_inset

Equation (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Fw0"

\end_inset

) can be expanded as 
\begin_inset Formula 
\begin{equation}
F_{w}^{w0}=\frac{\triangle t}{B_{w}^{l}}q_{ws}^{l}=\frac{\triangle t}{B_{w}^{l}}\left\{ \sum_{j=1}^{N_{w}}\sum_{m=1}^{M_{wj}}WI^{\left(j,m\right)}\frac{k_{rw}}{\mu_{w}}\left[p_{bj}^{\left(j\right)}-p^{l}\right]\delta\left(\mathbf{x}-\mathbf{x}^{\left(j,m\right)}\right)\right\} \label{eq:Fw0-1}
\end{equation}

\end_inset

where 
\begin_inset Formula $p^{l}$
\end_inset

 corresponds to the pressure from the previous iteration in an iterative
 IMPES.
 In a classical IMPES we can use directly the pressure from the previous
 time step.
\end_layout

\begin_layout Subsection
Boundary conditions
\end_layout

\begin_layout Standard
For the Brugge case all the exterior boundary has a no flow BC.
 
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula $\mathbf{u}_{\alpha}=$
\end_inset

0 at the exterior boundaries.
 
\end_layout

\begin_layout Standard
The wells are treated as a volumetric sink or source.
 
\end_layout

\begin_layout Standard
The simplest option is that Repsol should be able to provide the volumetric
 flow for each cell that composes the producers or injectors.
 A more elaborate option is that Repsol provides the bottom hole pressure
 and we use the well equations.
\end_layout

\begin_layout Subsection
Initial conditions
\end_layout

\begin_layout Standard
The initial saturations and pressures (ct.
 = 170) are given.
\end_layout

\begin_layout Subsection
IMPES some further observations on what we understand
\end_layout

\begin_layout Standard
In Chen p24: note that if the saturation Sw is explicitly evaluated, we
 can solve the equation for the pressure.
 After computing the pressure, Sw can be calculated from its equation.
\end_layout

\begin_layout Standard
But then we could think of solving the equation for Sw implicitly or explicitly.
 Check what people do.
 
\end_layout

\begin_layout Itemize
Coutinho (2010) says he uses implicit second order (p8759).
 [reference to Coutinho paper]
\end_layout

\begin_layout Itemize
Chen p266 (Sw is supposed to be known, and the pressure equation is solved
 implicitly).
 The Saturation equation (7.29 Chen) is solved explicitly.
\end_layout

\begin_layout Subsection
Some things to clear out - 27 august 
\end_layout

\begin_layout Itemize
If we look at 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:delptap1"

\end_inset

 it seems that for the pressure equation we are working with the all the
 equation divided by the standard densities.
 Instead in the Saturation equation it seems we are using the equation including
 the standard densities.
 At least this is what we do for the mass matrix.
 Look at por_massma or 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Satur-mass-matrix"

\end_inset

Nevertheless when we go to por_wellte this difference does not appear!!!!!
 I need to understand this better.
 If I look at por_wellte the density does not appear, therefore the Saturation
 equation would be wrong!!! ---- I corrected por_wellte to include 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\rho_{ws}$
\end_inset


\end_layout

\begin_layout Section
Conditions at the well
\end_layout

\begin_layout Subsection
Well index - Adapting Chen to 3D, isotropic in xy, Non Constant k - what
 we need for Brugge
\end_layout

\begin_layout Standard
Here we re-write the 2d isotropic equations adapted to 3D isotropic in xy.
 Note that for the moment we suppose k is constant in space.
 How to deal with variable k is something we still need to understand.
 I start from the 2d equations from Chen and adapt them.
\end_layout

\begin_layout Standard
For each vertical layer 
\begin_inset Formula $M$
\end_inset

 we have 
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\frac{\rho}{\mu}\sum_{K\subset\Omega_{0}}\int_{K}k_{*}\nabla^{*}p\cdot\nabla\varphi_{0}d\mathbf{x}=q_{M}.\label{eq:equiv_radius_prelim1-1-1}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Where 0 refers to the node where the well is located at each vertical layer.
 Obviously it refers to a different node for each vertical layer.
 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $q_{M}$
\end_inset


\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
 is a mass flow rate (
\begin_inset Formula $kg/sec$
\end_inset

).
 The total flow for the well is 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\sum_{m}q_{M}$
\end_inset


\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
.
\end_layout

\begin_layout Standard
(
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:equiv_radius_prelim1-1-1"

\end_inset

)can be written as
\begin_inset Formula 
\[
\frac{\rho}{\mu}\sum_{K\subset\Omega_{0}}\sum_{i=0}^{ncone}\left(\int_{K}k_{*}\nabla^{*}\varphi_{i}\cdot\nabla\varphi_{0}d\mathbf{x}\right)p_{i}=q_{M}
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\frac{\rho}{\mu}\sum_{K\subset\Omega_{0}}\left[\sum_{i=1}^{ncone}\left\{ \left(\int_{K}k_{*}\nabla^{*}\varphi_{i}\cdot\nabla\varphi_{0}d\mathbf{x}\right)p_{i}\right\} +\int_{K}k_{*}\nabla^{*}\varphi_{0}\cdot\nabla\varphi_{0}d\mathbf{x}p_{0}\right]=q_{M}
\]

\end_inset


\begin_inset Formula 
\[
\frac{\rho}{\mu}\sum_{K\subset\Omega_{0}}\left[\sum_{i=1}^{ncone}\left\{ \left(\int_{K}k_{*}\nabla^{*}\varphi_{i}\cdot\nabla\varphi_{0}d\mathbf{x}\right)p_{i}\right\} -\sum_{i=1}^{ncone}\left\{ \int_{K}k_{*}\nabla^{*}\varphi_{i}\cdot\nabla\varphi_{0}d\mathbf{x}p_{0}\right\} \right]=q_{M}
\]

\end_inset


\begin_inset Formula 
\[
\frac{\rho}{\mu}\sum_{K\subset\Omega_{0}}\left[\sum_{i=1}^{ncone}\left\{ \left(\int_{K}k_{*}\nabla^{*}\varphi_{i}\cdot\nabla\varphi_{0}d\mathbf{x}\right)\left(p_{i}-p_{0}\right)\right\} \right]=q_{M}
\]

\end_inset


\begin_inset Formula 
\begin{equation}
-\frac{\rho}{\mu}\sum_{i=1}^{ncone}\left[T_{0i}\left(p_{i}-p_{0}\right)\right]=q_{M}\label{eq:chen1321-2-1}
\end{equation}

\end_inset

with 
\begin_inset Formula 
\[
T_{0i}=-\int_{K}k_{*}\nabla^{*}\varphi_{i}\cdot\nabla\varphi_{0}d\mathbf{x}
\]

\end_inset


\end_layout

\begin_layout Standard
Using the analytic model to find the pressure at a node i we obtain: 
\begin_inset Formula 
\begin{equation}
p_{i}=p_{bh}-\frac{\mu q_{M}}{2\pi k_{*}\rho h_{3}}ln\left(\frac{r_{i}}{r_{w}}\right)\label{eq:chen1323-1-1}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Up to version 2525 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $h_{3}$
\end_inset

 was missing corrected in 2526 both here (and the following equations) and
 in Alya.
 The units of 
\begin_inset Formula $q_{M}$
\end_inset

 are 
\begin_inset Formula $kg/s$
\end_inset

.
 An other option would have been to consider the flow rate per unit length
 and then 
\begin_inset Formula $h_{3}$
\end_inset

 would not have appeared.
 Perhaps this is what led to the error.
 Now, what I still have to decide is how to estimate
\begin_inset Formula $h_{3}$
\end_inset

 in a general case.
 It is easy.
 If it is top or bottom z bottom or top - next point /2.
 Else z point on top - point bellow /2.
 
\end_layout

\begin_layout Standard
Replacing 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:chen1323-1-1"

\end_inset

 into 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:chen1321-2-1"

\end_inset

 we get 
\begin_inset Formula 
\[
-\frac{\rho}{\mu}\sum_{i=1}^{ncone}\left[T_{0i}\left(p_{bh}-\frac{\mu q_{M}}{2\pi k_{*}\rho h_{3}}ln\left(\frac{r_{i}}{r_{w}}\right)-p_{0}\right)\right]=q_{M}
\]

\end_inset

notice that now we have 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $q_{M}$
\end_inset


\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
 in both RHS and LHS.
 We rearrange to:
\begin_inset Formula 
\[
-\frac{\rho}{\mu}\sum_{i=1}^{ncone}\left[T_{0i}\left(p_{bh}-p_{0}\right)\right]+\frac{\rho}{\mu}\frac{\mu q_{M}}{2\pi k_{*}\rho h_{3}}\sum_{i=1}^{ncone}\left[T_{0i}\left(ln\left(\frac{r_{i}}{r_{w}}\right)\right)\right]=q_{M}
\]

\end_inset


\begin_inset Formula 
\[
-\frac{\rho}{\mu}\sum_{i=1}^{ncone}\left[T_{0i}\left(p_{bh}-p_{0}\right)\right]=q_{M}\left\{ 1-\frac{1}{2\pi k_{*}h_{3}}\sum_{i=1}^{ncone}\left[T_{0i}\left(ln\left(\frac{r_{i}}{r_{w}}\right)\right)\right]\right\} 
\]

\end_inset


\begin_inset Formula 
\[
q_{M}=\frac{2\pi k_{*}h_{3}\rho}{\mu}\frac{-\sum_{i=1}^{ncone}\left[T_{0i}\right]}{2\pi k_{*}h_{3}-\sum_{i=1}^{ncone}T_{0i}ln\left(r_{i}\right)+\sum_{i=1}^{ncone}T_{0i}ln\left(r_{w}\right)}\left(p_{bh}-p_{0}\right)
\]

\end_inset


\begin_inset Formula 
\[
q_{M}=\frac{2\pi k_{*}h_{3}\rho}{\mu}\frac{1}{\frac{-2\pi k_{*}h_{3}+\sum_{i=1}^{ncone}T_{0i}ln\left(r_{i}\right)}{\sum_{i=1}^{ncone}\left[T_{0i}\right]}-\frac{\sum_{i=1}^{ncone}T_{0i}ln\left(r_{w}\right)}{\sum_{i=1}^{ncone}\left[T_{0i}\right]}}\left(p_{bh}-p_{0}\right)
\]

\end_inset


\begin_inset Formula 
\[
q_{M}=\frac{2\pi k_{*}h_{3}\rho}{\mu}\frac{1}{ln\left(r_{e}^{M}\right)-ln\left(r_{w}\right)}\left(p_{bh}-p_{0}\right)
\]

\end_inset


\begin_inset Formula 
\begin{equation}
q_{M}=\frac{2\pi k_{*}h_{3}\rho}{\mu}\frac{1}{ln\left(\frac{r_{e}^{M}}{r_{w}}\right)}\left(p_{bh}-p_{0}\right)\label{eq:chen1325-1-1}
\end{equation}

\end_inset

where 
\begin_inset Formula 
\[
r_{e}=exp\left(\frac{-2\pi k_{*}h_{3}+\sum_{i=1}^{ncone}T_{0i}ln\left(r_{i}\right)}{\sum_{i=1}^{ncone}T_{0i}}\right)
\]

\end_inset

Now we have perme multiplying 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $2\pi$
\end_inset

.

\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
 This was missing up to Alya 2487.
 !!!!!!!!!!!!!!!!!!!!!!!!
\end_layout

\begin_layout Standard
Obviously we can define the well index
\begin_inset Formula 
\[
WI^{M}=\frac{2\pi k_{*}h_{3}}{ln\left(\frac{r_{e}^{M}}{r_{w}}\right)}
\]

\end_inset

and then rewrite (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:chen1325-1-1"

\end_inset

) as
\begin_inset Formula 
\[
q_{M}=\frac{\rho}{\mu}WI^{M}\left(p_{bh}-p_{0}\right).
\]

\end_inset


\end_layout

\begin_layout Standard
This equation is similar to eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:wellindex"

\end_inset

 introduced in the the first section.
 But here we are obviously dealing with only one well.
\end_layout

\begin_layout Standard
The previous equation is for single phase flow.
 In the case of multiphase flow the well index does not change.
 and the flow rate for each phase is given by Eq.
 13.18 Chen 
\begin_inset Formula 
\begin{equation}
q_{M}^{\alpha}=\frac{\rho_{\alpha}k_{r\alpha}}{\mu_{\alpha}}WI^{M}\left(p_{bh}-p_{0}^{\alpha}\right).\label{eq:well_flow_rate_alpha}
\end{equation}

\end_inset


\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $k_{r\alpha}$
\end_inset

 has been defined in Chen 2.38 as 
\begin_inset Formula 
\[
k_{r\alpha}=\frac{\mathbf{k}_{\alpha}}{\mathbf{k}}.
\]

\end_inset


\end_layout

\begin_layout Standard
Beware that in this case 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $T_{0i}$
\end_inset

 is obtained using
\begin_inset Formula $\nabla^{*}$
\end_inset

.
 If we have variable 
\begin_inset Formula $k_{*}$
\end_inset

 surrounding the node.
 I do not know how to correctly deal with the problem.
 The flow will not be radial.
 In such case everything will be very approximate.
 This well models seem to be a poor approximation.
 What I will do is average 
\begin_inset Formula $k_{*}$
\end_inset

 from all surrounding elements and use that value to calculate the equivalent
 radius.
 Finally I believe I have not done that.
 I just used 
\begin_inset Formula $k_{*}$
\end_inset

 of each element.
\end_layout

\begin_layout Standard
Further thoughts about non constant 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $k_{*}$
\end_inset


\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
: The finite elements surrounding a node do not need to have the same 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $k_{*}$
\end_inset

.
 This also happens with k in the isotropic case.
 In Section 13.3 Chen supposes they are the same for all surrounding elements.
 If this is not the case I do no know how to handle it.
 Actually I believe it would not be possible to obtain an analytic solution
 for that case.
 One way would be to use an average porosity from all the surrounding elements.
 Depending on how much the properties change this could be a poor solution.
 One good solution could be to use the divisor as I had thought before in
 this case all surrounding elements would have the same properties.
 Notice that in 
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
in Chen page 825 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\bar{k}$
\end_inset

, an 
\family default
\series default
\shape default
\size default
\emph on
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
average
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
 of k at the well, is used.
 Therefore, it seems that Chen's strategy is also to use an average value.
 
\end_layout

\begin_layout Subsubsection
Well constraints
\end_layout

\begin_layout Standard
Chen 13.6
\end_layout

\begin_layout Standard
\begin_inset Formula $P_{bh}$
\end_inset

 given: this seem to be the simplest case.
 
\end_layout

\begin_layout Standard
Missing: see the case for a water injector.
\end_layout

\begin_layout Subsection
Prescribing the flow rate
\begin_inset CommandInset label
LatexCommand label
name "sub:Prescribing-the-flow"

\end_inset


\end_layout

\begin_layout Standard
From 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:chen1325-1-1"

\end_inset

 we see that for 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $p_{bh}>p_{0}$
\end_inset

 we are injecting fluid into de reservoir.
 Therefore a positive 
\begin_inset Formula $q$
\end_inset

 means fluid injected into the reservoir and a negative one fluid produced
 by the reservoir.
 
\end_layout

\begin_layout Standard
Prescribing the flow rate is straightforward as we already have 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $q_{M}^{w}$
\end_inset

 or 
\begin_inset Formula $q_{M}^{total}$
\end_inset

.
 In the water saturation equation what we have to put in the RHS is 
\begin_inset Formula $q_{M}^{w}$
\end_inset

 , the mass flow rate.
 Therefore if Ruben gives me this I put it directly.
 
\end_layout

\begin_layout Itemize
For the water saturation equation in the RHS we have 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $q_{M}^{w}$
\end_inset

, the mass flow rate.
 
\end_layout

\begin_layout Itemize
For the pressure equation 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:chen8108"

\end_inset

 ( divided by 
\begin_inset Formula $\triangle t$
\end_inset

 ) in the RHS we have 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\left[-\frac{c_{wSw}}{c_{oSw}}\frac{q_{os}}{B_{o}}+\frac{q_{ws}}{B_{w}}\right]$
\end_inset

 --------------the volumetric flow rate is used .
 Notice that 
\begin_inset Formula $q_{w}=\frac{q_{ws}\rho_{ws}}{B_{w}}$
\end_inset

 therefore 
\begin_inset Formula $\frac{q_{ws}}{B_{w}}=\frac{q_{w}}{\rho_{ws}}$
\end_inset

.
 Since we are given 
\begin_inset Formula $q_{M}^{total}$
\end_inset

 from which we can obtain 
\begin_inset Formula $q_{M}^{w}$
\end_inset

 and 
\begin_inset Formula $q_{M}^{o}$
\end_inset

 what we will impose is 
\begin_inset Formula $-\frac{c_{wSw}}{c_{oSw}}\frac{q_{o}}{\rho_{os}}+\frac{q_{w}}{\rho_{ws}}$
\end_inset

 
\end_layout

\begin_layout Subsubsection

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
Injector water flow rate ( kfl_wellc_por(jwell) = 1)
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
Typically we will have the water flow rate at an injector (there it will
 have a positive sign) and there 
\begin_inset Formula $q_{M}^{w}=q_{M}^{total}$
\end_inset

 and 
\begin_inset Formula $q_{M}^{o}=0$
\end_inset

 .
 
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
Therefore for saturation equation we impose 
\begin_inset Formula $q_{M}^{w}$
\end_inset

 .
 
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
For the pressure equation 
\begin_inset Formula $\frac{q_{w}}{\rho_{ws}}$
\end_inset

 .
 Here the notation is a bit confusing but 
\begin_inset Formula $q_{M}^{w}=q_{w}$
\end_inset

 at some point we should clean up.
\end_layout

\begin_layout Subsubsection

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
Injector total flow rate ( kfl_wellc_por(jwell) = 1)
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
In this case we impose the total flow rate.
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
For the Saturation equation we need the water flow rate.
 We know that the total flow rate
\begin_inset Formula 
\[
q_{M}^{total}=q_{M}^{w}+q_{M}^{o}=\left\{ \frac{\rho_{w}k_{rw}}{\mu_{w}}+\frac{\rho_{o}k_{ro}}{\mu_{o}}\right\} WI^{M}\left(p_{bh}-p_{0}\right)
\]

\end_inset

Where in the cases with 
\begin_inset Formula $p_{c}=0$
\end_inset

 , 
\begin_inset Formula $p_{0}$
\end_inset

 is the same for both phases.
 Then if we want to obtain the flow rate for the water phase we have 
\begin_inset Formula 
\[
q_{M}^{w}=q_{M}^{total}\frac{\frac{\rho_{w}k_{rw}}{\mu_{w}}}{\frac{\rho_{w}k_{rw}}{\mu_{w}}+\frac{\rho_{o}k_{ro}}{\mu_{o}}}
\]

\end_inset


\end_layout

\begin_layout Standard
For the pressure equation 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula 
\[
-\frac{c_{wSw}}{c_{oSw}}\frac{q_{o}}{\rho_{os}}+\frac{q_{w}}{\rho_{ws}}
\]

\end_inset


\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula 
\[
-\frac{c_{wSw}}{c_{oSw}}\frac{q_{M}^{total}\frac{\frac{\rho_{o}k_{ro}}{\mu_{o}}}{\frac{\rho_{w}k_{rw}}{\mu_{w}}+\frac{\rho_{o}k_{ro}}{\mu_{o}}}}{\rho_{os}}+\frac{q_{M}^{total}\frac{\frac{\rho_{w}k_{rw}}{\mu_{w}}}{\frac{\rho_{w}k_{rw}}{\mu_{w}}+\frac{\rho_{o}k_{ro}}{\mu_{o}}}}{\rho_{ws}}
\]

\end_inset


\begin_inset Formula 
\[
q_{M}^{total}\left[-\frac{c_{wSw}}{c_{oSw}}\frac{\frac{\frac{\rho_{os}k_{ro}}{B_{o}\mu_{o}}}{\frac{\rho_{w}k_{rw}}{\mu_{w}}+\frac{\rho_{o}k_{ro}}{\mu_{o}}}}{\rho_{os}}+\frac{\frac{\frac{\rho_{ws}k_{rw}}{B_{w}\mu_{w}}}{\frac{\rho_{w}k_{rw}}{\mu_{w}}+\frac{\rho_{o}k_{ro}}{\mu_{o}}}}{\rho_{ws}}\right]
\]

\end_inset


\begin_inset Formula 
\[
q_{M}^{total}\frac{1}{\frac{\rho_{w}k_{rw}}{\mu_{w}}+\frac{\rho_{o}k_{ro}}{\mu_{o}}}\left[-\frac{c_{wSw}}{c_{oSw}}\frac{k_{ro}}{B_{o}\mu_{o}}+\frac{k_{rw}}{B_{w}\mu_{w}}\right]
\]

\end_inset


\end_layout

\begin_layout Standard
where 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula 
\[
-\frac{c_{wSw}}{c_{oSw}}=\frac{B_{o}}{B_{w}}
\]

\end_inset

Therefore
\begin_inset Formula 
\[
q_{M}^{total}\frac{1}{\frac{\rho_{w}k_{rw}}{\mu_{w}}+\frac{\rho_{o}k_{ro}}{\mu_{o}}}\frac{1}{B_{w}}\left[\frac{k_{ro}}{\mu_{o}}+\frac{k_{rw}}{\mu_{w}}\right]
\]

\end_inset


\end_layout

\begin_layout Subsection
Alya datafile well
\end_layout

\begin_layout Standard
For each well define its I,J value.
 If the well changes in z we should also take this into account - check
 how.
 But for the moment I believe this does not happen.
 Finally we should build some kind of table for the flow rate as a function
 of time.
 This is for the moment what we have arranged with Ruben.
 Beware since the wells are now at the node not element we could have a
 case where some of elements surrounding the node reach one vertical depth
 and the other another one.
 Think how we would deal with such scenario.
 Discuss with ruben.
 
\end_layout

\begin_layout Standard
For each well we shall have an evolution of Pbh as a function of time.
 So we have 
\color blue
mtist_wel_por
\color inherit
.
 Maximum time steps for all the wells.
 
\color blue
nwell
\color inherit
 (I guess for the moment we shall treat injectors and well in the same way
 so this includes both wells and injectors).
 
\color blue
Pboth(2,mtist_wel_por,nwell,2).
 nstep(nwell)
\end_layout

\begin_layout Subsubsection
Chen 13.6
\end_layout

\begin_layout Standard
For an injector he says we can have two options:
\end_layout

\begin_layout Enumerate
prescribe 
\begin_inset Formula $P_{bh}$
\end_inset

this is the case I have already studied.
 We obtain the flow rate using the well index.
 
\begin_inset Formula $q_{\alpha}=WI\frac{\rho_{\alpha}k_{r\alpha}}{\mu_{\alpha}}(p_{bh}-......)$
\end_inset


\end_layout

\begin_layout Enumerate
Prescribe 
\begin_inset Formula $Q_{w}$
\end_inset

in this case if we want to obtain 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $p_{bh}$
\end_inset

 we work with the same formula but with 
\begin_inset Formula $k_{r\alpha max}$
\end_inset


\end_layout

\begin_layout Standard
For a well we have the previous two options plus a third possibility of
 fixing the total flow rate.
\end_layout

\begin_layout Standard
He does not mention anything on how to distribute the flow rate vertically
 in a 3D case.
\end_layout

\begin_layout Subsubsection
Por datfile: well format up to Alya 2526
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

  INFORMATION_WELL, NUMBER_OF_WELLS=2, MAX_ROWS=201
\end_layout

\begin_layout Plain Layout

    WELL_NUMBER=-1, WELL_RADIUS=0.1, NROWS=201
\end_layout

\begin_layout Plain Layout

       INCLUDE  ../mesh/2/pr_I01.txt
\end_layout

\begin_layout Plain Layout

    END_WELL_NUMBER
\end_layout

\begin_layout Plain Layout

    WELL_NUMBER= 2, WELL_RADIUS=0.1, NROWS=201
\end_layout

\begin_layout Plain Layout

       INCLUDE  ../mesh/2/pr_W02.txt
\end_layout

\begin_layout Plain Layout

    END_WELL_NUMBER
\end_layout

\begin_layout Plain Layout

  END_INFORMATION_WELL 
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
New Por datfile: well format after Alya 2526
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

  INFORMATION_WELL, NUMBER_OF_WELLS=2, MAX_ROWS=201, MAX_HEIGHT=6
\end_layout

\begin_layout Plain Layout

    WELL_NUMBER=-1, WELL_RADIUS=0.1, NROWS=201, NHEIG=6, CONDITION:WATER_FLOW
 or 
\end_layout

\begin_layout Plain Layout

                TOTAL_FLOW or PBH or PBH_MIDDLE(this was the only option
 in 2526)
\end_layout

\begin_layout Plain Layout

       INCLUDE  ../mesh/2/pr_I01.txt
\end_layout

\begin_layout Plain Layout

    END_WELL_NUMBER
\end_layout

\begin_layout Plain Layout

    WELL_NUMBER= 2, WELL_RADIUS=0.1, NROWS=201
\end_layout

\begin_layout Plain Layout

       INCLUDE  ../mesh/2/pr_W02.txt
\end_layout

\begin_layout Plain Layout

    END_WELL_NUMBER
\end_layout

\begin_layout Plain Layout

  END_INFORMATION_WELL 
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The new things I add are: 
\end_layout

\begin_layout Itemize
NHEIG.
 the number of nodes in the vertical direction for the well.
\end_layout

\begin_layout Itemize
CONDITION: the condition I want to apply at the well.
 It can be the water or total flow rate.
 Positive enters the reservoir - negative leaves the reservoir.
 (see 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Prescribing-the-flow"

\end_inset

).
 PBH (given at each node in the well).
 PBH_MIDDLE (given just at mid-height an alya estimates the rest of the
 values - the only option I had up to 2526
\end_layout

\begin_layout Itemize
MAX_HEIGHT: Max.
 Number of nodes per well
\end_layout

\begin_layout Standard
REMARK: here we should give the mass flow rate.
 Ruben gives me volume flow rate (std m3/day) so I should multiply by water
 or oil standard density.
 OJO Aca inicialmenet pense que tenia que multipliacr por DENS_WAT= 1002.7623
 o DENS_OIL= 897.0286.
 Pero luego de pensarlo un poc no estoy tan seguro.
 Entre en duda si estas son als densidades STD o a la presion de referncia.
 Que creo no es lo mismo o si.
\end_layout

\begin_layout Standard
Si son std m3 habrái que multiplicar por la dens a presion std que no se
 si al tengo!!!!!!!!!!!!!! Po ahora voy a multiplicar por DENS_WAT= 1002.7623
 o DENS_OIL= 897.0286 pero luego hay que pensar mejor.
 
\end_layout

\begin_layout Subsection
Well output
\end_layout

\begin_layout Standard
Here I explain the information we output for the wells.
 Basically Pbh, Q, perhaps also well index.
 I will implement this in por_outwel
\end_layout

\begin_layout Subsubsection
Pbh prescribed cases (kfl_wellc_por(iwell) == 3 or 4)
\end_layout

\begin_layout Standard
In por_wellte we have already calculated dataw_por(iheiw,iwell) with the
 value of Pbh.
 Then we can calculate
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula 
\[
q_{M}^{w}=\frac{\rho_{w}k_{rw}}{\mu_{w}}WI^{M}\left(p_{bh}-p_{0}\right)
\]

\end_inset


\begin_inset Formula 
\[
q_{M}^{o}=\frac{\rho_{o}k_{ro}}{\mu_{o}}WI^{M}\left(p_{bh}-p_{0}\right)
\]

\end_inset


\end_layout

\begin_layout Subsubsection
Total flow rate prescribed (kfl_wellc_por(iwell) == 2)
\end_layout

\begin_layout Standard
I this case in dataw_por(iheiw,iwell) we have the total flow rate 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula 
\[
q_{M}^{total}=q_{M}^{w}+q_{M}^{o}=\left\{ \frac{\rho_{w}k_{rw}}{\mu_{w}}+\frac{\rho_{o}k_{ro}}{\mu_{o}}\right\} WI^{M}\left(p_{bh}-p_{0}\right)
\]

\end_inset

 we can then obtain 
\begin_inset Formula 
\[
p_{bh}=p_{0}+q_{M}^{total}\frac{1}{\left\{ \frac{\rho_{w}k_{rw}}{\mu_{w}}+\frac{\rho_{o}k_{ro}}{\mu_{o}}\right\} WI^{M}}
\]

\end_inset

and 
\begin_inset Formula 
\[
q_{M}^{w}=q_{M}^{total}\left\{ \frac{\frac{\rho_{w}k_{rw}}{\mu_{w}}}{\frac{\rho_{w}k_{rw}}{\mu_{w}}+\frac{\rho_{o}k_{ro}}{\mu_{o}}}\right\} 
\]

\end_inset


\begin_inset Formula 
\[
q_{M}^{o}=q_{M}^{total}\left\{ \frac{\frac{\rho_{o}k_{ro}}{\mu_{o}}}{\frac{\rho_{w}k_{rw}}{\mu_{w}}+\frac{\rho_{o}k_{ro}}{\mu_{o}}}\right\} 
\]

\end_inset


\end_layout

\begin_layout Subsubsection
Water flow rate prescribed (kfl_wellc_por(iwell) == 1)
\end_layout

\begin_layout Standard
I this case in dataw_por(iheiw,iwell) we have the water flow rate.
 Moreover we know the oil flow rate is zero and 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula 
\[
q_{M}^{total}=q_{M}^{w}=\frac{\rho_{w}k_{rw}}{\mu_{w}}WI^{M}\left(p_{bh}-p_{0}\right)
\]

\end_inset

 
\begin_inset Formula 
\[
p_{bh}=p_{0}+q_{M}^{total}\frac{1}{\frac{\rho_{w}k_{rw}}{\mu_{w}}WI^{M}}
\]

\end_inset


\end_layout

\begin_layout Subsection
How are the position of the well given
\end_layout

\begin_layout Standard
Given in dom dat.
 In por_iniunk it is passed to iwell_por & iheip_por
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

  FIELD= 4, DIMENSION= 2, NODE 
\end_layout

\begin_layout Plain Layout

	INCLUDE ../mesh/well.txt 
\end_layout

\begin_layout Plain Layout

  END_FIELD 
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The first column is the number of node.
\end_layout

\begin_layout Standard
The second column is 0 if it is not a well or injector.
 A positive number if it is a well a negative one if it is an injector.
 Stored in iwell_por(npoin).
\end_layout

\begin_layout Standard
The third column is a number from 1 to NHEIG that indiactes at which vertical
 position the node is found (new in alya 2670).
 Stored in iheip_por(npoin).
 
\end_layout

\begin_layout Subsection
Well index , production index , Peaceman -- Eclipse manual
\end_layout

\begin_layout Standard
p1189 -Technical Eclipse .
 It is slightly different in 100 and 300.
 for 100:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
q_{p,j}=T_{wj}M_{p,j}\left(P–P_{w}–H_{wj}\right)
\]

\end_inset


\end_layout

\begin_layout Standard
for 300:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\hat{q}_{p,j}=T_{wj}\frac{k_{rp,j}}{\mu_{p,j}}\left(P–P_{w}–H_{wj}\right)
\]

\end_inset


\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula $T_{wj}\frac{k_{rp,j}}{\mu_{p,j}}$
\end_inset

is what is called the productivity index or well index.
 It is calculated using Peaceman formula.
\end_layout

\begin_layout Standard
In Chen the name well index is used for example in eq.
 13.13.
 
\end_layout

\begin_layout Standard
The productivity index J Eq 78.58 Tech-Eclipse is not exactly the same it
 depends on the pressure at drainage.
 'As the drainage radius is often known with a poor degree of accuracy'
 (p 1206) A different production index eq 78.60 that should be regarded as
 the PI of the well within its connecting grid blocks rather than within
 its drainage region is used!!!!
\end_layout

\begin_layout Standard
In any case Ruben told me that Eclipse(100 or 300 se which they are using)
 can give you 
\begin_inset Formula $q_{p,j}$
\end_inset

 as a function of time for each cell.
 This (corrected to the corresponding conditions) is what I plan to give
 to Alya.
\end_layout

\begin_layout Standard
From p1189 - Technical Eclipse: Hwj is the well bore pressure head between
 the connection and the well’s bottom hole datum depth.
 Pw + Hwj is thus the pressure in the well at the connection j, which we
 call the “connection pressure”.
 Esto Ruben me dijo lo ponen a cero
\end_layout

\begin_layout Standard
Hable con ruben me dijo que la Pbh es eefctivamenet en el bottom.
 O sea que si me dice 170 y hay una pres hidros de aprox 30 (eso me daba
 en eun caso con 265 de h vert) en la parte de arriba es 140.
\end_layout

\begin_layout Subsection
Peaceman for Fe Chen.
 
\end_layout

\begin_layout Standard
Notice that in Chen's FE model the well is located at a FE node.
 This is not our case so I am not sure how valid his approach shall be.
 One option would be to construct a dual mesh but I think it would be too
 complicated!!!!!!!!!
\end_layout

\begin_layout Standard
Actually I think this is the reason why Chen thinks of the injected flow
 rate a value at a point (notice that he uses a delta Dirac) and I tend
 to think it as a volumetric source spread in the element.
 
\end_layout

\begin_layout Standard
Ruben said we can put the well at any of the i,j ; i+1,j ; i,j+1 or i+1,j+1
 nodes.
 He will tell me which.
 He does not expect much difference.
\end_layout

\begin_layout Section
Properties
\end_layout

\begin_layout Subsection
Oil and water 
\end_layout

\begin_layout Standard
For example for water 
\end_layout

\begin_layout Standard
1) Reference pressure 
\begin_inset Formula $P_{ref}=170$
\end_inset


\end_layout

\begin_layout Standard
2) Water formation volume factor at the reference pressure, 
\begin_inset Formula $B_{w}(P_{ref})=0.9927$
\end_inset

 the units are 
\begin_inset Formula $rm^{3}/sm^{3}$
\end_inset

 (real over standard).
 Actually I understand it just gives the density.
 Analyze exactly how.
 Page 13 Chen 
\begin_inset Formula 
\[
\rho=\frac{\rho_{s}}{B}
\]

\end_inset


\end_layout

\begin_layout Standard
The formation volume factor is defined in page 12 as
\begin_inset Formula 
\begin{equation}
B\left(p,T\right)=\frac{V\left(p,T\right)}{V_{s}}\label{eq:Balpha}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
3) Water compressibility 
\begin_inset Formula $c_{w}=4.3511e-5=-\left(\frac{\partial B_{w}}{\partial P}\right)/B_{w}$
\end_inset

.
 Beware I believe that this formula is written incorrectly in Chen (without
 the -) .
 The minus sign must be there if is is a positive value as seen en the book
 and the data Ruben gave me.
 The the minus comes from the fact as the pressure increases Bw decreases.
 I found some course note that I saved in biblio/temas/porous/general/Chapter2
 where the minus is correctly introduced!!!!!!!!!!!!! A similar error can
 be found for the rock compressibility 2.17 3.16 and 3.17 in Chen where the
 minus is also missing.
 Note that as the pressure increases the porosity must decrease.
 And therefore we need the minus!!!!!!!!.
 Ojo tal ves lo de rock este ok la pression esta dentro de los poros y si
 aumenta los hace crecer no reducirse con lo cual lo de rock compressibility
 estaría ok.
\end_layout

\begin_layout Standard
4) Water viscosity at reference pressure 
\begin_inset Formula $\mu_{w}=0.320$
\end_inset

 .
 For the Brugge case it is constant.
\end_layout

\begin_layout Standard
Eclipse 100 calculates 
\begin_inset Formula 
\[
B_{w}(P)=\frac{B_{w}(P_{ref})}{1+X+\left(X^{2}/2\right)}
\]

\end_inset

with
\begin_inset Formula 
\[
X=c_{w}\left(P-P_{ref}\right)
\]

\end_inset


\end_layout

\begin_layout Standard
The density is calculated using B
\begin_inset Formula 
\[
\rho=\frac{\rho_{STD}}{B}=\frac{\rho_{ref}B_{ref}}{B}=\frac{\rho_{ref}B_{ref}}{\frac{B_{ref}}{1+X+X^{2}/2}}=\rho_{ref}\left(1+X+X^{2}/2\right)
\]

\end_inset


\end_layout

\begin_layout Standard
So finally the density depends on the pressure.
\end_layout

\begin_layout Standard
We also have density of oil and water at surface conditions.
 I do not know were I would use this.
\end_layout

\begin_layout Subsection
Rock properties
\end_layout

\begin_layout Standard
Table KRw(Sw) and KROw(Sw) [oil relative permeability when only oil and
 water are present] for different materials.
\end_layout

\begin_layout Standard
There is a constant rock compressibility for all the reservoir.
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
V(P)=V(Pref)\left[1+X+\frac{X^{2}}{2}\right]
\]

\end_inset


\begin_inset Formula 
\[
X=c_{r}\left(P-P_{ref}\right)
\]

\end_inset


\end_layout

\begin_layout Subsection
Elemental properties
\end_layout

\begin_layout Itemize
NTG used to convert from gross to net thicknesses, and act as multipliers
 of grid block pore volumes and transmissibilities in the X and Y directions,
 and also on DZ for the calculation of well connection transmissibility
 factors.
 I believe that it is used to obtain the real porosity, multiplying porosity
 by NTG.
\end_layout

\begin_layout Itemize
PORO
\end_layout

\begin_layout Itemize
PERM
\end_layout

\begin_layout Section
Velocity post processing 
\end_layout

\begin_layout Standard
For the moment I can start with a simple projection using lumped mass matrix.
 Correa & Loula 2007 say it is very accurate for linear elements, p 7.
 
\end_layout

\begin_layout Standard
More elaborate options would be:
\end_layout

\begin_layout Subsection
Loula Cmame 99 p 339
\end_layout

\begin_layout Standard
Beware it is for incompressible flow.
 But I believe we can adapt it to slightly compressible.
\end_layout

\begin_layout Standard
See end page 343.
 Equal interpolation vel and press.
 
\begin_inset Formula $\delta=O\left(h\right)$
\end_inset

.
 The equation to be solved for the post-processed velocity is 31
\begin_inset Formula 
\[
\left(A^{-1}\left(c^{n}\right)\mathbf{u}_{p}^{n}+\nabla p_{h}^{n},v_{h}\right)+\delta\left(div\mathbf{u}_{p}^{n}-f^{n},div\: v_{h}\right)=0
\]

\end_inset


\end_layout

\begin_layout Standard
Which can be rewritten as in 32 where the pressure gradient term is integrated
 by parts.
\end_layout

\begin_layout Standard
A has been defined in eq 2 as 
\begin_inset Formula 
\[
A=\frac{K\left(x\right)}{\mu\left(c\right)}
\]

\end_inset


\end_layout

\begin_layout Standard
Note that if 
\begin_inset Formula 
\[
\delta=0
\]

\end_inset

 it is just a projection.
 It could be done with lumped or consistent mass matrix.
 A final option would be to use a non projected velocity (the pressure gradient)
 directly in the saturation equations.
\end_layout

\begin_layout Standard
In this paper I did not find the exact definition of 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\delta$
\end_inset

.
 Read in more detail.
\end_layout

\begin_layout Subsection
Other papers
\end_layout

\begin_layout Standard
In Barbosa 09 two other paper are mentioned
\end_layout

\begin_layout Standard
[5] S.M.C.
 Malta and A.F.D.
 Loula.
 Numerical analysis of the finite element methods for miscible displacement
 in porous media.
 Numerical Method for Partial Differential Equations, 14:519– 548, 1998.
 (found)
\end_layout

\begin_layout Standard
[6] S.M.C.
 Malta, A.F.D.
 Loula, and E.L.M.
 Garcia.
 A post-processing technique to approximate the velocity field in miscible
 displacement simulations.
 Contemporary Mathematics, 8:239– 268, 1995.
\end_layout

\begin_layout Standard
Searching the web I found sandra_malta_98.pdf.
 It seem quite interesting.
 It talks about post-processing eqs 3.14-3.15.
 Close to 3.27 she says tau is calculated as C*h but she does not give the
 value for C.
 Moreover in 3.14 we should pay more attention to M and its equivalent in
 2 phase flow since this paper is for miscible displacements.
 She also has a section called removal of singularities (it is what we call
 well modeling) where she cites o paper by Douglas 81 & 83 ( Ewing is a
 coauthor) I has been quite difficult to understand what she wrote.
 It is important to understand how the well enter in the velocity post-processin
g.
\end_layout

\begin_layout Standard
Note that Chen also references Ewing, but a 99 paper, in well modeling.
 I have downloaded Ewing 99.
\end_layout

\begin_layout Standard
Ewing 99 - develops equations for isotropic single phase flow with constant
 coefficient (p187) He presents the derivation square for bilinear Galerkin
 FE.
 He also deals with mixed triangular FE.
 in the conclusions he mentions 'there has been limited work (for wells)
 for simulations based on FE'.
 
\end_layout

\begin_layout Standard
Correa & Loula 2007 stabilized ...
 fin p7 L2 smoothing of kgrap very accurate with lin o bilinear elements.
\end_layout

\begin_layout Section
Finite element discretization
\end_layout

\begin_layout Subsection
Pressure equation
\end_layout

\begin_layout Standard
At this point we shall present some details on how the discretization of
 the equation for the pressure increment (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:delptap1-1"

\end_inset

) is performed.
 We deal with each of the terms separately.
\begin_inset Formula 
\[
-\left[\frac{c_{wSw}}{c_{oSw}}c_{op}-c_{wp}\right]\delta p+\left[\frac{c_{wSw}}{c_{oSw}}F_{o}^{lhs}-F_{w}^{lhs}\right]\delta p+\left[\frac{c_{wSw}}{c_{oSw}}F_{o}^{w1}-F_{w}^{w1}\right]\delta p=-\frac{c_{wSw}}{c_{oSw}}F_{o}^{rhs}+F_{w}^{rhs}-\left[\frac{c_{wSw}}{c_{oSw}}F_{o}^{w0}-F_{w}^{w0}\right]
\]

\end_inset


\end_layout

\begin_layout Subsubsection
Volume mass matrix
\end_layout

\begin_layout Standard
It corresponds to the term 
\begin_inset Formula 
\[
-\left[\frac{c_{wSw}}{c_{oSw}}c_{op}-c_{wp}\right]\delta p
\]

\end_inset


\end_layout

\begin_layout Standard
This term presents no difficulty after multiplying by a test function and
 discretizing with finite element functions we end up with 
\begin_inset Formula 
\[
{\displaystyle \int}-\left[\frac{c_{wSw}}{c_{oSw}}c_{op}-c_{wp}\right]N_{I}N_{J}d\Omega\:\delta P_{J}
\]

\end_inset


\end_layout

\begin_layout Standard
using (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:cwp"

\end_inset

,
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:cop"

\end_inset

,
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:cwsw"

\end_inset

,
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:cosw"

\end_inset

) that we repeat here to simplify the presentation 
\begin_inset Formula 
\[
c_{wp}=\phi^{0}c_{R}\left(\frac{S_{w}}{B_{w}}\right)^{l}+\left(\phi S_{w}\frac{dB_{w}^{-1}}{dp}\right)^{l}
\]

\end_inset


\begin_inset Formula 
\[
c_{wSw}=\left(\frac{\phi}{B_{w}}\right)^{l}
\]

\end_inset


\begin_inset Formula 
\[
c_{op}=\phi^{0}c_{R}\left(\frac{S_{o}}{B_{o}}\right)^{l}+\left(\phi S_{o}\frac{dB_{o}^{-1}}{dp}\right)^{l}
\]

\end_inset


\begin_inset Formula 
\[
c_{oSw}=-\left(\frac{\phi}{B_{o}}\right)^{l}
\]

\end_inset

In the properties section we have seen that 
\begin_inset Formula 
\[
B_{w}(P)=\frac{B_{w}(P_{ref})}{1+X+\left(X^{2}/2\right)}
\]

\end_inset

with
\begin_inset Formula 
\[
X=c_{w}\left(P-P_{ref}\right)
\]

\end_inset

Therefore 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula 
\[
\frac{dB_{w}^{-1}}{dp}=\frac{1}{B_{w}(P_{ref})}\frac{d\left(1+c_{w}\left(P-P_{ref}\right)+0.5c_{w}^{2}\left(P-P_{ref}\right)^{2}\right)}{dp}
\]

\end_inset

En la proxima linea tenía error hasta 6 sept 13 (se corrije en por_elmprs
 dinvBw_dp & dinvBo_dp)
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula 
\begin{equation}
\frac{dB_{w}^{-1}}{dp}=\frac{1}{B_{w}(P_{ref})}\left(c_{w}+c_{w}^{2}\left(P-P_{ref}\right)\right)=\frac{c_{w}}{B_{w}(P_{ref})}\left(1+c_{w}\left(P-P_{ref}\right)\right)\label{eq:dinvBw_dp}
\end{equation}

\end_inset

And identically for oil.
 So finally we have 
\begin_inset Formula 
\[
-\left[\frac{c_{wSw}}{c_{oSw}}c_{op}-c_{wp}\right]=-\left[-\frac{B_{o}}{B_{w}}c_{op}-c_{wp}\right]=\frac{B_{o}}{B_{w}}c_{op}+c_{wp}
\]

\end_inset


\begin_inset Formula 
\[
-\left[\frac{c_{wSw}}{c_{oSw}}c_{op}-c_{wp}\right]=\frac{B_{o}}{B_{w}}\left(\phi^{0}c_{R}\left(\frac{S_{o}}{B_{o}}\right)^{l}+\left(\phi S_{o}\frac{dB_{o}^{-1}}{dp}\right)^{l}\right)+\phi^{0}c_{R}\left(\frac{S_{w}}{B_{w}}\right)^{l}+\left(\phi S_{w}\frac{dB_{w}^{-1}}{dp}\right)^{l}
\]

\end_inset

Here I could continue replacing but actually, perhaps, it would be better
 to define inside Alya cwp, cwsw, cop, cosw, dbwip, dboip, b_w, b_o.
 Notice I also need 
\begin_inset Formula $c_{R}$
\end_inset

, 
\begin_inset Formula $\phi^{0}$
\end_inset

 that is the initial porosity I would need to store.
 And also 
\begin_inset Formula $\phi$
\end_inset

 - check how to obtain it from 
\begin_inset Formula $c_{R}$
\end_inset

 and 
\begin_inset Formula $\phi^{0}$
\end_inset

.
 In rock properties I have related the volume to the volume at reference
 pressure using cr but not the porosity??? The volume for the volume must
 be from Eclipse but actually in Chen p57 we have 
\begin_inset Formula 
\[
\phi=\phi^{0}\left(1+c_{R}\left(P-P_{ref}\right)+0.5c_{R}^{2}\left(P-P_{ref}\right)^{2}\right)
\]

\end_inset

I think I will use this formula and at a latter time try to find the relation
 with the formula for the volumes.
\end_layout

\begin_layout Standard
Review of the values that we will need:
\end_layout

\begin_layout Enumerate

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula $\phi^{0}$
\end_inset

 elemental value read in data files
\end_layout

\begin_layout Enumerate

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula $c_{R}$
\end_inset

 scalar read in data files
\end_layout

\begin_layout Enumerate

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula $c_{o}$
\end_inset

 scalar read in data files
\end_layout

\begin_layout Enumerate

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula $c_{w}$
\end_inset

 scalar read in data files
\end_layout

\begin_layout Enumerate

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula $S_{w}^{l}$
\end_inset

 (
\begin_inset Formula $S_{o}^{l}$
\end_inset

 is obtained as 
\begin_inset Formula $1-$
\end_inset


\begin_inset Formula $S_{w}^{l}$
\end_inset

 ) Unknown
\end_layout

\begin_layout Enumerate

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula $B_{w}^{l}\left(P\right)$
\end_inset

 so actually what we need is 
\begin_inset Formula $P$
\end_inset

 and 
\begin_inset Formula $B_{w}^{l}\left(P_{ref}\right)$
\end_inset

 
\end_layout

\begin_layout Enumerate

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula $B_{o}^{l}\left(P\right)$
\end_inset

 so actually what we need is 
\begin_inset Formula $P$
\end_inset

 and 
\begin_inset Formula $B_{o}^{l}\left(P_{ref}\right)$
\end_inset

 
\end_layout

\begin_layout Enumerate

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula $\phi\left(P\right)$
\end_inset

 so actually what we need is 
\begin_inset Formula $P$
\end_inset

 and 
\begin_inset Formula $\phi\left(P_{ref}\right)$
\end_inset


\end_layout

\begin_layout Enumerate

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula $P_{ref}$
\end_inset

 
\end_layout

\begin_layout Subsubsection
Volume Laplacian matrix
\end_layout

\begin_layout Standard
It corresponds to the term 
\begin_inset Formula 
\[
\left[\frac{c_{wSw}}{c_{oSw}}F_{o}^{lhs}-F_{w}^{lhs}\right]\delta p
\]

\end_inset


\end_layout

\begin_layout Standard
For this term we multiply by a test function 
\begin_inset Formula 
\[
\int v\left[\frac{c_{wSw}}{c_{oSw}}F_{o}^{lhs}-F_{w}^{lhs}\right]\delta pd\Omega
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\triangle t\int v\left[\frac{c_{wSw}}{c_{oSw}}\nabla\cdot\left(T_{o}^{l}\nabla\left(\delta p\right)\right)-\nabla\cdot\left(T_{w}^{l}\nabla\left(\delta p\right)\right)\right]d\Omega\label{eq:volume_lap1}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
Here I need to suppose that 
\begin_inset Formula $\frac{c_{wSw}}{c_{oSw}}$
\end_inset

 is constant within the element.
 This is not completely true as we shall discuss later!!!!!!!!!! But introducing
 this approximation I get 
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit

\begin_inset Formula 
\[
\triangle t\int v\left[\nabla\cdot\left(\left(\frac{c_{wSw}}{c_{oSw}}T_{o}^{l}-T_{w}^{l}\right)\nabla\delta p\right)\right]d\Omega
\]

\end_inset

Now integrating by parts
\begin_inset Formula 
\[
\triangle t\left\{ \int_{\Gamma}v\, n\cdot\left(\left(\frac{c_{wSw}}{c_{oSw}}T_{o}^{l}-T_{w}^{l}\right)\nabla\delta p\right)d\Gamma-\int\left(\frac{c_{wSw}}{c_{oSw}}T_{o}^{l}-T_{w}^{l}\right)\nabla\delta p\cdot\nabla vd\Omega\right\} 
\]

\end_inset


\end_layout

\begin_layout Standard
The integral on the boundary leads to the boundary condition 
\begin_inset Formula 
\[
\left(\frac{c_{wSw}}{c_{oSw}}T_{o}^{l}-T_{w}^{l}\right)\nabla\delta p\cdot n=0
\]

\end_inset

Once the finite element functions are introduced, the second term reads
 
\begin_inset Formula 
\[
-\triangle t\int\left(\frac{c_{wSw}}{c_{oSw}}T_{o}^{l}-T_{w}^{l}\right)\nabla N_{I}\cdot\nabla N_{J}d\Omega\:\delta P_{J}
\]

\end_inset


\end_layout

\begin_layout Standard
Notice that if K is not isotropic, we should better write 
\begin_inset Formula 
\[
-\triangle t\int\left\{ \left(\frac{c_{wSw}}{c_{oSw}}T_{o}^{l}-T_{w}^{l}\right)\nabla N_{I}\right\} \cdot\nabla N_{J}d\Omega\:\delta P_{J}
\]

\end_inset


\end_layout

\begin_layout Standard
If we take into account that 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\frac{c_{wSw}}{c_{oSw}}$
\end_inset

 is not constant within the element the term
\begin_inset Formula 
\[
\triangle t\int v\left[\frac{c_{wSw}}{c_{oSw}}\nabla\cdot\left(T_{o}^{l}\nabla\left(\delta p\right)\right)\right]d\Omega
\]

\end_inset

in (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:volume_lap1"

\end_inset

) can be rewritten as 
\begin_inset Formula 
\[
\triangle t\int v\left[\nabla\cdot\left(\frac{c_{wSw}}{c_{oSw}}T_{o}^{l}\nabla\left(\delta p\right)\right)\right]d\Omega-\triangle t\int v\left[T_{o}^{l}\nabla\delta p\cdot\nabla\frac{c_{wSw}}{c_{oSw}}\right]d\Omega
\]

\end_inset

or 
\begin_inset Formula 
\[
\triangle t\int v\left[\nabla\cdot\left(\frac{c_{wSw}}{c_{oSw}}T_{o}^{l}\nabla\left(\delta p\right)\right)\right]d\Omega-\triangle t\int v\left[T_{o}^{l}\nabla\frac{c_{wSw}}{c_{oSw}}\cdot\nabla\delta p\right]d\Omega.
\]

\end_inset

This second term is clearly a convective one.
 With a velocity that we may call 
\begin_inset Formula $\mathbf{u}_{p}=T_{o}^{l}\nabla\frac{c_{wSw}}{c_{oSw}}$
\end_inset

 .
 This term is introduced as usual.
 But clearly it destroys the symmetry of the system - something that I have
 not heard before.
 Moreover, one would need to stabilize.
 Perhaps not only this term but the corresponding part in the RHS.
 The fraction 
\begin_inset Formula $\frac{c_{wSw}}{c_{oSw}}$
\end_inset

 is by definition (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:cwsw"

\end_inset

, 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:cosw"

\end_inset

) 
\begin_inset Formula 
\[
\frac{c_{wSw}}{c_{oSw}}=\frac{\left(\frac{\phi}{B_{w}}\right)^{l}}{-\left(\frac{\phi}{B_{o}}\right)^{l}}=-\left(\frac{B_{o}}{B_{w}}\right)^{l}=
\]

\end_inset


\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit

\begin_inset Formula 
\[
B_{w}(P)=\frac{B_{w}(P_{ref})}{1+X+\left(X^{2}/2\right)}
\]

\end_inset

with
\begin_inset Formula 
\[
X=c_{w}\left(P-P_{ref}\right)
\]

\end_inset


\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
 One first approximation would be to suppose that this term is small so
 that it does not need stabilization and moreover that we can send it to
 the RHS.
 I discussed this with Guillaume, we came to the conclusion that we have
 3 options:
\end_layout

\begin_layout Enumerate
We can include the convective term, then use stabilization and GMRES.
\end_layout

\begin_layout Enumerate
Send it to the RHS.
 No stabilization and CG.
\end_layout

\begin_layout Enumerate
Take it as zero it would not be strange that in FD they do this, as we discussed
 with Guillaume.
 Ruben also said that they do not take it into account.
\end_layout

\begin_layout Standard
Guillaume suggested that I might implement this with elmadr.
 Another option would be to write a very simple SUPG as Matias did for k-eps.
\end_layout

\begin_layout Standard
For this equation we need 
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
T_{\alpha}=\frac{k_{r\alpha}}{\mu_{\alpha}B_{\alpha}}K
\]

\end_inset

defined in (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:T_alpha"

\end_inset

) for both oil and water.
 Therefore on top of the variables defined in the previous Section we need:
\end_layout

\begin_layout Enumerate
The permeability 
\begin_inset Formula $K$
\end_inset

 that is of size (ndime,nelem)
\end_layout

\begin_layout Enumerate
The relative permeabilities 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $k_{ro}$
\end_inset


\end_layout

\begin_layout Enumerate

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
and 
\begin_inset Formula $k_{rw}$
\end_inset

 obtained from tables depending on the material to which the element belongs.
\end_layout

\begin_layout Enumerate

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula $\mu_{o}$
\end_inset

and
\end_layout

\begin_layout Enumerate

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula $\mu_{w}$
\end_inset

that are constant
\end_layout

\begin_layout Enumerate
Finally, if we want to include the convective term we need
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula 
\[
\nabla\frac{c_{wSw}}{c_{oSw}}=-\nabla\left(\frac{B_{o}}{B_{w}}\right)^{l}=-\nabla\left(\frac{B_{o}(P_{ref})\left[1+c_{w}\left(P-P_{ref}\right)+0.5c_{w}^{2}\left(P-P_{ref}\right)^{2}\right]}{B_{w}(P_{ref})\left[1+c_{o}\left(P-P_{ref}\right)+0.5c_{o}^{2}\left(P-P_{ref}\right)^{2}\right]}\right)^{l}.
\]

\end_inset

Which we can easily approximate by calculating 
\begin_inset Formula $\frac{B_{o}(P_{ref})[1+c_{w}\left(P-P_{ref}\right)+0.5c_{w}^{2}\left(P-P_{ref}\right)^{2}}{B_{w}(P_{ref})[1+c_{o}\left(P-P_{ref}\right)+0.5c_{o}^{2}\left(P-P_{ref}\right)^{2}}$
\end_inset

at the nodes and multiplying by cartd.
 In this case the quadratic behavior with P and the fact that it appears
 in the divisor would not be accurately taken into account.
 An exact calculation would also be possible.
 Perhaps that would be a better option.
 Using 
\begin_inset Formula 
\[
\frac{d\left(u/v\right)}{dx}=\frac{v\frac{du}{dx}-u\frac{dv}{dx}}{v^{2}}
\]

\end_inset

 we get 
\begin_inset Formula 
\begin{eqnarray*}
 & \nabla\frac{c_{wSw}}{c_{oSw}}=\frac{1}{B_{w}(P_{ref})^{2}\left[1+c_{o}\left(P-P_{ref}\right)+0.5c_{o}^{2}\left(P-P_{ref}\right)^{2}\right]^{2}}\\
 & *[B_{o}(P_{ref})\left[1+c_{w}\left(P-P_{ref}\right)+0.5c_{w}^{2}\left(P-P_{ref}\right)^{2}\right]\nabla\left\{ B_{w}(P_{ref})\left[1+c_{o}\left(P-P_{ref}\right)+0.5c_{o}^{2}\left(P-P_{ref}\right)^{2}\right]\right\} \\
 & --B_{w}(P_{ref})\left[1+c_{o}\left(P-P_{ref}\right)+0.5c_{o}^{2}\left(P-P_{ref}\right)^{2}\right]\nabla\left\{ B_{o}(P_{ref})\left[1+c_{w}\left(P-P_{ref}\right)+0.5c_{w}^{2}\left(P-P_{ref}\right)^{2}\right]\right\} ]
\end{eqnarray*}

\end_inset

Where we would need to take into account that 
\begin_inset Formula 
\begin{eqnarray*}
Pressureequation\nabla\left\{ B_{w}(P_{ref})\left[1+c_{o}\left(P-P_{ref}\right)+0.5c_{o}^{2}\left(P-P_{ref}\right)^{2}\right]\right\} \\
 & = & B_{w}(P_{ref})c_{o}\nabla P+0.5c_{o}^{2}B_{w}(P_{ref})\nabla\left[P^{2}-2PP_{ref}+P_{ref}^{2}\right]\\
 & = & B_{w}(P_{ref})c_{o}\nabla P+0.5c_{o}^{2}B_{w}(P_{ref})\left[2P\nabla P-2P_{ref}\nabla P\right]\\
 & = & B_{w}(P_{ref})c_{o}\nabla P+c_{o}^{2}B_{w}(P_{ref})\nabla P\left(P-P_{ref}\right)\\
 & = & B_{w}(P_{ref})c_{o}\nabla P\left(1+c_{o}\left(P-P_{ref}\right)\right)
\end{eqnarray*}

\end_inset

And similarly for the other term.
 This is the right way to go! We just obtain 
\begin_inset Formula $\nabla P$
\end_inset

 and 
\begin_inset Formula $P$
\end_inset

 at the gauss point and from this we can obtain everything.
\end_layout

\begin_layout Subsubsection
Well matrix
\end_layout

\begin_layout Standard
It corresponds to the term
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula 
\[
\left[\frac{c_{wSw}}{c_{oSw}}F_{o}^{w1}-F_{w}^{w1}\right]\delta p
\]

\end_inset

in 
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
(
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:delptap1-1"

\end_inset

) 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
.To simplify the presentation we only present the discretization for the
 water term but the oil term is treated identically
\begin_inset Formula 
\[
-F_{w}^{w1}\delta p
\]

\end_inset

 
\begin_inset Formula 
\[
+\frac{\triangle t}{B_{w}^{l}}\sum_{j=1}^{N_{w}}\sum_{m=1}^{M_{wj}}WI^{\left(j,m\right)}\frac{k_{rw}}{\mu_{w}}\delta\left(\mathbf{x}-\mathbf{x}^{\left(j,m\right)}\right)\delta p
\]

\end_inset


\end_layout

\begin_layout Standard
Since the previous equation includes a delta Dirac that is non zero at the
 nodes J corresponding to the well, as in Chen 13.19, we obtain 
\begin_inset Formula 
\[
\frac{\triangle t}{B_{w}^{l}}\sum_{j=1}^{N_{w}}\sum_{m=1}^{M_{wj}}WI^{\left(j,m\right)}\frac{k_{rw}}{\mu_{w}}\delta P_{J}
\]

\end_inset

 This term enters directly in the diagonal of the matrix I=J for each well
 j and each of its vertical components.
\end_layout

\begin_layout Subsubsection
Volume RHS term
\end_layout

\begin_layout Standard
It corresponds to the term
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula 
\[
-\frac{c_{wSw}}{c_{oSw}}F_{o}^{rhs}+F_{w}^{rhs}
\]

\end_inset

Again this term is very simple just 
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
multiplying by a test function and discretizing with finite element functions
 we end up with a RHS term 
\begin_inset Formula 
\[
{\displaystyle F_{J}=\int}\left(-\frac{c_{wSw}}{c_{oSw}}F_{o}^{rhs}+F_{w}^{rhs}\right)N_{J}d\Omega
\]

\end_inset


\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $F_{w}^{rhs}$
\end_inset


\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
 has been defined in (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Fw_rhs"

\end_inset

) and the oil term is nearly identical.
\begin_inset Formula 
\[
F_{w}^{rhs}=-\left(\frac{\phi S_{w}}{B_{w}}\right)^{l}+\left(\frac{\phi S_{w}}{B_{w}}\right)^{n}+\triangle t\nabla\cdot\left(T_{w}^{l}\nabla\Phi_{w}^{l}\right)
\]

\end_inset


\end_layout

\begin_layout Standard
All of the variables in the previous equation have been already obtained
 either for the Laplacian matrix or mass matrix.
 Beware that the Laplacian term in rhs must also be integrated by parts.
 The only term that has not been mentioned yet is the contribution from
 the gravity term.
 First we notice that 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $+\triangle t\nabla\cdot\left(T_{w}^{l}\nabla\Phi_{w}^{l}\right)$
\end_inset

when integrated by parts gives rise to 
\begin_inset Formula $-\triangle tT_{w}^{l}\nabla\Phi_{w}^{l}\cdot\nabla v$
\end_inset

 where v belongs to the test space.
 now using 
\begin_inset Formula $\Phi_{\alpha}=p_{\alpha}-\rho_{\alpha}\ gz$
\end_inset

 
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit

\begin_inset Formula 
\[
-\triangle tT_{w}^{l}\nabla p_{w}^{l}\cdot\nabla v+\triangle tT_{w}^{l}\nabla\left(\rho_{w}^{l}\ gz\right)\cdot\nabla v
\]

\end_inset

I think a bit on the term 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\nabla\left(\rho_{w}^{l}\ gz\right)$
\end_inset

 we could decompose it into 
\begin_inset Formula $\rho_{w}^{l}\nabla\left(gz\right)+gz\nabla\left(\rho_{w}^{l}\right)$
\end_inset

.
 The first term ends up as 
\begin_inset Formula $\rho_{w}^{l}g\, e_{z}$
\end_inset

.
 The second term looks a bit strange to me 
\begin_inset Formula $gz\nabla\left(\rho_{w}^{l}\right)$
\end_inset

.
 if the flow were incompressible it would disappear .
 Perhaps we can neglect it???
\end_layout

\begin_layout Subsubsection
Well RHS term
\end_layout

\begin_layout Standard
It corresponds to the term
\begin_inset Formula 
\[
-\left[\frac{c_{wSw}}{c_{oSw}}F_{o}^{w0}-F_{w}^{w0}\right]
\]

\end_inset

using the definitions of 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $F_{o}^{w0}$
\end_inset

 (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Fw0-1"

\end_inset

) and 
\begin_inset Formula $F_{w}^{w0}$
\end_inset

 it can be written as
\begin_inset Formula 
\[
F_{w}^{w0}=\frac{\triangle t}{B_{w}^{l}}q_{ws}^{l}=\frac{\triangle t}{B_{w}^{l}}\left\{ \sum_{j=1}^{N_{w}}\sum_{m=1}^{M_{wj}}WI^{\left(j,m\right)}\frac{k_{rw}}{\mu_{w}}\left[p_{bj}^{\left(j\right)}-p^{l}\right]\delta\left(\mathbf{x}-\mathbf{x}^{\left(j,m\right)}\right)\right\} 
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
-\left[\frac{c_{wSw}}{c_{oSw}}\frac{\triangle t}{B_{o}^{l}}\left\{ \sum_{j=1}^{N_{w}}\sum_{m=1}^{M_{wj}}WI^{\left(j,m\right)}\frac{k_{ro}}{\mu_{o}}\left[p_{bj}^{\left(j\right)}-p^{l}\right]\delta\left(\mathbf{x}-\mathbf{x}^{\left(j,m\right)}\right)\right\} -\frac{\triangle t}{B_{w}^{l}}\left\{ \sum_{j=1}^{N_{w}}\sum_{m=1}^{M_{wj}}WI^{\left(j,m\right)}\frac{k_{rw}}{\mu_{w}}\left[p_{bj}^{\left(j\right)}-p^{l}\right]\delta\left(\mathbf{x}-\mathbf{x}^{\left(j,m\right)}\right)\right\} \right]
\]

\end_inset


\end_layout

\begin_layout Standard
Here I introduce 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\frac{c_{wSw}}{c_{oSw}}$
\end_inset

 inside the sum for each well.
 Actually it seems logical that this terms is according to the values at
 the well, perhaps this is the way in which it should always be written.

\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
 
\begin_inset Formula 
\[
-\left[\left\{ \sum_{j=1}^{N_{w}}\sum_{m=1}^{M_{wj}}\frac{c_{wSw}}{c_{oSw}}\frac{\triangle t}{B_{o}^{l}}WI^{\left(j,m\right)}\frac{k_{ro}}{\mu_{o}}\left[p_{bj}^{\left(j\right)}-p^{l}\right]\delta\left(\mathbf{x}-\mathbf{x}^{\left(j,m\right)}\right)\right\} -\left\{ \sum_{j=1}^{N_{w}}\sum_{m=1}^{M_{wj}}\frac{\triangle t}{B_{w}^{l}}WI^{\left(j,m\right)}\frac{k_{rw}}{\mu_{w}}\left[p_{bj}^{\left(j\right)}-p^{l}\right]\delta\left(\mathbf{x}-\mathbf{x}^{\left(j,m\right)}\right)\right\} \right]
\]

\end_inset


\begin_inset Formula 
\[
-\left\{ \sum_{j=1}^{N_{w}}\sum_{m=1}^{M_{wj}}\left\{ \frac{c_{wSw}}{c_{oSw}}\frac{\triangle t}{B_{o}^{l}}\frac{k_{ro}}{\mu_{o}}-\frac{\triangle t}{B_{w}^{l}}\frac{k_{rw}}{\mu_{w}}\right\} WI^{\left(j,m\right)}\left[p_{bj}^{\left(j\right)}-p^{l}\right]\delta\left(\mathbf{x}-\mathbf{x}^{\left(j,m\right)}\right)\right\} 
\]

\end_inset

As in the well matrix term, the previous equation includes a delta Dirac
 that is non zero at the nodes J corresponding to the well , as in Chen
 13.19, we obtain 
\begin_inset Formula 
\[
F_{J}=-\left\{ \sum_{j=1}^{N_{w}}\sum_{m=1}^{M_{wj}}\left\{ \frac{c_{wSw}}{c_{oSw}}\frac{\triangle t}{B_{o}^{l}}\frac{k_{ro}}{\mu_{o}}-\frac{\triangle t}{B_{w}^{l}}\frac{k_{rw}}{\mu_{w}}\right\} WI^{\left(j,m\right)}\left[p_{bj}^{\left(j\right)}-P_{J}^{l}\right]\right\} 
\]

\end_inset

 This term enters directly in the RHS for each well j and each of its vertical
 components.
 Notice that it is not 
\begin_inset Formula $F_{J}$
\end_inset

 from the previous steps because it depends on both 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $p_{bj}^{\left(j\right)}$
\end_inset

 and 
\begin_inset Formula $P_{J}^{l}$
\end_inset

.
 The former is taken from the value at the previous time step in IMPES but
 the latter is the value that corresponds to the current time step.
\end_layout

\begin_layout Standard
Remarks on the final implementation.
 we shall be solve for 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
p^{l+1}
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
 not 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\backslash
delta
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
 p so we will have (on the LHS)
\begin_inset Formula 
\[
\left[\frac{c_{wSw}}{c_{oSw}}F_{o}-F_{w}\right]=.....
\]

\end_inset

where I have eliminated the superscript w1 because solving directly for
 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
p^{l+1} it does not make much sense.
 This can be transformed into 
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit

\begin_inset Formula 
\[
\triangle t\left(\frac{1}{B_{w}^{l}}\frac{k_{rw}}{\mu_{w}}-\frac{c_{wSw}}{c_{oSw}}\frac{1}{B_{o}^{l}}\frac{k_{ro}}{\mu_{o}}\right)WI\: P_{J}^{l+1}=\triangle t\left(\frac{1}{B_{w}^{l}}\frac{k_{rw}}{\mu_{w}}-\frac{c_{wSw}}{c_{oSw}}\frac{1}{B_{o}^{l}}\frac{k_{ro}}{\mu_{o}}\right)WI\: p_{bj}.....
\]

\end_inset

where I have eliminated the superscript (j,m) because in the way I will
 implement it it does not make much sense.
 It is just the well index for the node and that is it.
\end_layout

\begin_layout Subsection
Transport equation for Sw
\end_layout

\begin_layout Standard
The transport equation for Sw (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:deltaSw"

\end_inset

) is solved explicitly.
 Actually in Chen p24 he says 'note that if the saturation Sw is explicitly
 evaluated, we can solve the equation for the pressure.
 After computing the pressure Sw can be calculated from its equation.
 In eq.
 7.27 once again it is made clear that water saturation is used.
\end_layout

\begin_layout Subsubsection
How do we see this as a transport equation
\begin_inset CommandInset label
LatexCommand label
name "sub:How-do-we"

\end_inset


\end_layout

\begin_layout Standard
Going back to the water mass conservation equation written as in 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:mass-cons-alpha"

\end_inset


\begin_inset Formula 
\[
\frac{\partial}{\partial t}\left(\phi\ \rho_{w}\ S_{w}\right)+\nabla\cdot\left(\rho_{w}\ \mathbf{u}_{w}\right)=q_{w}
\]

\end_inset

Following Sesini Coutinho 2010 (with the difference that they deal with
 incompressible) or Chen Sec 7.3.1 we can rewrite the previous equation using
 
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\mathbf{u}{}_{w}=f_{w}\mathbf{u}+kf_{w}\lambda_{o}\left(\rho_{w}-\rho_{o}\right)g\nabla z\label{eq:watervel}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
where 
\begin_inset Formula 
\[
\mathbf{u}=\mathbf{u}_{w}+\mathbf{u}_{o}
\]

\end_inset


\end_layout

\begin_layout Standard
(see eq.
 after 7.26 - here in the case 
\begin_inset Formula $p_{c}=0$
\end_inset

 --- I have deduced this equation in porous/ab/13/obs_varias.lyx) as
\begin_inset Formula 
\[
\frac{\partial}{\partial t}\left(\phi\ \rho_{w}\ S_{w}\right)+\nabla\cdot\left(\rho_{w}f_{w}\mathbf{u}+\rho_{w}kf_{w}\lambda_{o}\left(\rho_{w}-\rho_{o}\right)g\nabla z\right)=q_{w}
\]

\end_inset

Notice that this equation corresponds to both 7.27 and 7.39 Chen which have
 an error 
\begin_inset Formula 
\begin{equation}
\frac{\partial}{\partial t}\left(\phi\ \rho_{w}\ S_{w}\right)+\nabla\cdot\left(\rho_{w}\ f_{w}\mathbf{u}\right)+\nabla\cdot\left(\rho_{w}kf_{w}\lambda_{o}\left(\rho_{w}-\rho_{o}\right)g\nabla z\right)=q_{w}\label{eq:water-trasport-cout}
\end{equation}

\end_inset


\begin_inset Formula 
\[
\frac{\partial}{\partial t}\left(\phi\ \rho_{w}\ S_{w}\right)+\rho_{w}\mathbf{u}\cdot\nabla f_{w}+f_{w}\nabla\cdot\left(\rho_{w}\mathbf{u}\right)+\rho_{w}kf_{w}\lambda_{o}\left(\rho_{w}-\rho_{o}\right)g\nabla z\cdot\nabla f_{w}+f_{w}\nabla\cdot\left(\rho_{w}k\lambda_{o}\left(\rho_{w}-\rho_{o}\right)g\nabla z\right)=q_{w}
\]

\end_inset


\begin_inset Formula 
\begin{equation}
\frac{\partial}{\partial t}\left(\phi\ \rho_{w}\ S_{w}\right)+\rho_{w}\mathbf{u}\cdot\frac{\partial f_{w}}{\partial S_{w}}\nabla S_{w}+f_{w}\nabla\cdot\left(\rho_{w}\mathbf{u}\right)+\rho_{w}kf_{w}\lambda_{o}\left(\rho_{w}-\rho_{o}\right)g\nabla z\cdot\frac{\partial f_{w}}{\partial S_{w}}\nabla S_{w}+f_{w}\nabla\cdot\left(\rho_{w}k\lambda_{o}\left(\rho_{w}-\rho_{o}\right)g\nabla z\right)=q_{w}\label{eq:water-transp-convec}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
and here we have a classical convective term 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\frac{\partial f_{w}}{\partial S_{w}}\mathbf{u}_{T}\cdot\nabla S_{w}$
\end_inset

 .
\end_layout

\begin_layout Standard
Actually In order to write the previous equations in a shorter form we could
 have defined
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula 
\[
\mathbf{u^{*}}=\mathbf{u+}k\lambda_{o}\left(\rho_{w}-\rho_{o}\right)g\nabla z
\]

\end_inset


\end_layout

\begin_layout Standard
So that (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:watervel"

\end_inset

)would have been written as 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula 
\[
\mathbf{u}{}_{w}=f_{w}\mathbf{u^{*}}
\]

\end_inset

 And then all of the previous equation could have been written hiding the
 gravity term 
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit

\begin_inset Formula 
\begin{equation}
\frac{\partial}{\partial t}\left(\phi\ \rho_{w}\ S_{w}\right)+\nabla\cdot\left(\rho_{w}\ f_{w}\mathbf{u^{*}}\right)=q_{w}\label{eq:water-trasport-cout-1}
\end{equation}

\end_inset


\begin_inset Formula 
\[
\frac{\partial}{\partial t}\left(\phi\ \rho_{w}\ S_{w}\right)+\rho_{w}\mathbf{u^{*}}\cdot\nabla f_{w}+f_{w}\nabla\cdot\left(\rho_{w}\mathbf{u^{*}}\right)=q_{w}
\]

\end_inset


\begin_inset Formula 
\begin{equation}
\frac{\partial}{\partial t}\left(\phi\ \rho_{w}\ S_{w}\right)+\rho_{w}\mathbf{u^{*}}\cdot\frac{\partial f_{w}}{\partial S_{w}}\nabla S_{w}+f_{w}\nabla\cdot\left(\rho_{w}\mathbf{u^{*}}\right)=q_{w}\label{eq:water-transp-convec-1}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
In the presentation by Coutinho since the fluids are incompressible the
 water density is constant and disappears from the previous equations.
 Moreover total velocity is divergence free and there is no gravity leading
 to 
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit

\begin_inset Formula 
\[
\frac{\partial}{\partial t}\left(\phi\ S_{w}\right)+\frac{\partial f_{w}}{\partial S_{w}}\mathbf{u}_{T}\cdot\nabla S_{w}=\frac{q_{w}}{\rho_{w}}.
\]

\end_inset

Coutinho has an additional diffusion term that comes from the critical pressure
 but our critical pressure is zero.
\end_layout

\begin_layout Standard
Chen has a very similar equation in 7.39!!!!!!!!!!!-- this eq is idem 7.27
 there it is explained how it is obtained.
\end_layout

\begin_layout Standard
Working with 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\mathbf{u}$
\end_inset

 in (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:water-trasport-cout"

\end_inset

) seems a bit artificial I thought I would work directly with 
\begin_inset Formula $\mathbf{u}_{w}$
\end_inset

.
 But doing that introduces 
\begin_inset Formula $f_{w}$
\end_inset

 that finally leads to a 'typical' convective term 
\begin_inset Formula $\mathbf{u}_{T}\cdot\frac{\partial f_{w}}{\partial S_{w}}\nabla S_{w}$
\end_inset

.
 this makes me think that what Coutinho projects is 
\begin_inset Formula $\mathbf{u}$
\end_inset

.
\end_layout

\begin_layout Standard
Before looking into this issue I thought that what I would project would
 be 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\mathbf{u}_{w}$
\end_inset

.
 There would not be much difficulty in working with the total velocity.
\end_layout

\begin_layout Standard
Finally for curiosity al least in some case with FE (perhaps Ch 7) I would
 like to see how Chen treats this term.
 Does he need any stabilization? In Ch most of what he presents is for the
 pressure equation.
 For the saturation equation see 7.5.3.
 It is Characteristic FE that has been presented in sect 4.6.
 actually if you go to the index sect p 171 8sect 4.6) is the only place
 where ADR is dealt with.
 Actually he says characteristic methods are superior to SUPG (Brooks and
 Hughes 82) 
\end_layout

\begin_layout Standard
Now we have included the gravity terms in 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:water-transp-convec"

\end_inset

 and we have rewritten the equation to hide them in (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:water-transp-convec-1"

\end_inset

).
 The convective term ends up as 
\begin_inset Formula 
\[
\rho_{w}\frac{\partial f_{w}}{\partial S_{w}}\mathbf{u^{*}}\cdot\nabla S_{w}
\]

\end_inset

Then we have the term 
\begin_inset Formula 
\[
f_{w}\nabla\cdot\left(\rho_{w}\mathbf{u^{*}}\right)
\]

\end_inset

where 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $f_{w}$
\end_inset

 is a function of 
\begin_inset Formula $S_{w}$
\end_inset

 I do not know if we should take any special care of this term or just include
 it as it is.
\end_layout

\begin_layout Subsubsection
How to deal with the fact that the flow is compressible in 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:water-transp-convec-1"

\end_inset


\end_layout

\begin_layout Standard
In Ch 7 Chen the saturation is for the water equation.
 First we can have a look at the transformations the water equation has
 suffered in this document.
 The evolution is: (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:mass-cons-alpha"

\end_inset

) -> (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:water-transp"

\end_inset

) -> (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:water-transp2"

\end_inset

) -> (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:chen837"

\end_inset

) -> (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:chen897"

\end_inset

) 
\end_layout

\begin_layout Standard
The transient term evolves from 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula 
\[
\frac{\partial}{\partial t}\left(\phi\ \rho_{\alpha}\ S_{\alpha}\right)
\]

\end_inset

into
\begin_inset Formula 
\[
\rho_{ws}\frac{\partial}{\partial t}\left(\frac{\phi S_{w}}{B_{w}}\right)
\]

\end_inset


\begin_inset Formula 
\[
\frac{\rho_{ws}}{\triangle t}\left[\left(\frac{\phi S_{w}}{B_{w}}\right)^{n+1,l}-\left(\frac{\phi S_{w}}{B_{w}}\right)^{n}+\delta\left(\frac{\phi S_{w}}{B_{w}}\right)\right]
\]

\end_inset

 
\begin_inset Formula 
\[
\frac{\rho_{ws}}{\triangle t}\left[\left(\frac{\phi S_{w}}{B_{w}}\right)^{l}-\left(\frac{\phi S_{w}}{B_{w}}\right)^{n}+c_{wp}\delta p+c_{wSw}\delta S_{w}\right]
\]

\end_inset

This term should not present much difficulty to us.
 Actually in a normal IMPES I understand that 
\begin_inset Formula $\left(\frac{\phi S_{w}}{B_{w}}\right)^{l}=\left(\frac{\phi S_{w}}{B_{w}}\right)^{n}$
\end_inset

.
 
\begin_inset Formula $\delta p$
\end_inset

 is known so the term 
\begin_inset Formula $\frac{\rho_{ws}}{\triangle t}c_{wp}\delta p$
\end_inset

 goes to the RHS 
\begin_inset Formula 
\[
\frac{\rho_{ws}}{\triangle t}c_{wp}\delta p
\]

\end_inset

and therefore we are left over with 
\begin_inset Formula $\frac{\rho_{ws}}{\triangle t}c_{wSw}\delta S_{w}$
\end_inset

 .
 This term would lead to a mass matrix and should be no problem.
\end_layout

\begin_layout Standard
The term 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\nabla\cdot\left(\rho_{w}\ \mathbf{u}_{w}\right)$
\end_inset

 in (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:mass-cons-alpha"

\end_inset

) transforms in 
\begin_inset Formula $\rho_{w}\mathbf{u^{*}}\cdot\frac{\partial f_{w}}{\partial S_{w}}\nabla S_{w}+f_{w}\nabla\cdot\left(\rho_{w}\mathbf{u^{*}}\right)$
\end_inset

 as described in the previous Section following what Chen has done en Sect
 7.3.1.
 
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
The first term is the convective term and it presents no difficulty 
\begin_inset Formula 
\[
\frac{\rho_{ws}}{B_{w}}\mathbf{u^{*}}\cdot\frac{\partial f_{w}}{\partial S_{w}}\nabla S_{w}.
\]

\end_inset

The second term can be rewritten as
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula 
\[
f_{w}\nabla\cdot\left(\frac{\rho_{ws}}{B_{w}}\mathbf{u^{*}}\right)
\]

\end_inset

 where both 
\begin_inset Formula $f_{w}$
\end_inset

 and 
\begin_inset Formula $B_{w}$
\end_inset

 depend on 
\begin_inset Formula $S_{w}$
\end_inset

.
 If we are going to treat this term explicitly, I believe this does not
 introduce much difficulty.
 If we want to treat it implicitly, we could try to take into account the
 dependency leading to a nonlinear term.
\end_layout

\begin_layout Subsubsection
Review prior to implementation
\begin_inset CommandInset label
LatexCommand label
name "sub:Review-prior-to"

\end_inset


\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula 
\[
\frac{\rho_{ws}}{\triangle t}\left[\left(\frac{\phi S_{w}}{B_{w}}\right)^{l}-\left(\frac{\phi S_{w}}{B_{w}}\right)^{n}+c_{wp}\delta p+c_{wSw}\delta S_{w}\right]+\frac{\rho_{ws}}{B_{w}}\mathbf{u^{*}}\cdot\frac{\partial f_{w}}{\partial S_{w}}\nabla S_{w}+f_{w}\nabla\cdot\left(\frac{\rho_{ws}}{B_{w}}\mathbf{u^{*}}\right)=q_{w}
\]

\end_inset


\end_layout

\begin_layout Standard
I can solve directly for 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\delta S_{w}$
\end_inset


\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
 .
 Moreover for the explicit case that I will do now 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\left(\frac{\phi S_{w}}{B_{w}}\right)^{l}$
\end_inset

 is approximated by its value at the previous time step so 
\begin_inset Formula $\left(\frac{\phi S_{w}}{B_{w}}\right)^{l}-\left(\frac{\phi S_{w}}{B_{w}}\right)^{n}=0$
\end_inset

.
 Actually since we are solving explicitly we have 
\begin_inset Formula $S_{w}^{n}=S_{w}^{l}$
\end_inset

 and as we still have not solved for the pressure we must also take 
\begin_inset Formula $B_{w}^{n}=B_{w}^{l}$
\end_inset


\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
The rest of the terms go to the RHS (actually not everything as we will
 see later) so we end up with 
\begin_inset Formula 
\begin{equation}
\frac{\rho_{ws}}{\triangle t}c_{wSw}\delta S_{w}=q_{w}-\frac{\rho_{ws}}{\triangle t}c_{wp}\delta p-\frac{\rho_{ws}}{B_{w}}\mathbf{u^{*}}\cdot\frac{\partial f_{w}}{\partial S_{w}}\nabla S_{w}-\rho_{ws}\, f_{w}\nabla\cdot\left(\frac{1}{B_{w}}\mathbf{u^{*}}\right)\label{eq:satur_review}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
If I use Elmadr setting 
\begin_inset Formula $dtinv=0$
\end_inset

 to eliminate the transient term in elmat I will recover 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\frac{\rho_{ws}}{B_{w}}\mathbf{u^{*}}\cdot\frac{\partial f_{w}}{\partial S_{w}}\nabla N$
\end_inset

 ( obtained in por_elmprs gpadv - 1st term) .
 I then multiply this by elswa(3) and subtract from the RHS prior to assembly.
 The velocity I give to elmadr could includes all 
\begin_inset Formula $\frac{\rho_{ws}}{B_{w}}\mathbf{u^{*}}\cdot\frac{\partial f_{w}}{\partial S_{w}}$
\end_inset

 and the density is set to one.
 Finally 
\begin_inset Formula $-\frac{\rho_{ws}}{\triangle t}c_{wp}\delta p-\rho_{ws}\, f_{w}\nabla\cdot\left(\frac{1}{B_{w}}\mathbf{u^{*}}\right)$
\end_inset

 are just 'force' terms that must be prepared by por_elmprs and stored in
 gprhs.
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula $c_{wp}$
\end_inset

 will be calculated in the same way as it has been calculated en por_elmpre.
 
\begin_inset Formula $\delta p$
\end_inset

 = 0 if this equation is treated explicitly.
 It would enter it if I decided to work implicitly and couple pressure and
 saturation then I guess would just use press(1) - press(3).
 For the moment I just forget about the term 
\begin_inset Formula $\frac{1}{\triangle t}c_{wp}\delta p$
\end_inset

 because it is zero in the explicit case.
 So I just need to take care of the term 
\begin_inset Formula $-\rho_{ws}\, f_{w}\nabla\cdot\left(\frac{1}{B_{w}}\mathbf{u^{*}}\right)$
\end_inset

.
 
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula 
\begin{equation}
f_{w}=\frac{\lambda_{w}}{\lambda_{w}+\lambda_{o}}\label{eq:fw}
\end{equation}

\end_inset

with 
\begin_inset Formula $\lambda_{\alpha}$
\end_inset

 given in 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:lambda-alpha"

\end_inset


\begin_inset Formula 
\begin{equation}
\lambda_{\alpha}=\frac{k_{r\alpha}}{\mu_{\alpha}}\label{eq:lambda_alpha}
\end{equation}

\end_inset

 where the viscosity is constant in our case and 
\begin_inset Formula $k_{r\alpha}$
\end_inset

 is obtained from tables (por_gtable) depending on the material to which
 the element belongs.
 The term 
\begin_inset Formula $\rho_{ws}\nabla\cdot\left(\frac{1}{B_{w}}\mathbf{u^{*}}\right)$
\end_inset

 can be rewritten as 
\begin_inset Formula 
\begin{eqnarray*}
\rho_{ws}\nabla\cdot\left(\frac{1}{B_{w}}\mathbf{u^{*}}\right) & = & \rho_{ws}\mathbf{u^{*}}\cdot\nabla\left(\frac{1}{B_{w}}\right)+\frac{\rho_{ws}}{B_{w}}\nabla\cdot\left(\mathbf{u+}k\lambda_{o}\left(\rho_{w}-\rho_{o}\right)g\nabla z\right)\\
 &  & =\rho_{ws}\mathbf{u^{*}}\cdot\nabla\left(\frac{1}{B_{w}}\right)+\frac{\rho_{ws}}{B_{w}}\left[\nabla\cdot\mathbf{u+}\mathbf{g}\cdot\nabla\left(k\lambda_{o}\left(\rho_{w}-\rho_{o}\right)\right)\right]
\end{eqnarray*}

\end_inset

where I have taken into account that g can be in any direction.
 This can be further decomposed
\begin_inset Formula 
\begin{eqnarray*}
\nabla\left(k\lambda_{o}\left(\rho_{w}-\rho_{o}\right)\right) & = & k\lambda_{o}\nabla\left(\rho_{w}-\rho_{o}\right)+k\left(\rho_{w}-\rho_{o}\right)\nabla\lambda_{o}\\
 &  & =k\lambda_{o}\left(\rho_{ws}\nabla\left(\frac{1}{B_{w}}\right)-\rho_{os}\nabla\left(\frac{1}{B_{o}}\right)\right)+k\left(\rho_{w}-\rho_{o}\right)\nabla\lambda_{o}
\end{eqnarray*}

\end_inset

Where finally 
\begin_inset Formula 
\[
\nabla\left(\frac{1}{B_{w}}\right)=\frac{dB_{w}^{-1}}{dp}\nabla p
\]

\end_inset

and similarly for oil, and 
\begin_inset Formula 
\[
\nabla\lambda_{o}=\frac{d\lambda_{o}}{dS_{w}}\nabla S_{w}
\]

\end_inset


\begin_inset Formula $\frac{d\lambda_{o}}{dS_{w}}$
\end_inset

 can be obtained from por_gtable Introduce a flag so that it calculates
 it when needed.
\end_layout

\begin_layout Standard
So finally 
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\nabla\cdot\left(\rho_{w}\mathbf{u^{*}}\right)=\rho_{ws}\mathbf{u^{*}}\cdot\frac{dB_{w}^{-1}}{dp}\nabla p+\frac{\rho_{ws}}{B_{w}}\left[\nabla\cdot\mathbf{u+}\mathbf{g}\cdot\left\{ k\lambda_{o}\left(\rho_{ws}\frac{dB_{w}^{-1}}{dp}\nabla p-\rho_{os}\frac{dB_{o}^{-1}}{dp}\nabla p\right)+k\left(\rho_{w}-\rho_{o}\right)\frac{d\lambda_{o}}{dS_{w}}\nabla S_{w}\right\} \right]
\]

\end_inset


\end_layout

\begin_layout Standard
One final remark: In this equation the last term includes a 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\nabla S_{w}$
\end_inset

 which we may keep in th LHS.
 therefore we could rewrite 
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit

\begin_inset Formula 
\begin{eqnarray*}
f_{w}\nabla\cdot\left(\rho_{w}\mathbf{u^{*}}\right) & = & f_{w}\rho_{ws}\mathbf{u^{*}}\cdot\frac{dB_{w}^{-1}}{dp}\nabla p+\frac{f_{w}\rho_{ws}}{B_{w}}\left[\nabla\cdot\mathbf{u+}\mathbf{g}\cdot\left\{ k\lambda_{o}\left(\rho_{ws}\frac{dB_{w}^{-1}}{dp}\nabla p-\rho_{os}\frac{dB_{o}^{-1}}{dp}\nabla p\right)\right\} \right]\\
 &  & +\frac{f_{w}\rho_{ws}}{B_{w}}\left[\mathbf{g}\cdot\left\{ k\left(\rho_{w}-\rho_{o}\right)\frac{d\lambda_{o}}{dS_{w}}\nabla S_{w}\right\} \right]
\end{eqnarray*}

\end_inset


\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
Beware!
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
 Despite I write 
\begin_inset Formula $k$
\end_inset

 in the previous equations, it is actually a diagonal matrix in the anisotropic
 case.
 In the anisotropic case we should write
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{eqnarray*}
f_{w}\nabla\cdot\left(\rho_{w}\mathbf{u^{*}}\right) & = & f_{w}\rho_{ws}\mathbf{u^{*}}\cdot\frac{dB_{w}^{-1}}{dp}\nabla p+\frac{f_{w}\rho_{ws}}{B_{w}}\left[\nabla\cdot\mathbf{u+\lambda_{o}k\:}\mathbf{g}\cdot\nabla p\left\{ \rho_{ws}\frac{dB_{w}^{-1}}{dp}-\rho_{os}\frac{dB_{o}^{-1}}{dp}\right\} \right]\\
 &  & +\frac{f_{w}\rho_{ws}}{B_{w}}\left[\mathbf{k\: g}\cdot\left\{ \left(\rho_{w}-\rho_{o}\right)\frac{d\lambda_{o}}{dS_{w}}\nabla S_{w}\right\} \right]
\end{eqnarray*}

\end_inset


\begin_inset Formula 
\begin{eqnarray*}
f_{w}\nabla\cdot\left(\rho_{w}\mathbf{u^{*}}\right) & = & f_{w}\rho_{ws}\left\{ \frac{1}{B_{w}}\nabla\cdot\mathbf{u}+\mathbf{u^{*}}\cdot\frac{dB_{w}^{-1}}{dp}\nabla p+\frac{1}{B_{w}}\mathbf{\lambda_{o}k\:}\mathbf{g}\cdot\nabla p\left\{ \rho_{ws}\frac{dB_{w}^{-1}}{dp}-\rho_{os}\frac{dB_{o}^{-1}}{dp}\right\} \right\} \\
 &  & +\frac{f_{w}\rho_{ws}}{B_{w}}\left[\mathbf{k\: g}\cdot\left\{ \left(\rho_{w}-\rho_{o}\right)\frac{d\lambda_{o}}{dS_{w}}\nabla S_{w}\right\} \right]
\end{eqnarray*}

\end_inset


\end_layout

\begin_layout Standard
The second line remains in the LHS
\end_layout

\begin_layout Standard
Here I will clarify how I call each of the terms inside por_elmprs
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{eqnarray}
f_{w}\nabla\cdot\left(\rho_{w}\mathbf{u^{*}}\right) & = & f_{w}\rho_{ws}\left\{ \frac{1}{B_{w}}\nabla\cdot\mathbf{u}+\frac{dB_{w}^{-1}}{dp}\underset{\overbrace{\mathbf{u^{*}}\cdot\nabla p}}{auxi1}+\frac{1}{B_{w}}\lambda_{o}\underset{\overbrace{\mathbf{k\:}\mathbf{g}\cdot\nabla p}}{auxi2}\underset{\overbrace{\left\{ \rho_{ws}\frac{dB_{w}^{-1}}{dp}-\rho_{os}\frac{dB_{o}^{-1}}{dp}\right\} }}{auxi3}\right\} \label{eq:div_rho_u-satur}\\
 &  & +\underset{\overbrace{\left\{ \frac{f_{w}\rho_{ws}}{B_{w}}\left(\rho_{w}-\rho_{o}\right)\frac{d\lambda_{o}}{dS_{w}}\mathbf{k\: g}\right\} }}{gpadv(2nd\, term)}\cdot\nabla S_{w}\nonumber 
\end{eqnarray}

\end_inset


\end_layout

\begin_layout Subsubsection*
Regarding the mass matrix
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
 
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
from 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:cwsw"

\end_inset


\begin_inset Formula 
\[
c_{wSw}=\left(\frac{\phi}{B_{w}}\right)^{l}
\]

\end_inset

Since 
\begin_inset Formula $\phi$
\end_inset

 is an elemental property I believe the best will be to obtain the the mass
 matrix integrating at the gauss point and not using vmass 
\begin_inset Formula 
\[
\int\frac{\rho_{ws}}{\triangle t}c_{wSw}N^{I}N^{J}
\]

\end_inset

Option 1 for lumping would be to use directly 
\begin_inset Formula 
\[
\int\frac{\rho_{ws}}{\triangle t}c_{wSw}N^{I}
\]

\end_inset


\end_layout

\begin_layout Standard
Option 2 would be to use a closed integration rule in that case it would
 seem logical to integrate all of the terms with a closed rule.
\end_layout

\begin_layout Standard
Option 3 would be to smooth 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $c_{wSw}$
\end_inset

 .
 This could be done by smoothing the porosity at the beginning of the run
 and then obtaining 
\begin_inset Formula $B_{w}$
\end_inset

 directly at the nodes from the nodal values of 
\begin_inset Formula $S_{w}$
\end_inset


\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
I talked to Mariano and he did not see much difference .
 He recommended to use Option 3.
 
\end_layout

\begin_layout Standard
One final comment on the mass matrix 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula 
\[
\frac{\rho_{ws}}{\triangle t}\left[\left(\frac{\phi S_{w}}{B_{w}}\right)^{l}-\left(\frac{\phi S_{w}}{B_{w}}\right)^{n}+c_{wp}\delta p+c_{wSw}\delta S_{w}\right]
\]

\end_inset

 The only term that remains is 
\begin_inset Formula 
\begin{equation}
\frac{\rho_{ws}\, c_{wSw}}{\triangle t}\delta S_{w}\label{eq:Satur-mass-matrix}
\end{equation}

\end_inset

since
\begin_inset Formula $\delta p=0$
\end_inset

 if we are solving explicitly and the first 2 terms cancel out each other.
 If we want to do the implicit case and solve for 
\begin_inset Formula $S_{w}$
\end_inset

 we rewrite this as 
\begin_inset Formula 
\[
\frac{\rho_{ws}\, c_{wSw}}{\triangle t}\left(S_{w}^{n+1}-S_{w}^{n}\right)
\]

\end_inset

 For the explicit case I have been having a look at Alya and I believe the
 best is to use 
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
kfl_algso==9 and kfl_preco=10 then what we get is 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
(see soldia)
\end_layout

\begin_layout Standard
unkno(ipoin)=unkno(ipoin)+rhsid(ipoin)*pmatr(ipoin)/vmass(ipoin).
 
\end_layout

\begin_layout Standard
setting 
\begin_inset Formula 
\[
pmatr(ipoin)=\frac{\triangle t}{\rho_{ws}\, c_{wSw}}=\frac{B_{w}\triangle t}{\rho_{ws}\,\phi}=\frac{B_{w}}{\rho_{ws}\,\phi*dtinv}
\]

\end_inset

 and doing only one iteration we get exactly what we want!!!! This is done
 in por_massma.
\end_layout

\begin_layout Standard
What I am still missing is how 
\begin_inset Formula $q_{w}$
\end_inset

 is treated.
\end_layout

\begin_layout Standard
Beware up to version 2515 (20-8-13) the term 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\frac{1}{\rho_{ws}}$
\end_inset

was missing in pmatr due to the fact that it was missing in the corresponding
 term in this section.
\end_layout

\begin_layout Section
Data files Brugge
\end_layout

\begin_layout Subsection
Initial conditions
\end_layout

\begin_layout Standard
Pressure constant in Brugge.data (L279).
 Saturation given per element (swat.dat- I will transform it externally into
 a format readable by Alya).
 I should read it per element and then smooth to obtain an initial nodal
 values.
\end_layout

\begin_layout Standard

\color blue
SWATE
\color inherit
(npoin) this should go in the master- 
\color blue
SWAEL_POR(nelem)
\color inherit
 this are the elemental values that are read an then smoothed into SWATE
\end_layout

\begin_layout Subsection
Properties
\end_layout

\begin_layout Itemize
satnum.dat Kind of material then determines which of the 7 Relative Permeabilitie
s and Pcog given in Brugge.data should be used .
 I think that he we can use materials from Alya without much problem.
 This goes into materials.
 
\end_layout

\begin_layout Itemize
Then obviously I would have to read Relative Permeabilities and Pcog and
 put them In some kind of table.
 For the moment I will prepare a table 
\color blue
krpct (mrows,3+1,7)
\color inherit
 Where mrows is the maximum 
\color blue
nrows(imate)
\color inherit
 .
 In Brugge mats 1 to 6 have 
\color blue
nrows=24
\color inherit
 mat 7 has 3.
 
\end_layout

\begin_layout Itemize
actnum.dat Just says if cells are active or not When I write the mesh for
 alya.
 We eliminate unused cells so this is no longer needed
\end_layout

\begin_layout Itemize
ntg.dat.
 used to eliminate cells during transf to alya but not 0 or 1 values I believe
 should be used to multiply poro.
 so finally they just enter y a new poro.
 confirm with Ruben.
\end_layout

\begin_layout Itemize
poro.dat and perm.dat elemental values 
\color blue
POROS_POR(nelem)
\color inherit
 and 
\color blue
PERME_POR(ndime,NELEM)
\color inherit
 .
 Guillaume suggested introduce with fields-- Manual or ask Ruth.
 Esta en el manual en file:///Users/howen/svn/Alya/Documents/doxygen/html/Domain
_input_data.html#Domain_inputdata.
 FIELDS, NUMBER= int FIELD= int, DIMENSION= int, NODE/ELEMENT/BOUNDARY int
 real...
 $ Element/node/boundary, value1, value2...
 END_FIELD END_FIELDS Luego habrá que evr como pasar ese field a la variable
 que toque pero nodeberái haber mayor problema.creoq ue lo hicimos con un
 fiel nodal con Benjamin.
 En lo de Benjamin lo usabamos paar codigos es nodos y poniamos CODES, NODES
 -1 000 1 END_CODES .
 el - inicial hacia que se usara lo de field pero aca no es para un codigo
 revisar bien como hacerlo.
 Pero no debería ser dificil.
\end_layout

\begin_layout Itemize
PVCDO -- pvt for live oil -- Pressure Bo compressibility viscosity 170 0.978
 1.3430E-4 1.294 .
 basically it is 4 values reference press, Bo, comp,and viscosity-- the
 same for water 
\color blue
RPREW, B_WAT, COMPW, VISCW, RPREO, B_OIL, COMPO, VISCO
\color inherit
.
 Pero tambien podría pensarlo de otra manera.
\end_layout

\begin_layout Subsection
Units
\end_layout

\begin_layout Standard
For Eclipse the default is metric (p797).
 This is what I will put in the table
\end_layout

\begin_layout Standard
\begin_inset Tabular
<lyxtabular version="3" rows="10" columns="4">
<features tabularvalignment="middle">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
eclipse(METRIC)
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Alya
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
eclipse2alya
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
pressure
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $bar$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $Pa$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $*1e5$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
time
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $days$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $s$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $*86400$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $B_{o}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $m^{3}/sm^{3}$
\end_inset

 actually non dim
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $c_{o}$
\end_inset

- oil compres 
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $1/bar$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $1/Pa$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $*1e-5$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\mu$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
cP
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Pa.s
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $*1e-3$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\rho$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $kg/m^{3}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $kg/m^{3}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
perme
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
mD (millidarcy)
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula $m^{2}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $*9.869233e-16$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
kro-krw
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
nondim (between 0&1)
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
nondim
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
q
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
m3/day
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
m3/s
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
/(3600*24)
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Standard
Flow rate: actually I give Alya the mass flow rate therefore after obtainig
 the volumetric flow rate I have to multiply by the std density.
 
\end_layout

\begin_layout Standard
1 Darcy = 9.869233e-13 m2 then 1 mDarcy = 9.869233e-16 m2
\end_layout

\begin_layout Subsubsection
Review- where do eclipse uniots come from
\end_layout

\begin_layout Standard
From Keyword reference Eclipse.pdf:
\end_layout

\begin_layout Standard
p1603 PERMX we see taht for all unit sistems the perm is always in mD.
\end_layout

\begin_layout Standard
p 1694_ PVTW- for reference pressure barsa(en metric) is used , for viscosity
 cP
\end_layout

\begin_layout Standard
Flow rate: it can be seen in xx.RSM .
 units PVTW SM3/DAY
\end_layout

\begin_layout Subsubsection
Example in values from repsol
\end_layout

\begin_layout Standard
de /gpfs/projects/bsc21/WORK-HERBERT/repsol/sent_by_repsol/cube/2013_07_10_Sinte
tic_Data/low_case_ECLIPSE/BRUGGE.DATA
\end_layout

\begin_layout Standard
PORO 2000*0.15 /
\end_layout

\begin_layout Standard
PERMX 2000*800 /
\end_layout

\begin_layout Standard
Entiendo que perm es en mD paar pasar a 
\begin_inset Formula $m^{2}$
\end_inset

 hay que mult 
\begin_inset Formula $*9.869233e-16$
\end_inset


\end_layout

\begin_layout Standard
con lo cual obtengo permx=7.888E-013 
\end_layout

\begin_layout Standard
la visco water es segun BRUGGE_PVT.inc 0.320cP=3.2e-4Pa.s
\end_layout

\begin_layout Standard
y al water dens 
\begin_inset Formula $1002.7623kg/m^{3}$
\end_inset


\end_layout

\begin_layout Subsection
IJK
\end_layout

\begin_layout Standard

\color blue
IJKNO_POR & IJKEL_POR
\color inherit
 .
 We should input to Alya the IJK values for the nodes.
 In order to be able to give the wells by IJK.
 If the wells do not reach the bottom(note that in brugge.well P08 only reaches
 level 8 not 9 but I do not know if the mesh only reaches 8) we should also
 store the values for elements and take this into account when obtaining
 equivalent radius.
 Check exactly how.
 Again using a nodal field -- and also post process
\end_layout

\begin_layout Standard
Finally I believe I will not use this.
 I will give Alya a list of size npoint giving each point a nonzero value
 if it is a well or inj.
 Positive for well; negative for inj.
 Actually I believe I do not need this info, but just in case.
\end_layout

\begin_layout Subsection
Other variables
\end_layout

\begin_layout Standard
In the master I will add Satwa, and the pressure and velocity I already
 have them there just allocate.
\end_layout

\begin_layout Standard
En inirun puse que POROUS es el numero 24.
 Tambien ID_POROUS= 24 en def_master.
 And also ID_WASAT=34 ! Water Saturation for Porous Flow---- wasat(:) !
 34: Water Saturation 
\end_layout

\begin_layout Subsubsection
Time integration
\end_layout

\begin_layout Standard
kfl_timei_por(2)
\end_layout

\begin_layout Standard
kfl_tisch_por(2)
\end_layout

\begin_layout Standard
ncomp_por(2)
\end_layout

\begin_layout Standard
kfl_tiacc_por(2)
\end_layout

\begin_layout Subsubsection
advective term
\end_layout

\begin_layout Standard
kfl_advec_por(iprsa)
\end_layout

\begin_layout Subsubsection
Subgrid scales
\end_layout

\begin_layout Standard
kfl_sgsve_por(iprsa)
\end_layout

\begin_layout Subsection
Solvers in Alya
\end_layout

\begin_layout Standard
./kernel/master/soldef.f90
\end_layout

\begin_layout Standard
\begin_inset Tabular
<lyxtabular version="3" rows="3" columns="3">
<features tabularvalignment="middle">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
kfl_algso
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
solve_sol(ivari) % wsolv
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
reasol
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-2
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
RICHARDSON ITERATION
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
???
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
9
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
RICHARDSON
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
DIAGO
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Standard
Still do not know the difference between these 2.
 But I guess they are the way of doing kind of an explicit.
\end_layout

\begin_layout Standard
En wav_reanut dice solve(1)%kfl_algso = -2 ! Explicit scheme.
 Pero parece ser el único lugar donde aparece.
 Así que supongo que el correcto es el 9.
\end_layout

\begin_layout Subsubsection
Some observations about kfl_algso==9
\end_layout

\begin_layout Itemize
Solver calls presol(itask=0) instead of 1 so that only RHS is modified not
 matrix for periodicity.
\end_layout

\begin_layout Itemize
luego call soldia(bb_idofn,xx_idofn,aa_idofn,pmatr) ! Diagonal solver
\end_layout

\begin_layout Itemize
soldia: 
\end_layout

\begin_deeper
\begin_layout Itemize
kfl_preco==5 unkno(ipoin)=unkno(ipoin)+rhsid(ipoin)*xdiag/vmass(ipoin) ----usa
 vmass; 
\end_layout

\begin_layout Itemize
7 -- usa vmasc
\end_layout

\begin_layout Itemize
10 -- unkno(ipoin)=unkno(ipoin)+rhsid(ipoin)*pmatr(ipoin)/vmass(ipoin) --
 osea en lugar de xdiag cte -- pmatr(ipoin) este me puede venir mejor
\end_layout

\begin_layout Itemize
14 un poco mas complicado
\end_layout

\end_deeper
\begin_layout Itemize
Creo que voy a usar kfl_preco=10
\end_layout

\begin_layout Itemize
Una duda sobre pmatr es un pointer definido en def_master ...
 pero en nsi_assdia entra como un real es esto correcto????? En por_massma
 evito este problema haciendo un use de pmatr directamente.
\end_layout

\begin_layout Section
Unidades
\end_layout

\begin_layout Subsection
well 2d
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\frac{k\rho h_{3}}{\mu}\sum_{K\subset\Omega_{0}}\int_{K}\nabla p\cdot\nabla\varphi_{0}d\mathbf{x}=q\label{eq:equiv_radius_prelim1-2}
\end{equation}

\end_inset


\begin_inset Formula 
\[
\frac{m^{2}kg\, m}{m^{3}Pa\, s}\frac{Pa}{m}\frac{1}{m}m^{2}=\frac{kg}{s}
\]

\end_inset

Simplifico lado izq
\begin_inset Formula 
\[
\frac{kg}{s}=\frac{kg}{s}
\]

\end_inset


\end_layout

\begin_layout Standard
Con lo cual todo verifica!!!!!!!!!!!!!!!!!
\end_layout

\begin_layout Subsection
well 3d- 3D - isotropic in xy - what we need for Brugge
\end_layout

\begin_layout Standard
Actually, we leave perme inside the integral.
 The units also verify.
 h3 disappears, but we have a volume integral so everything remains nearly
 the same.
\end_layout

\begin_layout Section
Possible benchmark cases
\end_layout

\begin_layout Enumerate
Conning problem : fig 7.10 Chen
\end_layout

\begin_layout Enumerate
Analytic solution 6.15 Chen p 251.
\end_layout

\begin_layout Section
Saturation 
\end_layout

\begin_layout Subsection
Wells following Malta & Loula - 
\end_layout

\begin_layout Standard
Malta & Loula is for miscible displacements.
 First I need to find an equivalent to eq 1.1 from paper in 2 phase flow.
 From 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:mass-cons-alpha"

\end_inset


\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula 
\[
\frac{\partial}{\partial t}\left(\phi\ \rho_{\alpha}\ S_{\alpha}\right)+\rho_{\alpha}\nabla\cdot\mathbf{u}_{\alpha}+\mathbf{u}_{\alpha}\cdot\nabla\rho_{\alpha}=q_{\alpha}
\]

\end_inset


\end_layout

\begin_layout Standard
that can be rewritten as 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula 
\[
\nabla\cdot\mathbf{u}_{\alpha}=\frac{1}{\rho_{\alpha}}\left\{ q_{\alpha}-\frac{\partial}{\partial t}\left(\phi\ \rho_{\alpha}\ S_{\alpha}\right)-\mathbf{u}_{\alpha}\cdot\nabla\rho_{\alpha}\right\} 
\]

\end_inset

If we add for oil and water we get
\begin_inset Formula 
\[
\nabla\cdot\mathbf{u}=\nabla\cdot\mathbf{u}_{o}+\nabla\cdot\mathbf{u}_{w}=\frac{1}{\rho_{o}}\left\{ q_{o}-\frac{\partial}{\partial t}\left(\phi\ \rho_{o}\ S_{o}\right)-\mathbf{u}_{o}\cdot\nabla\rho_{o}\right\} +\frac{1}{\rho_{w}}\left\{ q_{w}-\frac{\partial}{\partial t}\left(\phi\ \rho_{w}\ S_{w}\right)-\mathbf{u}_{w}\cdot\nabla\rho_{w}\right\} 
\]

\end_inset

This could be our equivalent to 
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
eq 1.1 .
 It is clearly more complicated.
 
\end_layout

\begin_layout Standard
This could now be replaced into the water transport equation 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:water-transp-convec-1"

\end_inset

(where for the moment we shall suppose 
\begin_inset Formula $g=0$
\end_inset

 and therefore 
\begin_inset Formula $\mathbf{u^{*}}=\mathbf{u}$
\end_inset

) 
\begin_inset Formula 
\[
\frac{\partial}{\partial t}\left(\phi\ \rho_{w}\ S_{w}\right)+\rho_{w}\mathbf{u}\cdot\frac{\partial f_{w}}{\partial S_{w}}\nabla S_{w}+f_{w}\nabla\cdot\left(\rho_{w}\mathbf{u}\right)=q_{w}
\]

\end_inset


\end_layout

\begin_layout Standard
Which we can further expand as 
\begin_inset Formula 
\[
\frac{\partial}{\partial t}\left(\phi\ \rho_{w}\ S_{w}\right)+\rho_{w}\mathbf{u}\cdot\frac{\partial f_{w}}{\partial S_{w}}\nabla S_{w}+f_{w}\rho_{w}\nabla\cdot\mathbf{u}+f_{w}\mathbf{u}\cdot\nabla\rho_{w}=q_{w}
\]

\end_inset

Where bow I will replace the divergence of the velocity an hope something
 nice comes out
\begin_inset Formula 
\[
\frac{\partial}{\partial t}\left(\phi\ \rho_{w}\ S_{w}\right)+\rho_{w}\mathbf{u}\cdot\frac{\partial f_{w}}{\partial S_{w}}\nabla S_{w}+f_{w}\rho_{w}\left\{ \frac{1}{\rho_{o}}\left\{ q_{o}-\frac{\partial}{\partial t}\left(\phi\ \rho_{o}\ S_{o}\right)-\mathbf{u}_{o}\cdot\nabla\rho_{o}\right\} +\frac{1}{\rho_{w}}\left\{ q_{w}-\frac{\partial}{\partial t}\left(\phi\ \rho_{w}\ S_{w}\right)-\mathbf{u}_{w}\cdot\nabla\rho_{w}\right\} \right\} +f_{w}\mathbf{u}\cdot\nabla\rho_{w}=q_{w}
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\frac{\partial}{\partial t}\left(\phi\ \rho_{w}\ S_{w}\right)+\rho_{w}\mathbf{u}\cdot\frac{\partial f_{w}}{\partial S_{w}}\nabla S_{w}+f_{w}\frac{\rho_{w}}{\rho_{o}}\left\{ q_{o}-\frac{\partial}{\partial t}\left(\phi\ \rho_{o}\ S_{o}\right)-\mathbf{u}_{o}\cdot\nabla\rho_{o}\right\} +f_{w}\left\{ q_{w}-\frac{\partial}{\partial t}\left(\phi\ \rho_{w}\ S_{w}\right)-\mathbf{u}_{w}\cdot\nabla\rho_{w}\right\} +f_{w}\mathbf{u}\cdot\nabla\rho_{w}=q_{w}
\]

\end_inset


\end_layout

\begin_layout Standard
I will now take into account that 
\begin_inset Formula $S_{o}=1-S_{w}$
\end_inset

and regroup all transient terms.
\begin_inset Formula 
\[
\left(1-f_{w}\right)\frac{\partial}{\partial t}\left(\phi\ \rho_{w}\ S_{w}\right)-f_{w}\frac{\rho_{w}}{\rho_{o}}\frac{\partial}{\partial t}\left(\phi\ \rho_{o}\ \left(1-S_{w}\right)\right)+\rho_{w}\mathbf{u}\cdot\frac{\partial f_{w}}{\partial S_{w}}\nabla S_{w}+f_{w}\left\{ \mathbf{u}\cdot\nabla\rho_{w}-\mathbf{u}_{w}\cdot\nabla\rho_{w}-\frac{\rho_{w}}{\rho_{o}}\mathbf{u}_{o}\cdot\nabla\rho_{o}\right\} =q_{w}-f_{w}q_{w}-f_{w}\frac{\rho_{w}}{\rho_{o}}q_{o}
\]

\end_inset


\end_layout

\begin_layout Standard
I have so far eliminated the term for the velocity divergence.
 If I operate further I get
\begin_inset Formula 
\[
\left(1-f_{w}\right)\frac{\partial}{\partial t}\left(\phi\ \rho_{w}\ S_{w}\right)+f_{w}\frac{\rho_{w}}{\rho_{o}}\frac{\partial}{\partial t}\left(\phi\ \rho_{o}\ S_{w}\right)-f_{w}\frac{\rho_{w}}{\rho_{o}}\frac{\partial}{\partial t}\left(\phi\ \rho_{o}\right)+\rho_{w}\mathbf{u}\cdot\frac{\partial f_{w}}{\partial S_{w}}\nabla S_{w}+f_{w}\left\{ \mathbf{u}\cdot\nabla\rho_{w}-\mathbf{u}_{w}\cdot\nabla\rho_{w}-\frac{\rho_{w}}{\rho_{o}}\mathbf{u}_{o}\cdot\nabla\rho_{o}\right\} =q_{w}-f_{w}q_{w}-f_{w}\frac{\rho_{w}}{\rho_{o}}q_{o}
\]

\end_inset

Reordering 
\begin_inset Formula 
\[
\left(1-f_{w}\right)\frac{\partial}{\partial t}\left(\phi\ \rho_{w}\ S_{w}\right)+f_{w}\frac{\rho_{w}}{\rho_{o}}\frac{\partial}{\partial t}\left(\phi\ \rho_{o}\ S_{w}\right)+\rho_{w}\mathbf{u}\cdot\frac{\partial f_{w}}{\partial S_{w}}\nabla S_{w}=q_{w}-f_{w}q_{w}-f_{w}\frac{\rho_{w}}{\rho_{o}}q_{o}+f_{w}\frac{\rho_{w}}{\rho_{o}}\frac{\partial}{\partial t}\left(\phi\ \rho_{o}\right)-f_{w}\left\{ \mathbf{u}\cdot\nabla\rho_{w}-\mathbf{u}_{w}\cdot\nabla\rho_{w}-\frac{\rho_{w}}{\rho_{o}}\mathbf{u}_{o}\cdot\nabla\rho_{o}\right\} 
\]

\end_inset

here I still have to understand how to deal with the term 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $f_{w}\frac{\rho_{w}}{\rho_{o}}\frac{\partial}{\partial t}\left(\phi\ \rho_{o}\right)$
\end_inset

.
 Perhaps I could neglect it since both 
\begin_inset Formula $\phi$
\end_inset

 and 
\begin_inset Formula $\rho_{o}$
\end_inset

 only depend on the pressure?? This would agree with the fact that in 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Review-prior-to"

\end_inset

 we set 
\begin_inset Formula $\delta p=0$
\end_inset

.
 And taking into account that in that same section the term
\begin_inset Formula $\frac{\partial}{\partial t}\left(\phi\ \rho_{w}\ S_{w}\right)$
\end_inset

 had ended as 
\begin_inset Formula $\frac{\rho_{ws}}{\triangle t}c_{wSw}\delta S_{w}$
\end_inset

 or 
\begin_inset Formula $\frac{\rho_{ws}}{\triangle t}\left(\frac{\phi}{B_{w}}\right)^{l}\delta S_{w}$
\end_inset

 Now we would have
\begin_inset Formula 
\begin{eqnarray*}
\left(1-f_{w}\right)\frac{\partial}{\partial t}\left(\phi\ \rho_{w}\ S_{w}\right)+f_{w}\frac{\rho_{w}}{\rho_{o}}\frac{\partial}{\partial t}\left(\phi\ \rho_{o}\ S_{w}\right) & \simeq & \begin{aligned}\end{aligned}
\left(1-f_{w}\right)\frac{\rho_{ws}}{\triangle t}\left(\frac{\phi}{B_{w}}\right)^{l}\delta S_{w}+f_{w}\frac{\rho_{ws}}{\rho_{os}}\left(\frac{B_{w}}{B_{o}}\right)^{l}\frac{\rho_{wo}}{\triangle t}\left(\frac{\phi}{B_{o}}\right)^{l}\delta S_{w}\\
 & = & \left(1-f_{w}\right)\frac{\rho_{ws}}{\triangle t}\left(\frac{\phi}{B_{w}}\right)^{l}\delta S_{w}+f_{w}\left(\frac{\phi}{B_{w}}\right)^{l}\frac{\rho_{ws}}{\triangle t}\delta S_{w}\\
 &  & =\frac{\rho_{ws}}{\triangle t}\left(\frac{\phi}{B_{w}}\right)^{l}\delta S_{w}
\end{eqnarray*}

\end_inset


\end_layout

\begin_layout Standard
Therefore the transient term remains unaltered !!!!!!!!!!!! 
\end_layout

\begin_layout Standard
The convective term has also not been modified.
 So the only thing that changes is the RHS
\begin_inset Formula 
\[
RHS=q_{w}-f_{w}q_{w}-f_{w}\frac{\rho_{w}}{\rho_{o}}q_{o}+f_{w}\frac{\rho_{w}}{\rho_{o}}\frac{\partial}{\partial t}\left(\phi\ \rho_{o}\right)-f_{w}\left\{ \mathbf{u}\cdot\nabla\rho_{w}-\mathbf{u}_{w}\cdot\nabla\rho_{w}-\frac{\rho_{w}}{\rho_{o}}\mathbf{u}_{o}\cdot\nabla\rho_{o}\right\} 
\]

\end_inset

Where we have already mentioned that 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
we set 
\begin_inset Formula $\frac{\partial}{\partial t}\left(\phi\ \rho_{o}\right)=0$
\end_inset

 since both 
\begin_inset Formula $\phi$
\end_inset

 and 
\begin_inset Formula $\rho_{o}$
\end_inset

 only depend on the pressure and we are setting we set 
\begin_inset Formula $\delta p=0$
\end_inset

.
 So 
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit

\begin_inset Formula 
\[
RHS=q_{w}-f_{w}q_{w}-f_{w}\frac{\rho_{w}}{\rho_{o}}q_{o}-f_{w}\left\{ \mathbf{u}\cdot\nabla\rho_{w}-\mathbf{u}_{w}\cdot\nabla\rho_{w}-\frac{\rho_{w}}{\rho_{o}}\mathbf{u}_{o}\cdot\nabla\rho_{o}\right\} 
\]

\end_inset

Using 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Chen7.7"

\end_inset

 (
\begin_inset Formula $\mathbf{u}_{o}=\mathbf{u}-\mathbf{u}_{w}$
\end_inset

) we get 
\begin_inset Formula 
\[
RHS=q_{w}-f_{w}\left\{ q_{w}+\frac{\rho_{w}}{\rho_{o}}q_{o}+\mathbf{u}_{o}\cdot\left(\nabla\rho_{w}-\frac{\rho_{w}}{\rho_{o}}\nabla\rho_{o}\right)\right\} 
\]

\end_inset

The complete equation is then 
\begin_inset Formula 
\begin{equation}
\frac{\rho_{ws}}{\triangle t}\left(\frac{\phi}{B_{w}}\right)^{l}\delta S_{w}+\frac{\rho_{ws}}{B_{w}}\mathbf{u}\cdot\frac{\partial f_{w}}{\partial S_{w}}\nabla S_{w}=q_{w}-f_{w}\left\{ q_{w}+\frac{\rho_{w}}{\rho_{o}}q_{o}+\mathbf{u}_{o}\cdot\left(\nabla\rho_{w}-\frac{\rho_{w}}{\rho_{o}}\nabla\rho_{o}\right)\right\} \label{eq:Final_malta_loula_satur}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Now I have to compare with what I had in the RHS previously.
 
\end_layout

\begin_layout Standard
In order to recover what we have in alya by OCT 1 we start from 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:satur_review"

\end_inset

 with
\begin_inset Formula $\delta p=0$
\end_inset

 and 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:div_rho_u-satur"

\end_inset

 that we copy here
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula 
\begin{equation}
\frac{\rho_{ws}}{\triangle t}c_{wSw}\delta S_{w}=q_{w}-\frac{\rho_{ws}}{B_{w}}\mathbf{u^{*}}\cdot\frac{\partial f_{w}}{\partial S_{w}}\nabla S_{w}-\rho_{ws}\, f_{w}\nabla\cdot\left(\frac{1}{B_{w}}\mathbf{u^{*}}\right)\label{eq:satur_review-1}
\end{equation}

\end_inset


\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit

\begin_inset Formula 
\begin{eqnarray}
f_{w}\nabla\cdot\left(\rho_{w}\mathbf{u^{*}}\right) & = & f_{w}\rho_{ws}\left\{ \frac{1}{B_{w}}\nabla\cdot\mathbf{u}+\frac{dB_{w}^{-1}}{dp}\underset{\overbrace{\mathbf{u^{*}}\cdot\nabla p}}{auxi1}+\lambda_{o}\underset{\overbrace{\mathbf{k\:}\mathbf{g}\cdot\nabla p}}{auxi2}\underset{\overbrace{\frac{1}{B_{w}}\left\{ \rho_{ws}\frac{dB_{w}^{-1}}{dp}-\rho_{os}\frac{dB_{o}^{-1}}{dp}\right\} }}{auxi3}\right\} \label{eq:div_rho_u-satur-1}\\
 &  & +\underset{\overbrace{\left\{ \frac{f_{w}\rho_{ws}}{B_{w}}\left(\rho_{w}-\rho_{o}\right)\frac{d\lambda_{o}}{dS_{w}}\mathbf{k\: g}\right\} }}{gpadv(2nd\, term)}\cdot\nabla S_{w}\nonumber 
\end{eqnarray}

\end_inset


\end_layout

\begin_layout Standard
In the case without gravity it can all be put together in
\begin_inset Formula 
\begin{equation}
\frac{\rho_{ws}}{\triangle t}c_{wSw}\delta S_{w}+\frac{\rho_{ws}}{B_{w}}\mathbf{u}\cdot\frac{\partial f_{w}}{\partial S_{w}}\nabla S_{w}=q_{w}-\rho_{ws}\, f_{w}\frac{1}{B_{w}}\nabla\cdot\mathbf{u}-\rho_{ws}\, f_{w}\frac{dB_{w}^{-1}}{dp}\underset{\overbrace{\mathbf{u^{*}}\cdot\nabla p}}{auxi1}\label{eq:wasat_alya}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Now I can compare what we have currently in Alya 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:wasat_alya"

\end_inset

 with what we would like to implement like Malta and Loula treat it 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Final_malta_loula_satur"

\end_inset

 we would no longer need the terms 
\begin_inset Formula $-\rho_{ws}\, f_{w}\frac{1}{B_{w}}\nabla\cdot\mathbf{u}-\rho_{ws}\, f_{w}\frac{dB_{w}^{-1}}{dp}\underset{\overbrace{\mathbf{u^{*}}\cdot\nabla p}}{auxi1}$
\end_inset

 in the RHS and instead we would have
\end_layout

\begin_layout Standard
.
\end_layout

\begin_layout Standard
.
\begin_inset Formula 
\[
-f_{w}\left\{ q_{w}+\frac{\rho_{w}}{\rho_{o}}q_{o}+\mathbf{u}_{o}\cdot\left(\nabla\rho_{w}-\frac{\rho_{w}}{\rho_{o}}\nabla\rho_{o}\right)\right\} 
\]

\end_inset

This term can be further organized as 
\begin_inset Formula 
\[
-f_{w}\left\{ q_{w}+\frac{\rho_{ws}}{\rho_{os}}\frac{B_{o}}{B_{w}}q_{o}+f_{o}\mathbf{u}\cdot\left(\rho_{ws}\nabla\frac{1}{B_{w}}-\frac{\rho_{ws}}{\rho_{os}}\frac{B_{o}}{B_{w}}\rho_{os}\nabla\frac{1}{B_{o}}\right)\right\} 
\]

\end_inset


\begin_inset Formula 
\[
-f_{w}\left\{ q_{w}+\frac{\rho_{ws}}{\rho_{os}}\frac{B_{o}}{B_{w}}q_{o}+\rho_{ws}f_{o}\mathbf{u}\cdot\left(\nabla\frac{1}{B_{w}}-\frac{B_{o}}{B_{w}}\nabla\frac{1}{B_{o}}\right)\right\} 
\]

\end_inset


\begin_inset Formula 
\[
-f_{w}\left\{ q_{w}+\frac{\rho_{ws}}{\rho_{os}}\frac{B_{o}}{B_{w}}q_{o}+\rho_{ws}f_{o}\mathbf{u}\cdot\left(\frac{dB_{w}^{-1}}{dp}\nabla p-\frac{B_{o}}{B_{w}}\frac{dB_{o}^{-1}}{dp}\nabla p\right)\right\} 
\]

\end_inset


\begin_inset Formula 
\begin{equation}
-f_{w}\left\{ q_{w}+\frac{\rho_{ws}}{\rho_{os}}\frac{B_{o}}{B_{w}}q_{o}+\rho_{ws}f_{o}\left(\frac{dB_{w}^{-1}}{dp}-\frac{B_{o}}{B_{w}}\frac{dB_{o}^{-1}}{dp}\right)\mathbf{u}\cdot\nabla p\right\} \label{eq:malta-loula-final}
\end{equation}

\end_inset

The terms related to 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $q_{w}$
\end_inset

 and 
\begin_inset Formula $q_{o}$
\end_inset

 are introduced in por_wellte the rest are introduced in por_elmprs: gprhs.
\end_layout

\begin_layout Standard
How the terms related to 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $q_{w}$
\end_inset

 and 
\begin_inset Formula $q_{o}$
\end_inset

 are introduced depends if we set pbh, qw o qt.
\end_layout

\begin_layout Standard
In the previous implementation for the saturation equation we only needed
 to introduce qw when we set ..??'
\end_layout

\begin_layout Subsubsection
Pbh given
\end_layout

\begin_layout Standard
In this case we needed to add 
\begin_inset Formula 
\[
q_{w}=\frac{\rho_{ws}k_{rw}}{B_{w}\mu_{w}}WI^{M}\left(p_{bh}-p_{0}\right)
\]

\end_inset

We first pre-calculated wellt= krw*WI/(muw*BW) and then added to the rhs
 denwa_por * wellt * ( praux - press(ipoin,1) ) .
\end_layout

\begin_layout Standard
For the Malta and Loula case from 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:malta-loula-final"

\end_inset

we need to add 
\begin_inset Formula 
\[
q_{w}-f_{w}\left\{ q_{w}+\frac{\rho_{ws}}{\rho_{os}}\frac{B_{o}}{B_{w}}q_{o}\right\} 
\]

\end_inset

that is
\begin_inset Formula 
\[
q_{w}*\left(1-f_{w}\right)-f_{w}\frac{\rho_{ws}}{\rho_{os}}\frac{B_{o}}{B_{w}}q_{o}
\]

\end_inset

For the first term it is just multiply what we had by 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\left(1-f_{w}\right)$
\end_inset

.
 Then we have to calculate 
\begin_inset Formula $q_{o}$
\end_inset


\begin_inset Formula 
\[
q_{o}=\frac{\rho_{os}k_{ro}}{B_{o}\mu_{o}}WI^{M}\left(p_{bh}-p_{0}\right)
\]

\end_inset


\end_layout

\begin_layout Standard
So the whole thing reads
\begin_inset Formula 
\[
q_{w}*\left(1-f_{w}\right)-f_{w}\frac{\rho_{ws}}{\rho_{os}}\frac{B_{o}}{B_{w}}q_{o}
\]

\end_inset


\begin_inset Formula 
\[
\frac{\rho_{ws}k_{rw}}{B_{w}\mu_{w}}WI^{M}\left(p_{bh}-p_{0}\right)*\left(1-f_{w}\right)-f_{w}\frac{\rho_{ws}}{\rho_{os}}\frac{B_{o}}{B_{w}}\frac{\rho_{os}k_{ro}}{B_{o}\mu_{o}}WI^{M}\left(p_{bh}-p_{0}\right)
\]

\end_inset


\begin_inset Formula 
\[
\left\{ \left(1-f_{w}\right)\frac{k_{rw}}{\mu_{w}}-f_{w}\frac{k_{ro}}{\mu_{o}}\right\} \frac{\rho_{ws}}{B_{w}}WI^{M}\left(p_{bh}-p_{0}\right)
\]

\end_inset

Using 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:fw"

\end_inset

 and 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:lambda-alpha"

\end_inset


\begin_inset Formula 
\[
\left\{ \left(1-\frac{\frac{k_{rw}}{\mu_{w}}}{\frac{k_{rw}}{\mu_{w}}+\frac{k_{ro}}{\mu_{o}}}\right)\frac{k_{rw}}{\mu_{w}}-\frac{\frac{k_{rw}}{\mu_{w}}}{\frac{k_{rw}}{\mu_{w}}+\frac{k_{ro}}{\mu_{o}}}\frac{k_{ro}}{\mu_{o}}\right\} \frac{\rho_{ws}}{B_{w}}WI^{M}\left(p_{bh}-p_{0}\right)
\]

\end_inset


\begin_inset Formula 
\[
\frac{1}{\frac{k_{rw}}{\mu_{w}}+\frac{k_{ro}}{\mu_{o}}}\left\{ \left(\frac{k_{rw}}{\mu_{w}}+\frac{k_{ro}}{\mu_{o}}-\frac{k_{rw}}{\mu_{w}}\right)\frac{k_{rw}}{\mu_{w}}-\frac{k_{rw}}{\mu_{w}}\frac{k_{ro}}{\mu_{o}}\right\} \frac{\rho_{ws}}{B_{w}}WI^{M}\left(p_{bh}-p_{0}\right)
\]

\end_inset


\begin_inset Formula 
\[
\frac{1}{\frac{k_{rw}}{\mu_{w}}+\frac{k_{ro}}{\mu_{o}}}\left\{ \frac{k_{ro}}{\mu_{o}}\frac{k_{rw}}{\mu_{w}}-\frac{k_{rw}}{\mu_{w}}\frac{k_{ro}}{\mu_{o}}\right\} \frac{\rho_{ws}}{B_{w}}WI^{M}\left(p_{bh}-p_{0}\right)=0
\]

\end_inset

This is very good news this term disappears when pbh is imposed!!!!!!!!!!!!!!!!!
!!!!!!!!!!! This was what I was expecting!!!!!!!!!!!!!!! 
\end_layout

\begin_layout Standard
Still missing to analyze the cases of imposed water flow rate of total flow
 rate but for the moment I will try this!!!!!!!!!!!!!!!!!!!!
\end_layout

\begin_layout Standard
Moreover in the injector some special consideration must be taken into account
 to tell that all that is being injected is water.
 I believe I do not have this yet .
\end_layout

\begin_layout Subsubsection
Pbh given but it is a water injector
\end_layout

\begin_layout Standard
In this case all that is introduced is water so I guess that in this case
 we would have 
\begin_inset Formula 
\[
q_{w}=\frac{\rho_{ws}}{B_{w}\mu_{w}}WI^{M}\left(p_{bh}-p_{0}\right)
\]

\end_inset

that is I have set krw=1.
 But I am not at all sure about this reasoning.
 I should discuss this with Ruben.
\end_layout

\begin_layout Subsubsection
Water flow rate given
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
q_{w}=q_{w}^{data}
\]

\end_inset


\begin_inset Formula 
\[
q_{o}=0
\]

\end_inset


\end_layout

\begin_layout Standard
So the terms to be added in por_wellte are 
\begin_inset Formula 
\[
q_{w}-f_{w}\left\{ q_{w}+\frac{\rho_{ws}}{\rho_{os}}\frac{B_{o}}{B_{w}}q_{o}\right\} 
\]

\end_inset

 that then simplify to 
\begin_inset Formula 
\[
q_{w}\left(1-f_{w}\right)
\]

\end_inset


\end_layout

\begin_layout Subsubsection
Total flow rate given
\end_layout

\begin_layout Standard
I understand that it is just.
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
q_{w}=k_{rw}q_{T}
\]

\end_inset


\begin_inset Formula 
\[
q_{o}=k_{ro}q_{T}
\]

\end_inset

as we have already mentioned in 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:well_flow_rate_alpha"

\end_inset

.
\end_layout

\begin_layout Subsection
Comparison saturation equation to papers.
\end_layout

\begin_layout Standard
Here I briefly rewrite what I have in 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:How-do-we"

\end_inset

.
 Going back to the water mass conservation equation written as in 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:mass-cons-alpha"

\end_inset


\begin_inset Formula 
\[
\frac{\partial}{\partial t}\left(\phi\ \rho_{w}\ S_{w}\right)+\nabla\cdot\left(\rho_{w}\ \mathbf{u}_{w}\right)=q_{w}
\]

\end_inset

Following Sesini Coutinho 2010 (with the difference that they deal with
 incompressible) or Chen Sec 7.3.1 we can rewrite the previous equation using
 
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\mathbf{u}{}_{w}=f_{w}\mathbf{u}+kf_{w}\lambda_{o}\left(\rho_{w}-\rho_{o}\right)g\nabla z\label{eq:watervel-1}
\end{equation}

\end_inset


\end_layout

\begin_layout Subsubsection
Comparison with Enief 2003 Souza Sesini coutinho
\end_layout

\begin_layout Standard
From eq 3 with zero critical pressure we get 
\begin_inset Formula 
\begin{equation}
\phi\frac{\partial}{\partial t}S_{w}+\nabla\cdot\mathbf{u}_{a}+q_{w}=0\label{eq:Satur_souza_sesini}
\end{equation}

\end_inset

obviously he has the sign convention for Q inverse to me.
 In the case without gravity zero
\begin_inset Formula $\mathbf{u}_{a}$
\end_inset


\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
 corresponds to the water velocity so we would have the same in the case
 I consider incompressible rock and fluid.
 
\end_layout

\begin_layout Standard
Then in 3.1 they present the FE discrete but they do not do anything similar
 to eq 2.7 p 522 Miscible displacements in porous media.
 Then they would have the same problem as me close to the wells.
\end_layout

\begin_layout Standard
I went also to Silva Thesis It is very nicely written including moderately
 compressible.
 The Saturation equation is written idem to 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Satur_souza_sesini"

\end_inset

.
 That is there is no compensation as in Malta Loula Miscible displ.
 The key point is that they must not have any problem because they treat
 the injectors and producers as a boundary condition not as a point source!!!!!!
 see eq 2.41.
\end_layout

\begin_layout Section
Obs Ruben
\end_layout

\begin_layout Standard
krw eclipse usa interpolacion spline.
\end_layout

\begin_layout Section
Silva not very nice in pressure equation
\end_layout

\begin_layout Standard
Starting from 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:mass-cons-alpha-1"

\end_inset

 and expanding transient term and dividing by 
\begin_inset Formula $\rho_{\alpha}$
\end_inset

 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula 
\[
S_{\alpha}\frac{\partial\phi}{\partial t}+\phi\frac{S_{\alpha}}{\rho_{\alpha}}\frac{\partial\rho_{\alpha}}{\partial p}\frac{\partial p}{\partial t}+\phi\frac{\partial S_{\alpha}}{\partial t}+\frac{1}{\rho_{\alpha}}\nabla\cdot\left(\rho_{\alpha}\ \mathbf{u}_{\alpha}\right)=\frac{q_{\alpha}}{\rho_{\alpha}}
\]

\end_inset

Adding the previous equation for oil and water and taking into account 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:sum_satur"

\end_inset


\begin_inset Formula 
\[
\frac{\partial\phi}{\partial t}+\phi\left(\frac{S_{o}}{\rho_{o}}\frac{\partial\rho_{o}}{\partial p}+\frac{S_{w}}{\rho_{w}}\frac{\partial\rho_{w}}{\partial p}\right)\frac{\partial p}{\partial t}+\frac{1}{\rho_{o}}\nabla\cdot\left(\rho_{o}\ \mathbf{u}_{o}\right)+\frac{1}{\rho_{w}}\nabla\cdot\left(\rho_{w}\ \mathbf{u}_{w}\right)=\frac{q_{o}}{\rho_{o}}+\frac{q_{w}}{\rho_{w}}
\]

\end_inset


\end_layout

\begin_layout Standard
Using the oil and water compressibility from Silva 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:oil_comp_silva"

\end_inset

 and Darcy's law
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula 
\[
\frac{\partial\phi}{\partial t}+\phi\left(S_{o}c_{o}+S_{w}c_{w}\right)\frac{\partial p}{\partial t}-\frac{1}{\rho_{o}}\nabla\cdot\left(\rho_{o}\ K\lambda_{o}\nabla p\right)-\frac{1}{\rho_{w}}\nabla\cdot\left(\rho_{w}\ K\lambda_{w}\nabla p\right)=\frac{q_{o}}{\rho_{o}}+\frac{q_{w}}{\rho_{w}}
\]

\end_inset

Beware en eq 2.11 Silva puts 
\begin_inset Formula $\frac{1}{\rho_{o}}$
\end_inset

 inside 
\begin_inset Formula $\nabla\cdot$
\end_inset

 This is not clear at all!!!!!!!!!!!! I leave it here 
\end_layout

\begin_layout Standard
In Silva they define 
\begin_inset Formula 
\begin{equation}
c_{o}=\frac{1}{\rho_{o}}\frac{\partial\rho_{o}}{\partial p}\label{eq:oil_comp_silva}
\end{equation}

\end_inset

and idem for water.
 
\end_layout

\begin_layout Section
Clean reduced version 
\begin_inset CommandInset label
LatexCommand label
name "sec:Clean-reduced-version"

\end_inset


\end_layout

\begin_layout Subsection
Definitions
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula 
\begin{equation}
\lambda_{\alpha}=\frac{k_{r\alpha}}{\mu_{\alpha}}\label{eq:lambda-alpha-1}
\end{equation}

\end_inset


\begin_inset Formula 
\begin{equation}
f_{w}=\frac{\lambda_{w}}{\lambda_{w}+\lambda_{o}}\label{eq-fractional_flow}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula 
\begin{equation}
\rho_{\alpha}=\frac{\rho_{\alpha s}}{B_{\alpha}}\label{eq:rho_alpha_std}
\end{equation}

\end_inset


\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
The formation volume factor is defined in page 12 Chen as (see 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Balpha"

\end_inset


\begin_inset Formula 
\begin{equation}
B\left(p,T\right)=\frac{V\left(p,T\right)}{V_{s}}\label{eq:Balpha-1}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
B_{w}(P)=\frac{B_{w}(P_{ref})}{1+X+\left(X^{2}/2\right)}
\]

\end_inset

with
\begin_inset Formula 
\[
X=c_{w}\left(P-P_{ref}\right)
\]

\end_inset

Rock compresibility
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
V(P)=V(Pref)\left[1+X+\frac{X^{2}}{2}\right]
\]

\end_inset


\begin_inset Formula 
\[
X=c_{r}\left(P-P_{ref}\right)
\]

\end_inset


\end_layout

\begin_layout Standard
-----------------------------------------------------------------
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula 
\begin{equation}
c_{\alpha p}=\phi^{0}c_{R}\frac{S_{\alpha}}{B_{\alpha}}+\phi S_{\alpha}\frac{\partial B_{\alpha}^{-1}}{\partial p}\label{eq:c_alpha_p}
\end{equation}

\end_inset

 valid for both oil and water.
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
c_{wSw}=\left(\frac{\phi}{B_{w}}\right)^{l}\label{eq:cwsw-1}
\end{equation}

\end_inset


\begin_inset Formula 
\begin{equation}
c_{oSw}=-\left(\frac{\phi}{B_{o}}\right)^{l}\label{eq:cosw-1}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
T_{\alpha}=\frac{k_{r\alpha}}{\mu_{\alpha}B_{\alpha}}K\label{eq:T_alpha-1}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
From section 7.3.1 Chen
\begin_inset Formula 
\[
\mathbf{u}=\mathbf{u}_{w}+\mathbf{u}_{o}
\]

\end_inset

using 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:darcy-alpha-1"

\end_inset


\end_layout

\begin_layout Subsection
Initial equations for the pressure
\end_layout

\begin_layout Standard
Supposing 
\begin_inset Formula $Pcritical=0$
\end_inset

 and 
\begin_inset Formula $g=0$
\end_inset

.
\end_layout

\begin_layout Standard
Starting from 
\begin_inset Formula 
\begin{equation}
\frac{\partial}{\partial t}\left(\phi\ \rho_{\alpha}\ S_{\alpha}\right)+\nabla\cdot\left(\rho_{\alpha}\ \mathbf{u}_{\alpha}\right)=q_{\alpha}\label{eq:mass-cons-alpha-1}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Darcy’s law
\begin_inset Formula 
\begin{equation}
\mathbf{u}_{\alpha}=-K\lambda_{\alpha}\left(\nabla p_{\alpha}-\rho_{\alpha}\ g\nabla z\right)\label{eq:darcy-alpha-1}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
with 
\end_layout

\begin_layout Standard
Saturations
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
S_{o}+S_{w}=1\label{eq:sum_satur}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Capillary pressure
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
p_{c}(S_{w})=p_{o}-p_{w}
\]

\end_inset


\end_layout

\begin_layout Standard
For the Brugge case that we are interested in 
\begin_inset Formula 
\begin{equation}
p_{c}(S_{w})=0\Longrightarrow p_{o}=p_{w}\label{eq:no-critical-pres-1}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Both Water and oil are slightly compressible.
\end_layout

\begin_layout Subsection
Pressure equation adapting from Chen
\end_layout

\begin_layout Standard
Starting from 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:mass-cons-alpha-1"

\end_inset

 and expanding the transient term and divividing by 
\begin_inset Formula $\rho_{\alpha s}$
\end_inset

 ( see 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:rho_alpha_std"

\end_inset

) 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula 
\[
\frac{S_{\alpha}}{B_{\alpha}}\frac{\partial\phi}{\partial p}\frac{\partial p}{\partial t}+\phi S_{\alpha}\frac{\partial B_{\alpha}^{-1}}{\partial p}\frac{\partial p}{\partial t}+\frac{\phi}{B_{\alpha}}\frac{\partial S_{\alpha}}{\partial t}+\frac{1}{\rho_{\alpha s}}\nabla\cdot\left(\rho_{\alpha}\ \mathbf{u}_{\alpha}\right)=\frac{q_{\alpha}}{\rho_{\alpha s}}
\]

\end_inset

Here we need to use rock compressibility eq 3.16 Chen 
\begin_inset Formula 
\[
c_{R}=\frac{1}{\phi}\frac{\partial\phi}{\partial p}
\]

\end_inset

or using the approximation for the porosity suggested by chen 
\begin_inset Formula 
\[
\phi=\phi^{0}\left(1+c_{R}\left(p-p^{0}\right)\right)
\]

\end_inset

 which gives 
\begin_inset Formula 
\[
\frac{\partial\phi}{\partial p}=\phi^{0}c_{R}.
\]

\end_inset


\begin_inset Formula 
\[
\left(\phi^{0}c_{R}.\frac{S_{\alpha}}{B_{\alpha}}+\phi S_{\alpha}\frac{\partial B_{\alpha}^{-1}}{\partial p}\right)\frac{\partial p}{\partial t}+\frac{\phi}{B_{\alpha}}\frac{\partial S_{\alpha}}{\partial t}+\frac{1}{\rho_{\alpha s}}\nabla\cdot\left(\rho_{\alpha}\ \mathbf{u}_{\alpha}\right)=\frac{q_{\alpha}}{\rho_{\alpha s}}
\]

\end_inset


\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
Actually if I did not use the approximation for the rock compressiblity
 but the directly 3.16 we would get 
\begin_inset Formula 
\[
\left(\phi c_{R}.\frac{S_{\alpha}}{B_{\alpha}}+\phi S_{\alpha}\frac{\partial B_{\alpha}^{-1}}{\partial p}\right)\frac{\partial p}{\partial t}+\frac{\phi}{B_{\alpha}}\frac{\partial S_{\alpha}}{\partial t}+\frac{1}{\rho_{\alpha s}}\nabla\cdot\left(\rho_{\alpha}\ \mathbf{u}_{\alpha}\right)=\frac{q_{\alpha}}{\rho_{\alpha s}}
\]

\end_inset

Chen uses teh approximation intead of the 3.16 so I will continue working
 that way but I do not see the need to do such approximation.
 Go back to this issue later.
 
\end_layout

\begin_layout Standard
So we can rewite the equation using 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:c_alpha_p"

\end_inset

 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula 
\[
c_{\alpha p}\frac{\partial p}{\partial t}+\frac{\phi}{B_{\alpha}}\frac{\partial S_{\alpha}}{\partial t}+\frac{1}{\rho_{\alpha s}}\nabla\cdot\left(\rho_{\alpha}\ \mathbf{u}_{\alpha}\right)=\frac{q_{\alpha}}{\rho_{\alpha s}}
\]

\end_inset


\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
Now we write down the equations for both oil and water taking into account
 that 
\begin_inset Formula $\frac{\partial S_{o}}{\partial t}=-\frac{\partial S_{w}}{\partial t}$
\end_inset

 due to 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:sum_satur"

\end_inset


\begin_inset Formula 
\[
c_{wp}\frac{\partial p}{\partial t}+\frac{\phi}{B_{w}}\frac{\partial S_{w}}{\partial t}+\frac{1}{\rho_{ws}}\nabla\cdot\left(\rho_{w}\ \mathbf{u}_{w}\right)=\frac{q_{w}}{\rho_{ws}}
\]

\end_inset


\begin_inset Formula 
\[
c_{op}\frac{\partial p}{\partial t}-\frac{\phi}{B_{o}}\frac{\partial S_{w}}{\partial t}+\frac{1}{\rho_{os}}\nabla\cdot\left(\rho_{o}\ \mathbf{u}_{o}\right)=\frac{q_{o}}{\rho_{os}}
\]

\end_inset

where we can use the definitions 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:cwsw-1"

\end_inset

 and 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:cosw-1"

\end_inset

 to get
\begin_inset Formula 
\begin{equation}
c_{wp}\frac{\partial p}{\partial t}+c_{wSw}\frac{\partial S_{w}}{\partial t}+\frac{1}{\rho_{ws}}\nabla\cdot\left(\rho_{w}\ \mathbf{u}_{w}\right)=\frac{q_{w}}{\rho_{ws}}\label{eq:pres__1}
\end{equation}

\end_inset


\begin_inset Formula 
\begin{equation}
c_{op}\frac{\partial p}{\partial t}+c_{oSw}\frac{\partial S_{w}}{\partial t}+\frac{1}{\rho_{os}}\nabla\cdot\left(\rho_{o}\ \mathbf{u}_{o}\right)=\frac{q_{o}}{\rho_{os}}\label{eq:pres__2}
\end{equation}

\end_inset

Now doing [
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:pres__1"

\end_inset

] - 
\begin_inset Formula $\frac{c_{wSw}}{c_{oSw}}$
\end_inset

[
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:pres__2"

\end_inset

] we get 
\begin_inset Formula 
\[
c_{wp}\frac{\partial p}{\partial t}+c_{wSw}\frac{\partial S_{w}}{\partial t}+\frac{1}{\rho_{ws}}\nabla\cdot\left(\rho_{w}\ \mathbf{u}_{w}\right)-\frac{c_{wSw}}{c_{oSw}}\left\{ c_{op}\frac{\partial p}{\partial t}+c_{oSw}\frac{\partial S_{w}}{\partial t}+\frac{1}{\rho_{os}}\nabla\cdot\left(\rho_{o}\ \mathbf{u}_{o}\right)\right\} =\frac{q_{w}}{\rho_{ws}}-\frac{c_{wSw}}{c_{oSw}}\frac{q_{o}}{\rho_{os}}
\]

\end_inset


\begin_inset Formula 
\[
\left(c_{wp}-\frac{c_{wSw}}{c_{oSw}}c_{op}\right)\frac{\partial p}{\partial t}+\frac{1}{\rho_{ws}}\nabla\cdot\left(\rho_{w}\ \mathbf{u}_{w}\right)-\frac{c_{wSw}}{c_{oSw}}\frac{1}{\rho_{os}}\nabla\cdot\left(\rho_{o}\ \mathbf{u}_{o}\right)=\frac{q_{w}}{\rho_{ws}}-\frac{c_{wSw}}{c_{oSw}}\frac{q_{o}}{\rho_{os}}
\]

\end_inset

 This form is very close to what Chen has.
 It is equivalent to 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:chen8108"

\end_inset

.
\end_layout

\begin_layout Standard
From 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset CommandInset ref
LatexCommand ref
reference "eq:cwsw-1"

\end_inset

 and 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:cosw-1"

\end_inset

 we get 
\begin_inset Formula 
\[
\frac{c_{wSw}}{c_{oSw}}=-\frac{B_{o}}{B_{w}}
\]

\end_inset

 that allows us to simplify the previous equation to 
\begin_inset Formula 
\begin{equation}
\left(c_{wp}+\frac{B_{o}}{B_{w}}c_{op}\right)\frac{\partial p}{\partial t}+\frac{1}{\rho_{ws}}\nabla\cdot\left(\rho_{w}\ \mathbf{u}_{w}\right)+\frac{B_{o}}{B_{w}}\frac{1}{\rho_{os}}\nabla\cdot\left(\rho_{o}\ \mathbf{u}_{o}\right)=\frac{q_{w}}{\rho_{ws}}+\frac{B_{o}}{B_{w}}\frac{q_{o}}{\rho_{os}}\label{eq:pres_eq_prior_replace_u}
\end{equation}

\end_inset

The term 
\begin_inset Formula $\left(c_{wp}+\frac{B_{o}}{B_{w}}c_{op}\right)$
\end_inset

 is exactly what we have in gpden in por_elmpre.
 Using 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:darcy-alpha-1"

\end_inset

 we get
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula 
\[
\left(c_{wp}+\frac{B_{o}}{B_{w}}c_{op}\right)\frac{\partial p}{\partial t}-\frac{1}{\rho_{ws}}\nabla\cdot\left(\rho_{w}K\lambda_{w}\left(\nabla p-\rho_{w}\ g\nabla z\right)\right)-\frac{B_{o}}{B_{w}}\frac{1}{\rho_{os}}\nabla\cdot\left(\rho_{o}K\lambda_{o}\left(\nabla p-\rho_{o}\ g\nabla z\right)\right)=\frac{q_{w}}{\rho_{ws}}+\frac{B_{o}}{B_{w}}\frac{q_{o}}{\rho_{os}}
\]

\end_inset


\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
If the gravity is not in the z direction we can generalize this to 
\begin_inset Formula 
\[
\left(c_{wp}+\frac{B_{o}}{B_{w}}c_{op}\right)\frac{\partial p}{\partial t}-\frac{1}{\rho_{ws}}\nabla\cdot\left(\rho_{w}K\lambda_{w}\left(\nabla p-\rho_{w}\ \mathbf{g}\right)\right)-\frac{B_{o}}{B_{w}}\frac{1}{\rho_{os}}\nabla\cdot\left(\rho_{o}K\lambda_{o}\left(\nabla p-\rho_{o}\ \mathbf{g}\right)\right)=\frac{q_{w}}{\rho_{ws}}+\frac{B_{o}}{B_{w}}\frac{q_{o}}{\rho_{os}}
\]

\end_inset


\begin_inset Formula 
\begin{eqnarray*}
\left(c_{wp}+\frac{B_{o}}{B_{w}}c_{op}\right)\frac{\partial p}{\partial t}-\nabla\cdot\left(\left(\frac{K\lambda_{w}}{B_{w}}+\frac{B_{o}}{B_{w}}\frac{K\lambda_{o}}{B_{o}}\right)\nabla p\right)+\frac{1}{\rho_{ws}}\nabla\cdot\left(\frac{\rho_{ws}}{B_{w}}K\lambda_{w}\frac{\rho_{ws}}{B_{w}}\ \mathbf{g}\right)\\
+\frac{B_{o}}{B_{w}}\frac{1}{\rho_{os}}\nabla\cdot\left(\frac{\rho_{os}}{B_{o}}K\lambda_{o}\frac{\rho_{os}}{B_{o}}\ \mathbf{g}\right) & = & \frac{q_{w}}{\rho_{ws}}+\frac{B_{o}}{B_{w}}\frac{q_{o}}{\rho_{os}}
\end{eqnarray*}

\end_inset


\end_layout

\begin_layout Standard
We could rewrite the previous equation using 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:T_alpha-1"

\end_inset

 but that does not introduce much advantage.
 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
Then we need to suppose that 
\begin_inset Formula $\frac{c_{wSw}}{c_{oSw}}$
\end_inset

 (and therefore also
\begin_inset Formula $\frac{B_{o}}{B_{w}}$
\end_inset

 ) is constant within the element (actually we should introduce this approximati
on at the discretized level) as we have mentioned after 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:volume_lap1"

\end_inset

.
 This is not completely true as we have already discused, but introducing
 this approximation and using 
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit

\begin_inset CommandInset ref
LatexCommand ref
reference "eq:rho_alpha_std"

\end_inset

 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
we get 
\begin_inset Formula 
\[
\left(c_{wp}+\frac{B_{o}}{B_{w}}c_{op}\right)\frac{\partial p}{\partial t}-\nabla\cdot\left(\left(\frac{K\lambda_{w}}{B_{w}}+\frac{B_{o}}{B_{w}}\frac{K\lambda_{o}}{B_{o}}\right)\nabla p\right)+\nabla\cdot\left(\frac{K}{B_{w}}\left(\frac{\rho_{ws}\lambda_{w}}{B_{w}}+\frac{\rho_{os}\lambda_{o}}{B_{o}}\right)\ \mathbf{g}\right)=\frac{q_{w}}{\rho_{ws}}+\frac{B_{o}}{B_{w}}\frac{q_{o}}{\rho_{os}}
\]

\end_inset

that further simplifies to the final equation for the pressure
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Box Doublebox
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula 
\begin{equation}
\left(c_{wp}+\frac{B_{o}}{B_{w}}c_{op}\right)\frac{\partial p}{\partial t}-\nabla\cdot\left(\frac{K}{B_{w}}\left(\lambda_{w}+\lambda_{o}\right)\nabla p\right)+\nabla\cdot\left(\frac{K}{B_{w}}\left(\frac{\rho_{ws}\lambda_{w}}{B_{w}}+\frac{\rho_{os}\lambda_{o}}{B_{o}}\right)\ \mathbf{g}\right)=\frac{q_{w}}{\rho_{ws}}+\frac{B_{o}}{B_{w}}\frac{q_{o}}{\rho_{os}}\label{eq:final_pressure}
\end{equation}

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
The second term is what we calculate in por_elmpre: gpdif.
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
The third term, 
\begin_inset Formula $\frac{K}{B_{w}}\left(\frac{\rho_{ws}\lambda_{w}}{B_{w}}+\frac{\rho_{os}\lambda_{o}}{B_{o}}\right)\ \mathbf{g}$
\end_inset

 
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
is what we calculate in
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
 por_elmpre : gpgra
\end_layout

\begin_layout Standard
Finally the terms in the RHS are introduces in por_wellte.
 We have 4 options
\end_layout

\begin_layout Subsubsection
Modification if we want to eliminate the hydrostatic component
\end_layout

\begin_layout Standard
We can define 
\begin_inset Formula 
\[
\nabla p_{\alpha}^{*}=\nabla p_{\alpha}+\rho_{m}\ g\nabla z
\]

\end_inset

or equivalently 
\begin_inset Formula 
\[
p_{\alpha}^{*}=p_{\alpha}+\rho_{m}\ gz
\]

\end_inset

Using this 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:darcy-alpha"

\end_inset

 is written as
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\mathbf{u}_{\alpha}=-K\lambda_{\alpha}\left(\nabla p_{\alpha}^{*}-\left(\rho_{\alpha}-\rho_{m}\right)\ g\nabla z\right)\label{eq:darcy-alpha-2}
\end{equation}

\end_inset

If we repeat all the previous derivation we finally arrive to where we have
 used 
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Box Doublebox
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula 
\begin{eqnarray}
\left(c_{wp}+\frac{B_{o}}{B_{w}}c_{op}\right)\frac{\partial p}{\partial t}-\nabla\cdot\left(\frac{K}{B_{w}}\left(\lambda_{w}+\lambda_{o}\right)\nabla p^{*}\right)\label{eq:final_pressure-3}\\
+\nabla\cdot\left(\frac{K}{B_{w}}\left(\frac{\rho_{ws}\lambda_{w}}{B_{w}}+\frac{\rho_{os}\lambda_{o}}{B_{o}}-\left(\lambda_{w}+\lambda_{o}\right)\rho_{m}\right)\ \mathbf{g}\right)\nonumber \\
 & = & \frac{q_{w}}{\rho_{ws}}+\frac{B_{o}}{B_{w}}\frac{q_{o}}{\rho_{os}}\nonumber 
\end{eqnarray}

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Osea solo hay que agregar el término 
\begin_inset Formula $-\left(\lambda_{w}+\lambda_{o}\right)\rho_{m}$
\end_inset

 .
 Bueno luego habría que modificar la presión a postprocesar.
 Ademas si usamos wells imponiendo presión hay que repensarselo.
\end_layout

\begin_layout Standard
paar usarlo simplemente meto DENS_HYDRO y le doy el valor que quiero de
 
\begin_inset Formula $\rho_{m}$
\end_inset

 sino ese valor esta por default a cero.
\end_layout

\begin_layout Standard
Lo que he visto es que se produce uan veloc en z.
 Cuando uso esta opcion en b.
 Supongo hay que revisar que pasa con el contorno!!! We have to revise 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:BC_press_wth_grav"

\end_inset


\end_layout

\begin_layout Standard
Obviouslly por_velsmo needs to be modified according to 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:darcy-alpha-2"

\end_inset


\end_layout

\begin_layout Subsection
Wells
\end_layout

\begin_layout Subsubsection*
kfl_wellc_por(iwell) ==3 or 4 correspond to prescribing Pbh)
\end_layout

\begin_layout Standard
see 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:well_flow_rate_alpha"

\end_inset

 
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
q_{\alpha}=\frac{\rho_{\alpha}k_{r\alpha}}{\mu_{\alpha}}WI^{M}\left(p_{bh}-p_{0}^{\alpha}\right)
\]

\end_inset

Since 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $p_{bh}$
\end_inset


\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
 is given
\begin_inset Formula $\frac{\rho_{\alpha}k_{r\alpha}}{\mu_{\alpha}}WI^{M}p_{bh}$
\end_inset

 goes to the RHS.
 
\end_layout

\begin_layout Standard
\begin_inset Formula $-\frac{\rho_{\alpha}k_{r\alpha}}{\mu_{\alpha}}WI^{M}p_{0}^{\alpha}$
\end_inset

 is assembled into the matrix since 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $p_{0}^{\alpha}$
\end_inset


\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
 is the pressure at the node that corresponds to the well that is unknown.
 Since the critical pressure is 0 the pressure for both phases is the same.
 
\end_layout

\begin_layout Subsubsection*
kfl_wellc_por(iwell) == 1 ! Water flow rate prescribed
\end_layout

\begin_layout Standard
In this case only water enters ( 
\begin_inset Formula $q_{o}=0$
\end_inset

 ) Therefore the only term that enters is 
\begin_inset Formula $\frac{q_{w}}{\rho_{ws}}$
\end_inset


\end_layout

\begin_layout Subsubsection*
kfl_wellc_por(iwell) == 2 ! Total flow rate prescribed
\end_layout

\begin_layout Standard
The full term enters in the RHS.
\end_layout

\begin_layout Standard
Beware 1 : up to version 2646 there was an erroneous division by dtinv in
 both cases 1 & 2.
 Also in 3 & 4 see wellt = wellt / dtinv_por L156 por_wellte.
 This problem acme from the fact that actually 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:chen8108"

\end_inset

 is equivalent to 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:final_pressure"

\end_inset

 but multiplied by 
\begin_inset Formula $\delta t$
\end_inset

 .
 The problem was then that in por_wellte we had worked as in 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:chen8108"

\end_inset

 and in the rest of the term as in 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:final_pressure"

\end_inset

.
 In 2647 we leave everything as in 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:final_pressure"

\end_inset


\end_layout

\begin_layout Standard
Beware 2 : In the case of an injector if we set Pbh we need to modify Alya
 so that only water is injected.
 Therefore for the moment we only impose water flow rate at an injector.
 
\end_layout

\begin_layout Subsection
Boundary conditions in the case with gravity 
\begin_inset CommandInset label
LatexCommand label
name "sub:BC_press_wth_grav"

\end_inset


\end_layout

\begin_layout Standard
Starting from 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:final_pressure"

\end_inset

 we try to get a cleaner interpretation to 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Boundary-conditions-for"

\end_inset

 I leave only the terms that we are interested in
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula 
\[
LHS-\nabla\cdot\left(\frac{K}{B_{w}}\left(\lambda_{w}+\lambda_{o}\right)\nabla p\right)+\nabla\cdot\left(\frac{K}{B_{w}}\left(\frac{\rho_{ws}\lambda_{w}}{B_{w}}+\frac{\rho_{os}\lambda_{o}}{B_{o}}\right)\ \mathbf{g}\right)=RHS
\]

\end_inset

In order to correctly understand what happens with the boundary conditions
 we need to obtain the weak form.
 We weight with a test function 
\begin_inset Formula $v$
\end_inset

 and integrate by parts.
 
\begin_inset Formula 
\[
\int_{\Omega}vLHS-\int_{\Omega}v\nabla\cdot\left(\frac{K}{B_{w}}\left(\lambda_{w}+\lambda_{o}\right)\nabla p\right)+\int_{\Omega}v\nabla\cdot\left(\frac{K}{B_{w}}\left(\frac{\rho_{ws}\lambda_{w}}{B_{w}}+\frac{\rho_{os}\lambda_{o}}{B_{o}}\right)\ \mathbf{g}\right)=\int_{\Omega}vRHS
\]

\end_inset

We are integrating by parts both terms
\begin_inset Formula 
\[
\int_{\Omega}vLHS-\int_{\Omega}\nabla\cdot\left[v\left(\frac{K}{B_{w}}\left(\lambda_{w}+\lambda_{o}\right)\nabla p\right)\right]+\int_{\Omega}\nabla v\cdot\left(\frac{K}{B_{w}}\left(\lambda_{w}+\lambda_{o}\right)\nabla p\right)+\int_{\Omega}\nabla\cdot\left(v\frac{K}{B_{w}}\left(\frac{\rho_{ws}\lambda_{w}}{B_{w}}+\frac{\rho_{os}\lambda_{o}}{B_{o}}\right)\ \mathbf{g}\right)-\int_{\Omega}\nabla v\cdot\left(\frac{K}{B_{w}}\left(\frac{\rho_{ws}\lambda_{w}}{B_{w}}+\frac{\rho_{os}\lambda_{o}}{B_{o}}\right)\ \mathbf{g}\right)=\int_{\Omega}vRHS
\]

\end_inset


\begin_inset Formula 
\[
\int_{\Omega}vLHS-\int_{\Gamma}\mathbf{n}\cdot\left[v\left(\frac{K}{B_{w}}\left(\lambda_{w}+\lambda_{o}\right)\nabla p\right)\right]+\int_{\Omega}\nabla v\cdot\left(\frac{K}{B_{w}}\left(\lambda_{w}+\lambda_{o}\right)\nabla p\right)+\int_{\Gamma}\mathbf{n}\cdot\left(v\frac{K}{B_{w}}\left(\frac{\rho_{ws}\lambda_{w}}{B_{w}}+\frac{\rho_{os}\lambda_{o}}{B_{o}}\right)\ \mathbf{g}\right)-\int_{\Omega}\nabla v\cdot\left(\frac{K}{B_{w}}\left(\frac{\rho_{ws}\lambda_{w}}{B_{w}}+\frac{\rho_{os}\lambda_{o}}{B_{o}}\right)\ \mathbf{g}\right)=\int_{\Omega}vRHS
\]

\end_inset


\begin_inset Formula 
\[
\int_{\Omega}vLHS-\int_{\Gamma}v\frac{K}{B_{w}}\left(\lambda_{w}+\lambda_{o}\right)\mathbf{n}\cdot\nabla p+\int_{\Gamma}v\frac{K}{B_{w}}\left(\frac{\rho_{ws}\lambda_{w}}{B_{w}}+\frac{\rho_{os}\lambda_{o}}{B_{o}}\right)\mathbf{n}\cdot\mathbf{g}+\int_{\Omega}\nabla v\cdot\left(\frac{K}{B_{w}}\left(\lambda_{w}+\lambda_{o}\right)\nabla p\right)=\int_{\Omega}\nabla v\cdot\left(\frac{K}{B_{w}}\left(\frac{\rho_{ws}\lambda_{w}}{B_{w}}+\frac{\rho_{os}\lambda_{o}}{B_{o}}\right)\ \mathbf{g}\right)+\int_{\Omega}vRHS
\]

\end_inset

Now we just have a look at the boundary terms 
\begin_inset Formula 
\[
\int_{\Omega}vLHS^{*}-\int_{\Gamma}v\frac{K}{B_{w}}\left(\lambda_{w}+\lambda_{o}\right)\mathbf{n}\cdot\nabla p+\int_{\Gamma}v\frac{K}{B_{w}}\left(\frac{\rho_{ws}\lambda_{w}}{B_{w}}+\frac{\rho_{os}\lambda_{o}}{B_{o}}\right)\mathbf{n}\cdot\mathbf{g}=\int_{\Omega}vRHS^{*}
\]

\end_inset


\begin_inset Formula 
\[
\int_{\Omega}vLHS^{*}+\int_{\Gamma}v\frac{K}{B_{w}}\left[\left(\frac{\rho_{ws}\lambda_{w}}{B_{w}}+\frac{\rho_{os}\lambda_{o}}{B_{o}}\right)\mathbf{n}\cdot\mathbf{g}-\left(\lambda_{w}+\lambda_{o}\right)\mathbf{n}\cdot\nabla p\right]=\int_{\Omega}vRHS^{*}
\]

\end_inset

So if we do nothing at the boundary what we are impossing weakly on the
 boundary is 
\begin_inset Formula 
\begin{equation}
\mathbf{n}\cdot\left[\left(\frac{\rho_{ws}\lambda_{w}}{B_{w}}+\frac{\rho_{os}\lambda_{o}}{B_{o}}\right)\mathbf{g}-\left(\lambda_{w}+\lambda_{o}\right)\nabla p\right]=0\label{eq:bc_gradp_boun}
\end{equation}

\end_inset

now i recompare with what we wanted to impose in section 
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit

\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Boundary-conditions-for"

\end_inset


\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
 
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit

\begin_inset Formula 
\[
\nabla p=\frac{\lambda_{w}\rho_{w}+\lambda_{o}\rho_{o}}{\lambda_{w}+\lambda_{o}}\mathbf{g}
\]

\end_inset

that is obviouslly what we are recovering in 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:bc_gradp_boun"

\end_inset

 in the normal direction.
 this means that actually we do not have to do anything at all at the boundaries.
 Therefore everything that I had programmed inside bouope is incorrect.
 The final decsision y then to leave bouope empty in Alya 2668.
\end_layout

\begin_layout Standard
Perhaps we can get a better reinterpretation leaving everything in terms
 of the velocity up to the end.
\end_layout

\begin_layout Section
Saturation 
\end_layout

\begin_layout Standard
We shal treat the wells following Malta & Loula.
 Malta & Loula is for miscible displacements.
 First I need to find an equivalent to eq 1.1 from paper in 2 phase flow.
 From 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:mass-cons-alpha"

\end_inset


\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula 
\[
\frac{\partial}{\partial t}\left(\phi\ \rho_{\alpha}\ S_{\alpha}\right)+\rho_{\alpha}\nabla\cdot\mathbf{u}_{\alpha}+\mathbf{u}_{\alpha}\cdot\nabla\rho_{\alpha}=q_{\alpha}
\]

\end_inset


\end_layout

\begin_layout Standard
that can be rewritten as 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula 
\[
\nabla\cdot\mathbf{u}_{\alpha}=\frac{1}{\rho_{\alpha}}\left\{ q_{\alpha}-\frac{\partial}{\partial t}\left(\phi\ \rho_{\alpha}\ S_{\alpha}\right)-\mathbf{u}_{\alpha}\cdot\nabla\rho_{\alpha}\right\} 
\]

\end_inset

If we add for oil and water we get
\begin_inset Formula 
\[
\nabla\cdot\mathbf{u}=\nabla\cdot\mathbf{u}_{o}+\nabla\cdot\mathbf{u}_{w}=\frac{1}{\rho_{o}}\left\{ q_{o}-\frac{\partial}{\partial t}\left(\phi\ \rho_{o}\ S_{o}\right)-\mathbf{u}_{o}\cdot\nabla\rho_{o}\right\} +\frac{1}{\rho_{w}}\left\{ q_{w}-\frac{\partial}{\partial t}\left(\phi\ \rho_{w}\ S_{w}\right)-\mathbf{u}_{w}\cdot\nabla\rho_{w}\right\} 
\]

\end_inset

This could be our equivalent to 
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
eq 1.1 .
 It is clearly more complicated.
 
\end_layout

\begin_layout Standard
This could now be replaced into the water transport equation 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:water-transp-convec-1"

\end_inset

 that I repeat here for completness.
 Actualy when we finish cleaning up we could recover its derivation here.
 
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\frac{\partial}{\partial t}\left(\phi\ \rho_{w}\ S_{w}\right)+\rho_{w}\mathbf{u^{*}}\cdot\frac{\partial f_{w}}{\partial S_{w}}\nabla S_{w}+f_{w}\nabla\cdot\left(\rho_{w}\mathbf{u^{*}}\right)=q_{w}
\]

\end_inset

with 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula 
\[
\mathbf{u^{*}}=\mathbf{u+}k\lambda_{o}\left(\rho_{w}-\rho_{o}\right)g\nabla z
\]

\end_inset

or equivalently 
\begin_inset Formula 
\[
\mathbf{u^{*}}=\mathbf{u+}k\lambda_{o}\left(\rho_{w}-\rho_{o}\right)\mathbf{g}
\]

\end_inset

if we want to deal with a gravity in an arbitrary direction.
\end_layout

\begin_layout Standard
It we can further expand as 
\begin_inset Formula 
\[
\frac{\partial}{\partial t}\left(\phi\ \rho_{w}\ S_{w}\right)+\rho_{w}\mathbf{u^{*}}\cdot\frac{\partial f_{w}}{\partial S_{w}}\nabla S_{w}+f_{w}\rho_{w}\nabla\cdot\mathbf{u}+f_{w}\rho_{w}\mathbf{g}\cdot\nabla\left(k\lambda_{o}\left(\rho_{w}-\rho_{o}\right)\right)+f_{w}\mathbf{u^{*}}\cdot\nabla\rho_{w}=q_{w}
\]

\end_inset

Where we will replace the velocity divergence and hope that something nice
 comes out
\begin_inset Formula 
\begin{eqnarray*}
\frac{\partial}{\partial t}\left(\phi\ \rho_{w}\ S_{w}\right)+\rho_{w}\mathbf{u^{*}}\cdot\frac{\partial f_{w}}{\partial S_{w}}\nabla S_{w}\\
+f_{w}\rho_{w}\left\{ \frac{1}{\rho_{o}}\left\{ q_{o}-\frac{\partial}{\partial t}\left(\phi\ \rho_{o}\ S_{o}\right)-\mathbf{u}_{o}\cdot\nabla\rho_{o}\right\} +\frac{1}{\rho_{w}}\left\{ q_{w}-\frac{\partial}{\partial t}\left(\phi\ \rho_{w}\ S_{w}\right)-\mathbf{u}_{w}\cdot\nabla\rho_{w}\right\} \right\} \\
+f_{w}\rho_{w}\mathbf{g}\cdot\nabla\left(k\lambda_{o}\left(\rho_{w}-\rho_{o}\right)\right)+f_{w}\mathbf{u^{*}}\cdot\nabla\rho_{w} & = & q_{w}
\end{eqnarray*}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{eqnarray*}
\frac{\partial}{\partial t}\left(\phi\ \rho_{w}\ S_{w}\right)+\rho_{w}\mathbf{u^{*}}\cdot\frac{\partial f_{w}}{\partial S_{w}}\nabla S_{w}\\
+f_{w}\frac{\rho_{w}}{\rho_{o}}\left\{ q_{o}-\frac{\partial}{\partial t}\left(\phi\ \rho_{o}\ S_{o}\right)-\mathbf{u}_{o}\cdot\nabla\rho_{o}\right\} +f_{w}\left\{ q_{w}-\frac{\partial}{\partial t}\left(\phi\ \rho_{w}\ S_{w}\right)-\mathbf{u}_{w}\cdot\nabla\rho_{w}\right\} \\
+f_{w}\rho_{w}\mathbf{g}\cdot\nabla\left(k\lambda_{o}\left(\rho_{w}-\rho_{o}\right)\right)+f_{w}\mathbf{u^{*}}\cdot\nabla\rho_{w} & = & q_{w}
\end{eqnarray*}

\end_inset


\end_layout

\begin_layout Standard
We will now take into account that 
\begin_inset Formula $S_{o}=1-S_{w}$
\end_inset

 and regroup all transient terms.
\begin_inset Formula 
\begin{eqnarray*}
\left(1-f_{w}\right)\frac{\partial}{\partial t}\left(\phi\ \rho_{w}\ S_{w}\right)-f_{w}\frac{\rho_{w}}{\rho_{o}}\frac{\partial}{\partial t}\left(\phi\ \rho_{o}\ \left(1-S_{w}\right)\right)\\
+\rho_{w}\mathbf{u^{*}}\cdot\frac{\partial f_{w}}{\partial S_{w}}\nabla S_{w}+f_{w}\left\{ \mathbf{u^{*}}\cdot\nabla\rho_{w}-\mathbf{u}_{w}\cdot\nabla\rho_{w}-\frac{\rho_{w}}{\rho_{o}}\mathbf{u}_{o}\cdot\nabla\rho_{o}\right\} \\
+f_{w}\rho_{w}\mathbf{g}\cdot\nabla\left(k\lambda_{o}\left(\rho_{w}-\rho_{o}\right)\right) & = & q_{w}-f_{w}q_{w}-f_{w}\frac{\rho_{w}}{\rho_{o}}q_{o}
\end{eqnarray*}

\end_inset


\end_layout

\begin_layout Standard
We have so far eliminated the term for the velocity divergence.
 If we split the second term in two parts we get 
\begin_inset Formula 
\begin{eqnarray*}
\left(1-f_{w}\right)\frac{\partial}{\partial t}\left(\phi\ \rho_{w}\ S_{w}\right)+f_{w}\frac{\rho_{w}}{\rho_{o}}\frac{\partial}{\partial t}\left(\phi\ \rho_{o}\ S_{w}\right)-f_{w}\frac{\rho_{w}}{\rho_{o}}\frac{\partial}{\partial t}\left(\phi\ \rho_{o}\right)\\
+\rho_{w}\mathbf{u^{*}}\cdot\frac{\partial f_{w}}{\partial S_{w}}\nabla S_{w}+f_{w}\left\{ \mathbf{u^{*}}\cdot\nabla\rho_{w}-\mathbf{u}_{w}\cdot\nabla\rho_{w}-\frac{\rho_{w}}{\rho_{o}}\mathbf{u}_{o}\cdot\nabla\rho_{o}\right\} \\
+f_{w}\rho_{w}\mathbf{g}\cdot\nabla\left(k\lambda_{o}\left(\rho_{w}-\rho_{o}\right)\right) & = & q_{w}-f_{w}q_{w}-f_{w}\frac{\rho_{w}}{\rho_{o}}q_{o}
\end{eqnarray*}

\end_inset

Reordering 
\begin_inset Formula 
\begin{eqnarray*}
\left(1-f_{w}\right)\frac{\partial}{\partial t}\left(\phi\rho_{w}S_{w}\right)+f_{w}\frac{\rho_{w}}{\rho_{o}}\frac{\partial}{\partial t}\left(\phi\rho_{o}S_{w}\right)+\rho_{w}\mathbf{u^{*}}\cdot\frac{\partial f_{w}}{\partial S_{w}}\nabla S_{w} & = & q_{w}-f_{w}q_{w}-f_{w}\frac{\rho_{w}}{\rho_{o}}q_{o}+f_{w}\frac{\rho_{w}}{\rho_{o}}\frac{\partial}{\partial t}\left(\phi\rho_{o}\right)\\
 &  & -f_{w}\left\{ \mathbf{u^{*}}\cdot\nabla\rho_{w}-\mathbf{u}_{w}\cdot\nabla\rho_{w}-\frac{\rho_{w}}{\rho_{o}}\mathbf{u}_{o}\cdot\nabla\rho_{o}\right\} \\
 &  & -f_{w}\rho_{w}\mathbf{g}\cdot\nabla\left(k\lambda_{o}\left(\rho_{w}-\rho_{o}\right)\right)
\end{eqnarray*}

\end_inset

I still have to understand how to deal with the term 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $f_{w}\frac{\rho_{w}}{\rho_{o}}\frac{\partial}{\partial t}\left(\phi\ \rho_{o}\right)$
\end_inset

.
 Perhaps I could neglect it since both 
\begin_inset Formula $\phi$
\end_inset

 and 
\begin_inset Formula $\rho_{o}$
\end_inset

 only depend on the pressure?? This would agree with the fact that in 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Review-prior-to"

\end_inset

 we set 
\begin_inset Formula $\delta p=0$
\end_inset

.
 Taking into account that in that same section the term 
\begin_inset Formula $\frac{\partial}{\partial t}\left(\phi\ \rho_{w}\ S_{w}\right)$
\end_inset

 had ended as 
\begin_inset Formula $\frac{\rho_{ws}}{\triangle t}c_{wSw}\delta S_{w}$
\end_inset

 or 
\begin_inset Formula $\frac{\rho_{ws}}{\triangle t}\left(\frac{\phi}{B_{w}}\right)^{l}\delta S_{w}$
\end_inset

 .
 Now we would approximate the transient terms as follows.
\begin_inset Formula 
\begin{eqnarray*}
\left(1-f_{w}\right)\frac{\partial}{\partial t}\left(\phi\ \rho_{w}\ S_{w}\right)+f_{w}\frac{\rho_{w}}{\rho_{o}}\frac{\partial}{\partial t}\left(\phi\ \rho_{o}\ S_{w}\right) & \simeq & \begin{aligned}\end{aligned}
\left(1-f_{w}\right)\frac{\rho_{ws}}{\triangle t}\left(\frac{\phi}{B_{w}}\right)^{l}\delta S_{w}+f_{w}\frac{\rho_{ws}}{\rho_{os}}\left(\frac{B_{w}}{B_{o}}\right)^{l}\frac{\rho_{wo}}{\triangle t}\left(\frac{\phi}{B_{o}}\right)^{l}\delta S_{w}\\
 & = & \left(1-f_{w}\right)\frac{\rho_{ws}}{\triangle t}\left(\frac{\phi}{B_{w}}\right)^{l}\delta S_{w}+f_{w}\left(\frac{\phi}{B_{w}}\right)^{l}\frac{\rho_{ws}}{\triangle t}\delta S_{w}\\
 &  & =\frac{\rho_{ws}}{\triangle t}\left(\frac{\phi}{B_{w}}\right)^{l}\delta S_{w}\simeq\phi\ \frac{\rho_{ws}}{B_{w}}\ \frac{\partial S_{w}}{\partial t}
\end{eqnarray*}

\end_inset


\end_layout

\begin_layout Standard
Therefore the transient term remains unaltered with respecto to the case
 without Malta and Loula.
\end_layout

\begin_layout Standard
The convective term has also not been modified.
 So the only thing that changes is the RHS
\begin_inset Formula 
\begin{eqnarray*}
RHS & = & q_{w}-f_{w}q_{w}-f_{w}\frac{\rho_{w}}{\rho_{o}}q_{o}+f_{w}\frac{\rho_{w}}{\rho_{o}}\frac{\partial}{\partial t}\left(\phi\ \rho_{o}\right)\\
 &  & -f_{w}\left\{ \mathbf{u^{*}}\cdot\nabla\rho_{w}-\mathbf{u}_{w}\cdot\nabla\rho_{w}-\frac{\rho_{w}}{\rho_{o}}\mathbf{u}_{o}\cdot\nabla\rho_{o}\right\} -f_{w}\rho_{w}\mathbf{g}\cdot\nabla\left(k\lambda_{o}\left(\rho_{w}-\rho_{o}\right)\right)
\end{eqnarray*}

\end_inset


\end_layout

\begin_layout Standard
Moreover, we have already mentioned that 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
we set 
\begin_inset Formula $\frac{\partial}{\partial t}\left(\phi\ \rho_{o}\right)=0$
\end_inset

 since both 
\begin_inset Formula $\phi$
\end_inset

 and 
\begin_inset Formula $\rho_{o}$
\end_inset

 only depend on the pressure and we are setting we set 
\begin_inset Formula $\delta p=0$
\end_inset

.
 
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
Therefore the final equation reads
\begin_inset Formula 
\begin{eqnarray*}
\phi\frac{\rho_{ws}}{B_{w}}\frac{\partial S_{w}}{\partial t}+\rho_{w}\mathbf{u^{*}}\cdot\frac{\partial f_{w}}{\partial S_{w}}\nabla S_{w} & = & q_{w}-f_{w}q_{w}-f_{w}\frac{\rho_{w}}{\rho_{o}}q_{o}\\
 &  & -f_{w}\left\{ \mathbf{u^{*}}\cdot\nabla\rho_{w}-\mathbf{u}_{w}\cdot\nabla\rho_{w}-\frac{\rho_{w}}{\rho_{o}}\mathbf{u}_{o}\cdot\nabla\rho_{o}\right\} \\
 &  & -f_{w}\rho_{w}\mathbf{g}\cdot\nabla\left(k\lambda_{o}\left(\rho_{w}-\rho_{o}\right)\right)
\end{eqnarray*}

\end_inset

In the case without gravity, 
\begin_inset Formula 
\[
RHS=q_{w}-f_{w}q_{w}-f_{w}\frac{\rho_{w}}{\rho_{o}}q_{o}-f_{w}\left\{ \mathbf{u}\cdot\nabla\rho_{w}-\mathbf{u}_{w}\cdot\nabla\rho_{w}-\frac{\rho_{w}}{\rho_{o}}\mathbf{u}_{o}\cdot\nabla\rho_{o}\right\} 
\]

\end_inset

and we can to get 
\begin_inset Formula 
\[
RHS=q_{w}-f_{w}\left\{ q_{w}+\frac{\rho_{w}}{\rho_{o}}q_{o}+\mathbf{u}_{o}\cdot\left(\nabla\rho_{w}-\frac{\rho_{w}}{\rho_{o}}\nabla\rho_{o}\right)\right\} 
\]

\end_inset


\end_layout

\begin_layout Standard
In the case with gravity we would need to expand 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\mathbf{u^{*}}$
\end_inset

 in the rhs
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit

\begin_inset Formula 
\begin{eqnarray*}
\phi\frac{\rho_{ws}}{B_{w}}\frac{\partial S_{w}}{\partial t}+\rho_{w}\mathbf{u^{*}}\cdot\frac{\partial f_{w}}{\partial S_{w}}\nabla S_{w} & = & q_{w}-f_{w}q_{w}-f_{w}\frac{\rho_{w}}{\rho_{o}}q_{o}\\
 &  & -f_{w}\left\{ \left(\mathbf{u}+k\lambda_{o}\left(\rho_{w}-\rho_{o}\right)\mathbf{\mathbf{g}}\right)\cdot\nabla\rho_{w}-\mathbf{u}_{w}\cdot\nabla\rho_{w}-\frac{\rho_{w}}{\rho_{o}}\mathbf{u}_{o}\cdot\nabla\rho_{o}\right\} \\
 &  & -f_{w}\rho_{w}\mathbf{g}\cdot\nabla\left(k\lambda_{o}\left(\rho_{w}-\rho_{o}\right)\right)
\end{eqnarray*}

\end_inset

using 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Chen7.7"

\end_inset

 (
\begin_inset Formula $\mathbf{u}_{o}=\mathbf{u}-\mathbf{u}_{w}$
\end_inset

)
\begin_inset Formula 
\begin{eqnarray*}
\phi\frac{\rho_{ws}}{B_{w}}\frac{\partial S_{w}}{\partial t}+\rho_{w}\mathbf{u^{*}}\cdot\frac{\partial f_{w}}{\partial S_{w}}\nabla S_{w} & = & q_{w}-f_{w}\left\{ q_{w}+\frac{\rho_{w}}{\rho_{o}}q_{o}+\mathbf{u}_{o}\cdot\left(\nabla\rho_{w}-\frac{\rho_{w}}{\rho_{o}}\nabla\rho_{o}\right)\right\} \\
 &  & -f_{w}\rho_{w}\mathbf{g}\cdot\nabla\left(k\lambda_{o}\left(\rho_{w}-\rho_{o}\right)\right)-f_{w}k\lambda_{o}\left(\rho_{w}-\rho_{o}\right)\mathbf{\mathbf{g}}\cdot\nabla\rho_{w}
\end{eqnarray*}

\end_inset


\end_layout

\begin_layout Standard
The complete equation is then 
\begin_inset Formula 
\begin{eqnarray}
\phi\frac{\rho_{ws}}{B_{w}}\frac{\partial S_{w}}{\partial t}+\frac{\rho_{ws}}{B_{w}}\mathbf{u^{*}}\cdot\frac{\partial f_{w}}{\partial S_{w}}\nabla S_{w} & = & q_{w}-f_{w}\left\{ q_{w}+\frac{\rho_{ws}B_{o}}{\rho_{wo}B_{w}}q_{o}+\mathbf{u}_{o}\cdot\left(\nabla\rho_{w}-\frac{\rho_{ws}B_{o}}{\rho_{wo}B_{w}}\nabla\rho_{o}\right)\right\} \label{eq:Final_malta_loula_satur-1}\\
 &  & -f_{w}\rho_{ws}\mathbf{g}\cdot\nabla\left(\frac{1}{B_{w}}k\lambda_{o}\left(\rho_{w}-\rho_{o}\right)\right)
\end{eqnarray}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Subsubsection*
Copy of what we had prior to M&L just to compare - Skip reading
\end_layout

\begin_layout Plain Layout
Now we have to compare with what we had in the RHS in the implementattion
 prior to Malta & Loula.
 
\end_layout

\begin_layout Plain Layout
In order to recover what we have in alya by OCT 1 we start from 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:satur_review"

\end_inset

 with
\begin_inset Formula $\delta p=0$
\end_inset

 and 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:div_rho_u-satur"

\end_inset

 that we copy here
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula 
\begin{equation}
\frac{\rho_{ws}}{\triangle t}c_{wSw}\delta S_{w}=q_{w}-\frac{\rho_{ws}}{B_{w}}\mathbf{u^{*}}\cdot\frac{\partial f_{w}}{\partial S_{w}}\nabla S_{w}-\rho_{ws}\, f_{w}\nabla\cdot\left(\frac{1}{B_{w}}\mathbf{u^{*}}\right)\label{eq:satur_review-1-1}
\end{equation}

\end_inset

the last term can be expanded as
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit

\begin_inset Formula 
\begin{eqnarray}
\rho_{ws}\, f_{w}\nabla\cdot\left(\frac{1}{B_{w}}\mathbf{u^{*}}\right) & = & f_{w}\rho_{ws}\left\{ \frac{1}{B_{w}}\nabla\cdot\mathbf{u}+\frac{dB_{w}^{-1}}{dp}\underset{\overbrace{\mathbf{u^{*}}\cdot\nabla p}}{auxi1}+\lambda_{o}\underset{\overbrace{\mathbf{k\:}\mathbf{g}\cdot\nabla p}}{auxi2}\underset{\overbrace{\frac{1}{B_{w}}\left\{ \rho_{ws}\frac{dB_{w}^{-1}}{dp}-\rho_{os}\frac{dB_{o}^{-1}}{dp}\right\} }}{auxi3}\right\} \label{eq:div_rho_u-satur-1-1}\\
 &  & +\underset{\overbrace{\left\{ \frac{f_{w}\rho_{ws}}{B_{w}}\left(\rho_{w}-\rho_{o}\right)\frac{d\lambda_{o}}{dS_{w}}\mathbf{k\: g}\right\} }}{gpadv(2nd\, term)}\cdot\nabla S_{w}\nonumber 
\end{eqnarray}

\end_inset


\end_layout

\begin_layout Plain Layout
In the case without gravity it can all be put together in
\begin_inset Formula 
\begin{equation}
\frac{\rho_{ws}}{\triangle t}c_{wSw}\delta S_{w}+\frac{\rho_{ws}}{B_{w}}\mathbf{u}\cdot\frac{\partial f_{w}}{\partial S_{w}}\nabla S_{w}=q_{w}-\rho_{ws}\, f_{w}\frac{1}{B_{w}}\nabla\cdot\mathbf{u}-\rho_{ws}\, f_{w}\frac{dB_{w}^{-1}}{dp}\underset{\overbrace{\mathbf{u^{*}}\cdot\nabla p}}{auxi1}\label{eq:wasat_alya-1}
\end{equation}

\end_inset

Now I can compare what we have currently in Alya 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:wasat_alya-1"

\end_inset

 with what we would like to implement like Malta and Loula treat it 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Final_malta_loula_satur-1"

\end_inset

 we would no longer need the terms 
\begin_inset Formula $-\rho_{ws}\, f_{w}\frac{1}{B_{w}}\nabla\cdot\mathbf{u}-\rho_{ws}\, f_{w}\frac{dB_{w}^{-1}}{dp}\underset{\overbrace{\mathbf{u^{*}}\cdot\nabla p}}{auxi1}$
\end_inset

 in the RHS and instead in the RHS we would have
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Going back to the current implementation the RHS reads 
\begin_inset Formula 
\[
=q_{w}-f_{w}\left\{ q_{w}+\frac{\rho_{ws}B_{o}}{\rho_{os}B_{w}}q_{o}+\mathbf{u}_{o}\cdot\left(\nabla\rho_{w}-\frac{\rho_{ws}B_{o}}{\rho_{os}B_{w}}\nabla\rho_{o}\right)\right\} -f_{w}\rho_{ws}\mathbf{g}\cdot\nabla\left(\frac{1}{B_{w}}k\lambda_{o}\left(\rho_{w}-\rho_{o}\right)\right)
\]

\end_inset

This term can be further organized as
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{eqnarray*}
 & = & q_{w}-f_{w}\left\{ q_{w}+\frac{\rho_{ws}B_{o}}{\rho_{os}B_{w}}q_{o}+f_{o}\mathbf{u}\cdot\left(\rho_{ws}\nabla\frac{1}{B_{w}}-\frac{\rho_{ws}B_{o}}{\rho_{os}B_{w}}\rho_{os}\nabla\frac{1}{B_{o}}\right)\right\} \\
 &  & -f_{w}\rho_{ws}\mathbf{g}\cdot\left\{ B_{w}^{-1}\nabla\left(k\lambda_{o}\left(\frac{\rho_{ws}}{B_{w}}-\frac{\rho_{os}}{B_{o}}\right)\right)+k\lambda_{o}\left(\frac{\rho_{ws}}{B_{w}}-\frac{\rho_{os}}{B_{o}}\right)\nabla\left(B_{w}^{-1}\right)\right\} 
\end{eqnarray*}

\end_inset


\begin_inset Formula 
\begin{eqnarray*}
 & = & q_{w}-f_{w}\left\{ q_{w}+\frac{\rho_{ws}B_{o}}{\rho_{os}B_{w}}q_{o}+f_{o}\rho_{ws}\mathbf{u}\cdot\left(\nabla\frac{1}{B_{w}}-\frac{B_{o}}{B_{w}}\nabla\frac{1}{B_{o}}\right)\right\} \\
 &  & -f_{w}\rho_{ws}\frac{k}{\mu_{o}}\mathbf{g}\cdot\left\{ B_{w}^{-1}k_{ro}\nabla\left(\frac{\rho_{ws}}{B_{w}}-\frac{\rho_{os}}{B_{o}}\right)+B_{w}^{-1}\left(\frac{\rho_{ws}}{B_{w}}-\frac{\rho_{os}}{B_{o}}\right)\nabla k_{ro}+k_{ro}\left(\frac{\rho_{ws}}{B_{w}}-\frac{\rho_{os}}{B_{o}}\right)\nabla\left(B_{w}^{-1}\right)\right\} 
\end{eqnarray*}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{eqnarray*}
 & = & q_{w}-f_{w}\left\{ q_{w}+\frac{\rho_{ws}B_{o}}{\rho_{os}B_{w}}q_{o}+f_{o}\rho_{ws}\mathbf{u}\cdot\left(\frac{dB_{w}^{-1}}{dp}\nabla p-\frac{B_{o}}{B_{w}}\frac{dB_{o}^{-1}}{dp}\nabla p\right)\right\} \\
 &  & -f_{w}\rho_{ws}\frac{k}{\mu_{o}}\mathbf{g}\cdot\\
 &  & \left\{ B_{w}^{-1}k_{ro}\left(\rho_{ws}\frac{dB_{w}^{-1}}{dp}\nabla p-\rho_{os}\frac{dB_{o}^{-1}}{dp}\nabla p\right)+B_{w}^{-1}\left(\frac{\rho_{ws}}{B_{w}}-\frac{\rho_{os}}{B_{o}}\right)\frac{dk_{ro}}{dS_{w}}\nabla S_{w}+k_{ro}\left(\frac{\rho_{ws}}{B_{w}}-\frac{\rho_{os}}{B_{o}}\right)\frac{dB_{w}^{-1}}{dp}\nabla p\right\} 
\end{eqnarray*}

\end_inset


\begin_inset Formula 
\begin{eqnarray*}
 & = & q_{w}-f_{w}\left\{ q_{w}+\frac{\rho_{ws}}{\rho_{os}}\frac{B_{o}}{B_{w}}q_{o}+\rho_{ws}f_{o}\left(\frac{dB_{w}^{-1}}{dp}-\frac{B_{o}}{B_{w}}\frac{dB_{o}^{-1}}{dp}\right)\mathbf{u}\cdot\nabla p\right\} \\
 &  & -f_{w}\rho_{ws}\frac{k}{\mu_{o}}\mathbf{g}\cdot B_{w}^{-1}\left(\frac{\rho_{ws}}{B_{w}}-\frac{\rho_{os}}{B_{o}}\right)\frac{dk_{ro}}{dS_{w}}\nabla S_{w}\\
 &  & -f_{w}\rho_{ws}k\frac{k_{ro}}{\mu_{o}}\mathbf{g}\cdot\left\{ B_{w}^{-1}\left(\rho_{ws}\frac{dB_{w}^{-1}}{dp}\nabla p-\rho_{os}\frac{dB_{o}^{-1}}{dp}\nabla p\right)+\left(\frac{\rho_{ws}}{B_{w}}-\frac{\rho_{os}}{B_{o}}\right)\frac{dB_{w}^{-1}}{dp}\nabla p\right\} 
\end{eqnarray*}

\end_inset


\begin_inset Formula 
\begin{eqnarray}
 & = & q_{w}-f_{w}\left\{ q_{w}+\frac{\rho_{ws}}{\rho_{os}}\frac{B_{o}}{B_{w}}q_{o}\right\} \label{eq:malta-loula-final-1}\\
 &  & -\underset{\overbrace{f_{w}\rho_{ws}\frac{k}{\mu_{o}}\mathbf{g}\cdot B_{w}^{-1}\left(\frac{\rho_{ws}}{B_{w}}-\frac{\rho_{os}}{B_{o}}\right)\frac{dk_{ro}}{dS_{w}}}}{gpadv(2nd\, term)}\nabla S_{w}\nonumber \\
 &  & -f_{w}\rho_{ws}\left\{ f_{o}\left(\frac{dB_{w}^{-1}}{dp}-\frac{B_{o}}{B_{w}}\frac{dB_{o}^{-1}}{dp}\right)\underset{\overbrace{\mathbf{u}\cdot\nabla p}}{auxi1}+\lambda_{o}\underset{\overbrace{\mathbf{k\:}\mathbf{g}\cdot\nabla p}}{auxi2}\underset{\overbrace{\left\{ B_{w}^{-1}\left(2\rho_{ws}\frac{dB_{w}^{-1}}{dp}-\rho_{os}\frac{dB_{o}^{-1}}{dp}\right)-B_{o}^{-1}\rho_{os}\frac{dB_{w}^{-1}}{dp}\right\} }}{auxi3}\right\} \nonumber 
\end{eqnarray}

\end_inset


\end_layout

\begin_layout Standard
The terms in the first line (related to 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $q_{w}$
\end_inset

 and 
\begin_inset Formula $q_{o}$
\end_inset

) are introduced in por_wellte.
 
\end_layout

\begin_layout Standard
The term in the second line is sent to the LHS.
 It has the same form as it had before implementing the M&L modification.
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
The first term in the third line is introduced in por_elmprs: gprhs.
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
The second term
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
 in the third line, that appears when 
\begin_inset Formula $g\neq0$
\end_inset

 has some similarity with the terms that appered before Malta and Loula.
 Actually the only thing that needs to be modified is the definition of
 auxi3 It is also introduces in 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
por_elmprs: gprhs.
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Box Doublebox
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
The the final complete equation is then 
\begin_inset Formula 
\begin{eqnarray}
\phi\frac{\rho_{ws}}{B_{w}}\frac{\partial S_{w}}{\partial t}+\left\{ \frac{\rho_{ws}}{B_{w}}\mathbf{u^{*}}\cdot\frac{\partial f_{w}}{\partial S_{w}}+\underset{\overbrace{f_{w}\rho_{ws}\frac{k}{\mu_{o}}\mathbf{g}\cdot B_{w}^{-1}\left(\frac{\rho_{ws}}{B_{w}}-\frac{\rho_{os}}{B_{o}}\right)\frac{dk_{ro}}{dS_{w}}}}{gpadv(2nd\, term)}\right\} \nabla S_{w}=q_{w}-f_{w}\left\{ q_{w}+\frac{\rho_{ws}}{\rho_{os}}\frac{B_{o}}{B_{w}}q_{o}\right\} \label{eq:Final_malta_loula_satur-2}\\
-f_{w}\rho_{ws}\left\{ f_{o}\left(\frac{dB_{w}^{-1}}{dp}-\frac{B_{o}}{B_{w}}\frac{dB_{o}^{-1}}{dp}\right)\underset{\overbrace{\mathbf{u}\cdot\nabla p}}{auxi1}+\lambda_{o}\underset{\overbrace{\mathbf{k\:}\mathbf{g}\cdot\nabla p}}{auxi2}\underset{\overbrace{\left\{ B_{w}^{-1}\left(2\rho_{ws}\frac{dB_{w}^{-1}}{dp}-\rho_{os}\frac{dB_{o}^{-1}}{dp}\right)-B_{o}^{-1}\rho_{os}\frac{dB_{w}^{-1}}{dp}\right\} }}{auxi3}\right\} \nonumber 
\end{eqnarray}

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Well terms
\end_layout

\begin_layout Standard
How the terms related to 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $q_{w}$
\end_inset

 and 
\begin_inset Formula $q_{o}$
\end_inset

 are introduced depends if we set pbh, qw o qt.
\end_layout

\begin_layout Standard
In the previous implementation for the saturation equation we only needed
 to introduce qw when we set ..??'
\end_layout

\begin_layout Subsubsection
Pbh given
\end_layout

\begin_layout Standard
In this case we needed to add 
\begin_inset Formula 
\[
q_{w}=\frac{\rho_{ws}k_{rw}}{B_{w}\mu_{w}}WI^{M}\left(p_{bh}-p_{0}\right)
\]

\end_inset

We first pre-calculated wellt= krw*WI/(muw*BW) and then added to the rhs
 denwa_por * wellt * ( praux - press(ipoin,1) ) .
\end_layout

\begin_layout Standard
For the Malta and Loula case we need to add 
\begin_inset Formula 
\[
q_{w}-f_{w}\left\{ q_{w}+\frac{\rho_{ws}}{\rho_{os}}\frac{B_{o}}{B_{w}}q_{o}\right\} 
\]

\end_inset

that is
\begin_inset Formula 
\[
q_{w}*\left(1-f_{w}\right)-f_{w}\frac{\rho_{ws}}{\rho_{os}}\frac{B_{o}}{B_{w}}q_{o}
\]

\end_inset

For the first term it is just multiply what we had by 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\left(1-f_{w}\right)$
\end_inset

.
 Then we have to calculate 
\begin_inset Formula $q_{o}$
\end_inset


\begin_inset Formula 
\[
q_{o}=\frac{\rho_{os}k_{ro}}{B_{o}\mu_{o}}WI^{M}\left(p_{bh}-p_{0}\right)
\]

\end_inset


\end_layout

\begin_layout Standard
So the whole thing reads
\begin_inset Formula 
\[
q_{w}*\left(1-f_{w}\right)-f_{w}\frac{\rho_{ws}}{\rho_{os}}\frac{B_{o}}{B_{w}}q_{o}
\]

\end_inset


\begin_inset Formula 
\[
\frac{\rho_{ws}k_{rw}}{B_{w}\mu_{w}}WI^{M}\left(p_{bh}-p_{0}\right)*\left(1-f_{w}\right)-f_{w}\frac{\rho_{ws}}{\rho_{os}}\frac{B_{o}}{B_{w}}\frac{\rho_{os}k_{ro}}{B_{o}\mu_{o}}WI^{M}\left(p_{bh}-p_{0}\right)
\]

\end_inset


\begin_inset Formula 
\[
\left\{ \left(1-f_{w}\right)\frac{k_{rw}}{\mu_{w}}-f_{w}\frac{k_{ro}}{\mu_{o}}\right\} \frac{\rho_{ws}}{B_{w}}WI^{M}\left(p_{bh}-p_{0}\right)
\]

\end_inset

Using 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:fw"

\end_inset

 and 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:lambda-alpha"

\end_inset


\begin_inset Formula 
\[
\left\{ \left(1-\frac{\frac{k_{rw}}{\mu_{w}}}{\frac{k_{rw}}{\mu_{w}}+\frac{k_{ro}}{\mu_{o}}}\right)\frac{k_{rw}}{\mu_{w}}-\frac{\frac{k_{rw}}{\mu_{w}}}{\frac{k_{rw}}{\mu_{w}}+\frac{k_{ro}}{\mu_{o}}}\frac{k_{ro}}{\mu_{o}}\right\} \frac{\rho_{ws}}{B_{w}}WI^{M}\left(p_{bh}-p_{0}\right)
\]

\end_inset


\begin_inset Formula 
\[
\frac{1}{\frac{k_{rw}}{\mu_{w}}+\frac{k_{ro}}{\mu_{o}}}\left\{ \left(\frac{k_{rw}}{\mu_{w}}+\frac{k_{ro}}{\mu_{o}}-\frac{k_{rw}}{\mu_{w}}\right)\frac{k_{rw}}{\mu_{w}}-\frac{k_{rw}}{\mu_{w}}\frac{k_{ro}}{\mu_{o}}\right\} \frac{\rho_{ws}}{B_{w}}WI^{M}\left(p_{bh}-p_{0}\right)
\]

\end_inset


\begin_inset Formula 
\[
\frac{1}{\frac{k_{rw}}{\mu_{w}}+\frac{k_{ro}}{\mu_{o}}}\left\{ \frac{k_{ro}}{\mu_{o}}\frac{k_{rw}}{\mu_{w}}-\frac{k_{rw}}{\mu_{w}}\frac{k_{ro}}{\mu_{o}}\right\} \frac{\rho_{ws}}{B_{w}}WI^{M}\left(p_{bh}-p_{0}\right)=0
\]

\end_inset

This is very good news this term disappears when pbh is imposed!!!!!!!!!!!!!!!!!
!!!!!!!!!!! This was what I was expecting!!!!!!!!!!!!!!! 
\end_layout

\begin_layout Standard
Still missing to analyze the cases of imposed water flow rate of total flow
 rate but for the moment I will try this!!!!!!!!!!!!!!!!!!!!
\end_layout

\begin_layout Standard
Moreover in the injector some special consideration must be taken into account
 to tell that all that is being injected is water.
 I believe I do not have this yet .
\end_layout

\begin_layout Subsubsection
Pbh given but it is a water injector
\end_layout

\begin_layout Standard
In this case all that is introduced is water so I guess that in this case
 we would have 
\begin_inset Formula 
\[
q_{w}=\frac{\rho_{ws}}{B_{w}\mu_{w}}WI^{M}\left(p_{bh}-p_{0}\right)
\]

\end_inset

that is I have set krw=1 !!!!!!!!!!!!!!!!!!!!.
 But I am not at all sure about this reasoning.
 I should discuss this with Ruben.
 Beware according to what I have finally been able to discuss with Ruben
 (15 nov) this is not correct.
 Actully we spoke about teh producers but I guess the same reasoning applies.
 So actaully what we should have is 
\begin_inset Formula 
\[
q_{w}=\frac{k_{rw}\rho_{ws}}{B_{w}\mu_{w}}WI^{M}\left(p_{bh}-p_{0}\right)
\]

\end_inset

 I should reanalize how this would influence what we have programmed.
\end_layout

\begin_layout Subsubsection
Water flow rate given
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
q_{w}=q_{w}^{data}
\]

\end_inset


\begin_inset Formula 
\[
q_{o}=0
\]

\end_inset


\end_layout

\begin_layout Standard
So the terms to be added in por_wellte for saturation are 
\begin_inset Formula 
\[
q_{w}-f_{w}\left\{ q_{w}+\frac{\rho_{ws}}{\rho_{os}}\frac{B_{o}}{B_{w}}q_{o}\right\} 
\]

\end_inset

 that then simplify to REVISED 15 NOV 
\begin_inset Formula 
\[
q_{w}\left(1-f_{w}\right)
\]

\end_inset


\end_layout

\begin_layout Standard
Forth the pressure we have (actually we should reorganize the part for the
 wells in a separate section)
\begin_inset Formula 
\[
\frac{q_{w}}{\rho_{ws}}+\frac{B_{o}}{B_{w}}\frac{q_{o}}{\rho_{os}}
\]

\end_inset

Since 
\begin_inset Formula 
\[
q_{o}=0
\]

\end_inset

it simplifies to REVISED 15 NOV
\begin_inset Formula 
\[
\frac{q_{w}}{\rho_{ws}}
\]

\end_inset

 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula 
\[
\]

\end_inset


\end_layout

\begin_layout Subsubsection
Total flow rate given
\end_layout

\begin_layout Standard
I understand that it is just.
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
q_{w}=k_{rw}q_{T}
\]

\end_inset


\begin_inset Formula 
\[
q_{o}=k_{ro}q_{T}
\]

\end_inset

as we have already mentioned in 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:well_flow_rate_alpha"

\end_inset

.
 Beware actually I am not totally sure that this is true.
 Actually Ruben gives me the volumtric flow rates for both components separatell
y.
 If I use this two values in the pressure equation 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:final_pressure"

\end_inset

 note that I have exactly what is needed.
 The RHS is 
\begin_inset Formula 
\[
=\frac{q_{w}}{\rho_{ws}}+\frac{B_{o}}{B_{w}}\frac{q_{o}}{\rho_{os}}
\]

\end_inset

and Ruben is giving me 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\frac{q_{w}}{\rho_{ws}}$
\end_inset

 and 
\begin_inset Formula $\frac{q_{o}}{\rho_{os}}$
\end_inset

.
\end_layout

\begin_layout Standard
For the Water Saturation equation obvioslly the lógical thing would be set
 the RHS as I have already mentioned in the case whre Pbh is impossed.
 This makes sense with tha fact that at a well the proportions come out
 as they are.
 so the saturation should not be affected at teh well.
\end_layout

\begin_layout Standard
Nevertheles I belive there is some kind of incongruence because unless we
 manage to reproduce Ruben's Saturation exactly the proportion of fluid
 we would be obtainig at teh well would no match Ruben's.
 So actually imposisng Ruben´s 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\frac{q_{w}}{\rho_{ws}}$
\end_inset

 and 
\begin_inset Formula $\frac{q_{o}}{\rho_{os}}$
\end_inset

 for the pressure equation would no be very logical.
 Perhaps what we should impose is the total flow rate.
 And I am not sure if it should be the total volumetric or mass flow rate.
\end_layout

\begin_layout Standard
Opción 1: Fijar 
\begin_inset Formula $q_{vol-tot}$
\end_inset


\end_layout

\begin_layout Subsubsection
Oil flow rate fixed - for a well
\end_layout

\begin_layout Standard
This is what I see ruben does at the wells.
 See 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:New-BC-at"

\end_inset

.
\end_layout

\begin_layout Standard
In the Satuartion we were doing nothing up to 15 nov.
 I realized this is an error.
 We need to add
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula 
\[
q_{w}-f_{w}\left\{ q_{w}+\frac{\rho_{ws}}{\rho_{os}}\frac{B_{o}}{B_{w}}q_{o}\right\} 
\]

\end_inset


Using 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:qw_from_qo"

\end_inset

 we get

\begin_inset Formula 
\[
\frac{\mu_{o}}{\mu_{w}}\frac{B_{o}}{B_{w}}\frac{\rho_{ws}}{\rho_{os}}\frac{k_{rw}}{k_{ro}}q_{o}-f_{w}\left\{ \frac{\mu_{o}}{\mu_{w}}\frac{B_{o}}{B_{w}}\frac{\rho_{ws}}{\rho_{os}}\frac{k_{rw}}{k_{ro}}q_{o}+\frac{\rho_{ws}}{\rho_{os}}\frac{B_{o}}{B_{w}}q_{o}\right\} 
\]

\end_inset


\begin_inset Formula 
\[
\frac{\rho_{ws}}{\rho_{os}}\frac{B_{o}}{B_{w}}q_{o}\left(\frac{\mu_{o}}{\mu_{w}}\frac{k_{rw}}{k_{ro}}-f_{w}\left\{ \frac{\mu_{o}}{\mu_{w}}\frac{k_{rw}}{k_{ro}}+1\right\} \right)
\]

\end_inset


\end_layout

\begin_layout Standard
where using the definitions 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:lambda-alpha-1"

\end_inset

 and 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq-fractional_flow"

\end_inset

 we get
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula 
\begin{equation}
\lambda_{\alpha}=\frac{k_{r\alpha}}{\mu_{\alpha}}\label{eq:lambda-alpha-1-1}
\end{equation}

\end_inset


\begin_inset Formula 
\begin{equation}
f_{w}=\frac{\lambda_{w}}{\lambda_{w}+\lambda_{o}}\label{eq-fractional_flow-1}
\end{equation}

\end_inset



\begin_inset Formula 
\[
\frac{\rho_{ws}}{\rho_{os}}\frac{B_{o}}{B_{w}}q_{o}\left(\frac{\lambda_{w}}{\lambda_{o}}-\frac{\lambda_{w}}{\lambda_{w}+\lambda_{o}}\left\{ \frac{\lambda_{w}+\lambda_{o}}{\lambda_{o}}\right\} \right)
\]

\end_inset


\begin_inset Formula 
\[
\frac{\rho_{ws}}{\rho_{os}}\frac{B_{o}}{B_{w}}q_{o}\left(\frac{\lambda_{w}}{\lambda_{o}}-\frac{\lambda_{w}}{\lambda_{o}}\right)=0
\]

\end_inset


\end_layout

\begin_layout Standard
Beware I am getting what I had before 15 nov.
 No modification needed in saturation equation.
 Something is strange.
 Or not?? Perhaps not if the water is there fixed.
 And the oil is just passing through it seems logical that the Saturation
 is not affected.
\end_layout

\begin_layout Standard
In the pressure equation we have.
 Finally I realized that what was really wrong was the calculation of qw
 in por_outset.
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula 
\[
.....=\frac{q_{w}}{\rho_{ws}}+\frac{B_{o}}{B_{w}}\frac{q_{o}}{\rho_{os}}
\]

\end_inset

 Using 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:qw_from_qo"

\end_inset

 we get
\begin_inset Formula 
\[
.....=\frac{1}{\rho_{ws}}\frac{\mu_{o}}{\mu_{w}}\frac{B_{o}}{B_{w}}\frac{\rho_{ws}}{\rho_{os}}\frac{k_{rw}}{k_{ro}}q^{o}+\frac{B_{o}}{B_{w}}\frac{q_{o}}{\rho_{os}}
\]

\end_inset


\begin_inset Formula 
\[
.....=\frac{\mu_{o}}{\mu_{w}}\frac{B_{o}}{B_{w}}\frac{1}{\rho_{os}}\frac{k_{rw}}{k_{ro}}q^{o}+\frac{B_{o}}{B_{w}}\frac{q_{o}}{\rho_{os}}
\]

\end_inset


\begin_inset Formula 
\[
.....=\frac{B_{o}}{B_{w}}\frac{q_{o}}{\rho_{os}}\left(1+\frac{\mu_{o}}{\mu_{w}}\frac{k_{rw}}{k_{ro}}\right)
\]

\end_inset


\end_layout

\begin_layout Section
New BC at producer -Oil flow rate fixed
\begin_inset CommandInset label
LatexCommand label
name "sec:New-BC-at"

\end_inset


\end_layout

\begin_layout Standard
Looking at Ruben's results it seems logical to impose the oil flow rate
 at the producer.
 
\end_layout

\begin_layout Standard
Actually from the .RSM file we see that at the producer ruben is imposing
 
\begin_inset Formula 
\[
q_{o-vol-std}=500\frac{m^{3}}{day}
\]

\end_inset


\end_layout

\begin_layout Standard
Using 13.18 chen .
 Wher i think the equation has an error in the case in which g/=0 the term
 in the pressure diference I believe is not correct.
 perhaps discuss with guillaume.
 Actually I prefer to think of a pbh variable with height in which acse
 that term dissapears.
 Then we avn rewrite the equation for an isottropic material as 
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
q^{\alpha}=\frac{\rho_{\alpha}k_{r\alpha}}{\mu_{\alpha}}2\pi k_{*}h_{3}\triangle p.
\]

\end_inset

so we have for oil 
\begin_inset Formula 
\[
q^{o}=\frac{\rho_{o}k_{ro}}{\mu_{o}}2\pi k_{*}h_{3}\triangle p.
\]

\end_inset

From here we can obtain 
\begin_inset Formula 
\[
2\pi k_{*}h_{3}\triangle p=\frac{q^{o}\mu_{o}}{\rho_{o}k_{ro}}.
\]

\end_inset

Then 
\begin_inset Formula 
\[
q^{w}=\frac{\rho_{w}k_{rw}}{\mu_{w}}2\pi k_{*}h_{3}\triangle p=\frac{q^{o}\mu_{o}}{\rho_{o}k_{ro}}\frac{\rho_{w}k_{rw}}{\mu_{w}}
\]

\end_inset


\begin_inset Formula 
\[
q^{w}=q^{o}\frac{\mu_{o}}{\mu_{w}}\frac{\rho_{w}k_{rw}}{\rho_{o}k_{ro}}
\]

\end_inset


\begin_inset Formula 
\begin{equation}
q^{w}=\frac{\mu_{o}}{\mu_{w}}\frac{B_{o}}{B_{w}}\frac{\rho_{ws}}{\rho_{os}}\frac{k_{rw}}{k_{ro}}q^{o}\label{eq:qw_from_qo}
\end{equation}

\end_inset

So now I can impose 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $q_{o}$
\end_inset

 and obtain 
\begin_inset Formula $q_{w}$
\end_inset

 from it .
\end_layout

\begin_layout Section
Verificación de unidades
\end_layout

\begin_layout Subsection
Well index
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
q_{M}=\frac{\rho}{\mu}WI^{M}\left(p_{bh}-p_{0}\right).
\]

\end_inset


\begin_inset Formula 
\[
\frac{kg}{s}=\frac{kg/m^{3}}{Pa.s}m^{3}Pa.
\]

\end_inset

Con lo cual se ve claramenet que verifica.
 Donde he usado 
\begin_inset Formula 
\begin{equation}
WI^{\left(j,m\right)}=\frac{2\pi\bar{k}\triangle L^{\left(j,m\right)}}{ln\left(r_{e}^{\left(j,m\right)}/r_{w}^{\left(j\right)}\right)}=\frac{m^{2}m}{1}=m^{3}\label{eq:wellindex-1-1}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Unidades de well index
\begin_inset Formula 
\[
\frac{m^{2}m}{1}=m^{3}
\]

\end_inset


\end_layout

\begin_layout Subsection
Pressure equation
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula 
\begin{equation}
\left(c_{wp}+\frac{B_{o}}{B_{w}}c_{op}\right)\frac{\partial p}{\partial t}-\nabla\cdot\left(\frac{K}{B_{w}}\left(\lambda_{w}+\lambda_{o}\right)\nabla p\right)+\nabla\cdot\left(\frac{K}{B_{w}}\left(\frac{\rho_{ws}\lambda_{w}}{B_{w}}+\frac{\rho_{os}\lambda_{o}}{B_{o}}\right)\ \mathbf{g}\right)=\frac{q_{w}}{\rho_{ws}}+\frac{B_{o}}{B_{w}}\frac{q_{o}}{\rho_{os}}\label{eq:final_pressure-1}
\end{equation}

\end_inset


\begin_inset Formula 
\[
\left(\frac{kg}{s^{2}m}\right)^{-1}\frac{kg}{s^{3}m}-\frac{1}{m}m^{2}\frac{1}{\frac{kg}{s^{2}m}.s}\frac{1}{m}\frac{kg}{s^{2}m}+\frac{1}{m}m^{2}\frac{kg}{m^{3}}\frac{1}{\frac{kg}{s^{2}m}.s}\frac{m}{s^{2}}=\frac{1}{s}
\]

\end_inset


\begin_inset Formula 
\[
\frac{1}{s}-\frac{1}{s}+\frac{1}{s}=\frac{1}{s}
\]

\end_inset


\end_layout

\begin_layout Section
to do
\end_layout

\begin_layout Itemize
fw agregar la definicion -- ver ec 38 ahi dice Chen 7.3.1
\end_layout

\begin_layout Itemize
rho_alpha_std aclarar lo que es y así alguna otra cosa.
\end_layout

\begin_layout Itemize
paralelo : revisar con guillaume si andaría ok.
 sobre tod lo de los caudales nodales SOLO NODOS PROPIOS.
 Ademas mirar por_outwel -- lo hice medio cutre
\end_layout

\begin_layout Itemize

\color red
h3 en por_wellin para que ande en // hay que leerlo en field no calcularlo.
 Adeams en por_iniunk el runend (L61) hay que sacarlo y ademas revisar ipwel_por
 para que se usa y si esta bien en //.
 
\end_layout

\begin_layout Itemize
Comportamientos feo solver-- mala ortog si apreto mucho.
 no me dja usar deflated -- consultar guillaume.
 Creo que no serian necesarios fixities debido al término transitorio y
 ademas por como tratamos el well.
 Discutir con guillaume.
\end_layout

\begin_layout Itemize
Saturación -- a Ruben no le gusta que pase de 1.
 A mi tampoco pero creo entiendo porque pasa.
 la vel es casi 0 en el well no se transporta.
 esto se deb a como tartamos los wells que es uan mierda.
 Uan solución seria meter difusión el los elem donde esta el well en la
 ec de Satur..
 No me doy cuenat que valor habría que usar.
 
\end_layout

\begin_layout Itemize
controalr tube 8 y 9.
 Reacer las cuenats del caudat --- ojo hay que hacerlo despues de que el
 caudal en al entarda queda cte.
\end_layout

\begin_layout Itemize
ver porque baja la vel en alsega capa cuando el grad de perss smotheado
 no baja.
 ver si pasa tambien en 9 o solo en 8 ...
 sera por las propiedades.
 Mira rapidamenet en 9 y ahí da perfecto!!! igual reanalizar
\end_layout

\begin_layout Itemize
luego repensar si podrái hacer el acso en 1d .
 --- ahi podrái repensar si debo o no imponer sw=1 en el well
\end_layout

\begin_layout Subsection
resumen
\end_layout

\begin_layout Itemize
por_bouope: guillaume me dijo que cree el signo esta mal.
 Ademas me faltó multiplicar por gbsur!!!!!!!!!!!!!!!!-- él ya corrigió
 varias cosas -- luego antes de volver a usar habría que revisar
\end_layout

\begin_layout Itemize
elmpre dimensionada de mnode,ncomp_por ....
 ojo hay que hacer trampa no se puede usar directamenet en esa sub -- hay
 que usar siempre en subrutinas..
 Revisar tambien elmsw y en realidad todos los mnode.
 Hay que encontrar una forma más limpia para hacer esto en ALYA!!!!!!!!!!!!!!!!!
!!!!!!!!!!!!!!....
 Ver que es así como se hace en nsi_elmope
\end_layout

\begin_layout Itemize
mismo problema del gather en smokrx(dice guillaume que em lo arregla él---
 supongo que tendrá bugs pero por lo menos compila) con elswa(mnode,*)---
 ya tambien lo encontre en elmops.....
 COMENTAR CON GUILLAUME --- esto hay que limpiarlo en ALYA2 --- como lo
 van a dejar?????????
\end_layout

\begin_layout Itemize
tambien en por_elmops(ya corregí)
\end_layout

\begin_layout Itemize
tambien en por_elmpmo falsa alarma-- aca si esta ok gpcar si hay que poner
 lo de mnode ver elmcar
\end_layout

\begin_layout Itemize
por_velsmo ---la cago al llamar a assrhs?????????????? ver smokrx--- creo
 que esta ok
\end_layout

\begin_layout Itemize
por_elppma:gppre pnode --- vs por_elmope por_elmpre mnode!!!!!!!!! tambien
 ver elmop0 ---- tambien elmpm0 --- aca creo que la solucion es usar mgaus
 en elmpma y elmpm0.
 Meto así comentar guillaume
\end_layout

\begin_layout Itemize
OJO en elmpm0 tengo el mismo error que en elmpma---------- ahi simplemenet
 elimine elmpre que no lo estab usando.
\end_layout

\begin_layout Subsubsection
Subs con mnode,xxxx)
\end_layout

\begin_layout Itemize
elmop0: elpre elswa
\end_layout

\begin_layout Itemize
elmope: elpre elswa
\end_layout

\begin_layout Itemize
elmops: elpre elswa
\end_layout

\begin_layout Subsubsection
Subs con mgaus,xxxx)
\end_layout

\begin_layout Itemize
elmpma: gppre --- puse mnode con esto qeda consistente con elmope
\end_layout

\begin_layout Itemize
elmpre: gppre, gpswa(gpswa es solo interno no hay problema)
\end_layout

\begin_layout Itemize
elmope: gppre Quedan las 3 consistentes en gppre no debería haber problema.
\end_layout

\begin_layout Section
Cambios guillaume
\end_layout

\begin_layout Standard
En version xxxxx
\end_layout

\begin_layout Itemize
me metio la opcion de correr satur implicita - se da cuaenta directamente
 al poner solver GMRES
\end_layout

\begin_layout Itemize
2 metio la opcion de poner codigos tanto para satur como press.
 por ahora lo usamos paar precribir a uno satur en inyector de agua.
 Supuestamenet anda tanto paar implicito como explicito
\end_layout

\begin_layout Itemize
me paso sus .dat por email ---falta pedirselo nuevamenet
\end_layout

\begin_layout Section
compresibility pure water
\end_layout

\begin_layout Standard
constant pressure
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula 
\begin{equation}
c_{wp}\frac{\partial p}{\partial t}=\frac{q_{w}}{\rho_{ws}}\label{eq:final_pressure-2}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
For Sw=1 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula 
\begin{equation}
c_{wp}=\phi^{0}c_{R}\frac{1}{B_{w}}+\phi\frac{\partial B_{w}^{-1}}{\partial p}\label{eq:c_alpha_p-1}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
and additionally we have the following definitions
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
B_{w}(P)=\frac{B_{w}(P_{ref})}{1+X+\left(X^{2}/2\right)}
\]

\end_inset

with
\begin_inset Formula 
\[
X=c_{w}\left(P-P_{ref}\right)
\]

\end_inset

Rock compresibility
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
V(P)=V(Pref)\left[1+X+\frac{X^{2}}{2}\right]
\]

\end_inset


\begin_inset Formula 
\[
X=c_{r}\left(P-P_{ref}\right)
\]

\end_inset


\end_layout

\begin_layout Subsection
Simplification 1 - cr=0
\end_layout

\begin_layout Standard
Taking cr=0 we get
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula 
\begin{equation}
c_{wp}=\phi^{0}\frac{\partial B_{w}^{-1}}{\partial p}\label{eq:c_alpha_p-1-1}
\end{equation}

\end_inset

Si ademas despreciamos el termino cuadratico en la definicion de Bw obtenemos
\begin_inset Formula 
\[
c_{wp}=\phi^{0}\frac{c_{w}}{B_{w}(P_{ref})}
\]

\end_inset

entonces tenemos 
\begin_inset Formula 
\[
\frac{\partial p}{\partial t}=\frac{1}{c_{wp}}\frac{q_{w}}{\rho_{ws}}=\frac{B_{w}(P_{ref})q_{w}}{\phi^{0}c_{w}\rho_{ws}}
\]

\end_inset

lo pruebo en run 6
\end_layout

\begin_layout Subsection
Cw=0
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
c_{wp}=\phi^{0}c_{R}\frac{1}{B_{w}}
\]

\end_inset


\begin_inset Formula 
\[
\frac{\partial p}{\partial t}=\frac{1}{c_{wp}}\frac{q_{w}}{\rho_{ws}}=\frac{B_{w}(P_{ref})q_{w}}{\phi^{0}c_{R}\rho_{ws}}
\]

\end_inset

Since Cw=0 Bw does not depend on P 
\end_layout

\end_body
\end_document
